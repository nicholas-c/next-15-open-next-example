"use strict";function _export(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{MutableRequestCookiesAdapter:function(){return MutableRequestCookiesAdapter},ReadonlyRequestCookiesError:function(){return ReadonlyRequestCookiesError},RequestCookiesAdapter:function(){return RequestCookiesAdapter},appendMutableCookies:function(){return appendMutableCookies},areCookiesMutableInCurrentPhase:function(){return areCookiesMutableInCurrentPhase},getModifiedCookieValues:function(){return getModifiedCookieValues},responseCookiesToRequestCookies:function(){return responseCookiesToRequestCookies},wrapWithMutableAccessCheck:function(){return wrapWithMutableAccessCheck}});const _cookies=require("../cookies"),_reflect=require("./reflect"),_workasyncstorageexternal=require("../../../app-render/work-async-storage.external"),_workunitasyncstorageexternal=require("../../../app-render/work-unit-async-storage.external");class ReadonlyRequestCookiesError extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new ReadonlyRequestCookiesError}}class RequestCookiesAdapter{static seal(e){return new Proxy(e,{get(e,t,o){switch(t){case"clear":case"delete":case"set":return ReadonlyRequestCookiesError.callable;default:return _reflect.ReflectAdapter.get(e,t,o)}}})}}const SYMBOL_MODIFY_COOKIE_VALUES=Symbol.for("next.mutated.cookies");function getModifiedCookieValues(e){const t=e[SYMBOL_MODIFY_COOKIE_VALUES];return t&&Array.isArray(t)&&0!==t.length?t:[]}function appendMutableCookies(e,t){const o=getModifiedCookieValues(t);if(0===o.length)return!1;const r=new _cookies.ResponseCookies(e),s=r.getAll();for(const e of o)r.set(e);for(const e of s)r.set(e);return!0}class MutableRequestCookiesAdapter{static wrap(e,t){const o=new _cookies.ResponseCookies(new Headers);for(const t of e.getAll())o.set(t);let r=[];const s=new Set,n=()=>{const e=_workasyncstorageexternal.workAsyncStorage.getStore();e&&(e.pathWasRevalidated=!0);const n=o.getAll();if(r=n.filter((e=>s.has(e.name))),t){const e=[];for(const t of r){const o=new _cookies.ResponseCookies(new Headers);o.set(t),e.push(o.toString())}t(e)}},a=new Proxy(o,{get(e,t,o){switch(t){case SYMBOL_MODIFY_COOKIE_VALUES:return r;case"delete":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),a}finally{n()}};case"set":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),a}finally{n()}};default:return _reflect.ReflectAdapter.get(e,t,o)}}});return a}}function wrapWithMutableAccessCheck(e){const t=new Proxy(e,{get(e,o,r){switch(o){case"delete":return function(...o){return ensureCookiesAreStillMutable("cookies().delete"),e.delete(...o),t};case"set":return function(...o){return ensureCookiesAreStillMutable("cookies().set"),e.set(...o),t};default:return _reflect.ReflectAdapter.get(e,o,r)}}});return t}function areCookiesMutableInCurrentPhase(e){return"action"===e.phase}function ensureCookiesAreStillMutable(e){if(!areCookiesMutableInCurrentPhase((0,_workunitasyncstorageexternal.getExpectedRequestStore)(e)))throw new ReadonlyRequestCookiesError}function responseCookiesToRequestCookies(e){const t=new _cookies.RequestCookies(new Headers);for(const o of e.getAll())t.set(o);return t}