"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{NextRequestAdapter:function(){return NextRequestAdapter},ResponseAborted:function(){return ResponseAborted},ResponseAbortedName:function(){return ResponseAbortedName},createAbortController:function(){return createAbortController},signalFromNodeResponse:function(){return signalFromNodeResponse}});const _requestmeta=require("../../../request-meta"),_utils=require("../../utils"),_request=require("../request"),_helpers=require("../../../base-http/helpers"),ResponseAbortedName="ResponseAborted";class ResponseAborted extends Error{constructor(...e){super(...e),this.name=ResponseAbortedName}}function createAbortController(e){const t=new AbortController;return e.once("close",(()=>{e.writableFinished||t.abort(new ResponseAborted)})),t}function signalFromNodeResponse(e){const{errored:t,destroyed:r}=e;if(t||r)return AbortSignal.abort(t??new ResponseAborted);const{signal:o}=createAbortController(e);return o}class NextRequestAdapter{static fromBaseNextRequest(e,t){if("edge"===process.env.NEXT_RUNTIME&&(0,_helpers.isWebNextRequest)(e))return NextRequestAdapter.fromWebNextRequest(e);if("edge"!==process.env.NEXT_RUNTIME&&(0,_helpers.isNodeNextRequest)(e))return NextRequestAdapter.fromNodeNextRequest(e,t);throw Object.defineProperty(new Error("Invariant: Unsupported NextRequest type"),"__NEXT_ERROR_CODE",{value:"E345",enumerable:!1,configurable:!0})}static fromNodeNextRequest(e,t){let r,o=null;if("GET"!==e.method&&"HEAD"!==e.method&&e.body&&(o=e.body),e.url.startsWith("http"))r=new URL(e.url);else{const t=(0,_requestmeta.getRequestMeta)(e,"initURL");r=t&&t.startsWith("http")?new URL(e.url,t):new URL(e.url,"http://n")}return new _request.NextRequest(r,{method:e.method,headers:(0,_utils.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:t,...t.aborted?{}:{body:o}})}static fromWebNextRequest(e){let t=null;return"GET"!==e.method&&"HEAD"!==e.method&&(t=e.body),new _request.NextRequest(e.url,{method:e.method,headers:(0,_utils.fromNodeOutgoingHttpHeaders)(e.headers),duplex:"half",signal:e.request.signal,...e.request.signal.aborted?{}:{body:t}})}}