"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"NextURL",{enumerable:!0,get:function(){return NextURL}});const _detectdomainlocale=require("../../shared/lib/i18n/detect-domain-locale"),_formatnextpathnameinfo=require("../../shared/lib/router/utils/format-next-pathname-info"),_gethostname=require("../../shared/lib/get-hostname"),_getnextpathnameinfo=require("../../shared/lib/router/utils/get-next-pathname-info"),REGEX_LOCALHOST_HOSTNAME=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function parseURL(t,e){return new URL(String(t).replace(REGEX_LOCALHOST_HOSTNAME,"localhost"),e&&String(e).replace(REGEX_LOCALHOST_HOSTNAME,"localhost"))}const Internal=Symbol("NextURLInternal");class NextURL{constructor(t,e,n){let a,r;"object"==typeof e&&"pathname"in e||"string"==typeof e?(a=e,r=n||{}):r=n||e||{},this[Internal]={url:parseURL(t,a??r.base),options:r,basePath:""},this.analyze()}analyze(){var t,e,n,a,r;const s=(0,_getnextpathnameinfo.getNextPathnameInfo)(this[Internal].url.pathname,{nextConfig:this[Internal].options.nextConfig,parseData:!process.env.__NEXT_NO_MIDDLEWARE_URL_NORMALIZE,i18nProvider:this[Internal].options.i18nProvider}),l=(0,_gethostname.getHostname)(this[Internal].url,this[Internal].options.headers);this[Internal].domainLocale=this[Internal].options.i18nProvider?this[Internal].options.i18nProvider.detectDomainLocale(l):(0,_detectdomainlocale.detectDomainLocale)(null==(e=this[Internal].options.nextConfig)||null==(t=e.i18n)?void 0:t.domains,l);const o=(null==(n=this[Internal].domainLocale)?void 0:n.defaultLocale)||(null==(r=this[Internal].options.nextConfig)||null==(a=r.i18n)?void 0:a.defaultLocale);this[Internal].url.pathname=s.pathname,this[Internal].defaultLocale=o,this[Internal].basePath=s.basePath??"",this[Internal].buildId=s.buildId,this[Internal].locale=s.locale??o,this[Internal].trailingSlash=s.trailingSlash}formatPathname(){return(0,_formatnextpathnameinfo.formatNextPathnameInfo)({basePath:this[Internal].basePath,buildId:this[Internal].buildId,defaultLocale:this[Internal].options.forceLocale?void 0:this[Internal].defaultLocale,locale:this[Internal].locale,pathname:this[Internal].url.pathname,trailingSlash:this[Internal].trailingSlash})}formatSearch(){return this[Internal].url.search}get buildId(){return this[Internal].buildId}set buildId(t){this[Internal].buildId=t}get locale(){return this[Internal].locale??""}set locale(t){var e,n;if(!this[Internal].locale||!(null==(n=this[Internal].options.nextConfig)||null==(e=n.i18n)?void 0:e.locales.includes(t)))throw Object.defineProperty(new TypeError(`The NextURL configuration includes no locale "${t}"`),"__NEXT_ERROR_CODE",{value:"E597",enumerable:!1,configurable:!0});this[Internal].locale=t}get defaultLocale(){return this[Internal].defaultLocale}get domainLocale(){return this[Internal].domainLocale}get searchParams(){return this[Internal].url.searchParams}get host(){return this[Internal].url.host}set host(t){this[Internal].url.host=t}get hostname(){return this[Internal].url.hostname}set hostname(t){this[Internal].url.hostname=t}get port(){return this[Internal].url.port}set port(t){this[Internal].url.port=t}get protocol(){return this[Internal].url.protocol}set protocol(t){this[Internal].url.protocol=t}get href(){const t=this.formatPathname(),e=this.formatSearch();return`${this.protocol}//${this.host}${t}${e}${this.hash}`}set href(t){this[Internal].url=parseURL(t),this.analyze()}get origin(){return this[Internal].url.origin}get pathname(){return this[Internal].url.pathname}set pathname(t){this[Internal].url.pathname=t}get hash(){return this[Internal].url.hash}set hash(t){this[Internal].url.hash=t}get search(){return this[Internal].url.search}set search(t){this[Internal].url.search=t}get password(){return this[Internal].url.password}set password(t){this[Internal].url.password=t}get username(){return this[Internal].url.username}set username(t){this[Internal].url.username=t}get basePath(){return this[Internal].basePath}set basePath(t){this[Internal].basePath=t.startsWith("/")?t:`/${t}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new NextURL(String(this),this[Internal].options)}}