"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"NextResponse",{enumerable:!0,get:function(){return NextResponse}});const _cookies=require("../../web/spec-extension/cookies"),_nexturl=require("../next-url"),_utils=require("../utils"),_reflect=require("./adapters/reflect"),_cookies1=require("./cookies"),INTERNALS=Symbol("internal response"),REDIRECTS=new Set([301,302,303,307,308]);function handleMiddlewareField(e,t){var s;if(null==e||null==(s=e.request)?void 0:s.headers){if(!(e.request.headers instanceof Headers))throw Object.defineProperty(new Error("request.headers must be an instance of Headers"),"__NEXT_ERROR_CODE",{value:"E119",enumerable:!1,configurable:!0});const s=[];for(const[r,o]of e.request.headers)t.set("x-middleware-request-"+r,o),s.push(r);t.set("x-middleware-override-headers",s.join(","))}}class NextResponse extends Response{constructor(e,t={}){super(e,t);const s=this.headers,r=new _cookies1.ResponseCookies(s),o=new Proxy(r,{get(e,r,o){switch(r){case"delete":case"set":return(...o)=>{const n=Reflect.apply(e[r],e,o),i=new Headers(s);return n instanceof _cookies1.ResponseCookies&&s.set("x-middleware-set-cookie",n.getAll().map((e=>(0,_cookies.stringifyCookie)(e))).join(",")),handleMiddlewareField(t,i),n};default:return _reflect.ReflectAdapter.get(e,r,o)}}});this[INTERNALS]={cookies:o,url:t.url?new _nexturl.NextURL(t.url,{headers:(0,_utils.toNodeOutgoingHttpHeaders)(s),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[INTERNALS].cookies}static json(e,t){const s=Response.json(e,t);return new NextResponse(s.body,s)}static redirect(e,t){const s="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!REDIRECTS.has(s))throw Object.defineProperty(new RangeError('Failed to execute "redirect" on "response": Invalid status code'),"__NEXT_ERROR_CODE",{value:"E529",enumerable:!1,configurable:!0});const r="object"==typeof t?t:{},o=new Headers(null==r?void 0:r.headers);return o.set("Location",(0,_utils.validateURL)(e)),new NextResponse(null,{...r,headers:o,status:s})}static rewrite(e,t){const s=new Headers(null==t?void 0:t.headers);return s.set("x-middleware-rewrite",(0,_utils.validateURL)(e)),handleMiddlewareField(t,s),new NextResponse(null,{...t,headers:s})}static next(e){const t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),handleMiddlewareField(e,t),new NextResponse(null,{...e,headers:t})}}