"use strict";function _export(e,t){for(var o in t)Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{ignoreLoggingIncomingRequests:function(){return ignoreLoggingIncomingRequests},logRequests:function(){return logRequests}});const _picocolors=require("../../lib/picocolors"),_url=require("../../lib/url"),_requestmeta=require("../request-meta");function ignoreLoggingIncomingRequests(e,t){var o;if("boolean"==typeof(null==t?void 0:t.incomingRequests))return!t.incomingRequests;const r=null==t||null==(o=t.incomingRequests)?void 0:o.ignore;return!!r&&r.some((t=>t.test(e.url)))}function logRequests(e){const{request:t,response:o,loggingConfig:r,requestDurationInMs:n}=e;if(ignoreLoggingIncomingRequests(t,r)||logIncomingRequests({request:t,requestDurationInMs:n,statusCode:o.statusCode}),t.fetchMetrics)for(const e of t.fetchMetrics)logFetchMetric(e,r)}function logIncomingRequests(e){const{request:t,requestDurationInMs:o,statusCode:r}=e,n=(0,_requestmeta.getRequestMeta)(t,"isRSCRequest")?(0,_url.stripNextRscUnionQuery)(t.url):t.url,s=(r<200?_picocolors.white:r<300?_picocolors.green:r<400?_picocolors.blue:r<500?_picocolors.yellow:_picocolors.red)(r.toString());return writeLine(`${t.method} ${n} ${s} in ${o}ms`)}function logFetchMetric(e,t){var o;let{cacheReason:r,cacheStatus:n,cacheWarning:s,end:i,method:c,start:u,status:l,url:a}=e;("hmr"!==n||(null==t||null==(o=t.fetches)?void 0:o.hmrRefreshes))&&((null==t?void 0:t.fetches)?(a.length>48&&!t.fetches.fullUrl&&(a=truncateUrl(a)),writeLine((0,_picocolors.white)(`${c} ${a} ${l} in ${Math.round(i-u)}ms ${formatCacheStatus(n)}`),1),"skip"!==n&&"miss"!==n||writeLine((0,_picocolors.gray)(`Cache ${"skip"===n?"skipped":"missed"} reason: (${(0,_picocolors.white)(r)})`),2)):s&&writeLine((0,_picocolors.white)(`${c} ${a}`),1),s&&writeLine(`${(0,_picocolors.yellow)((0,_picocolors.bold)("⚠"))} ${(0,_picocolors.white)(s)}`,2))}function writeLine(e,t=0){process.stdout.write(` ${"│ ".repeat(t)}${e}\n`)}function truncate(e,t){return void 0!==t&&e.length>t?e.substring(0,t)+"..":e}function truncateUrl(e){const{protocol:t,host:o,pathname:r,search:n}=new URL(e);return t+"//"+truncate(o,16)+truncate(r,24)+truncate(n,16)}function formatCacheStatus(e){switch(e){case"hmr":return(0,_picocolors.green)("(HMR cache)");case"hit":return(0,_picocolors.green)("(cache hit)");default:return(0,_picocolors.yellow)(`(cache ${e})`)}}