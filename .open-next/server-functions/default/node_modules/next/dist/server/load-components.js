"use strict";function _export(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{evalManifestWithRetries:function(){return evalManifestWithRetries},loadComponents:function(){return loadComponents},loadManifestWithRetries:function(){return loadManifestWithRetries},tryLoadManifestWithRetries:function(){return tryLoadManifestWithRetries}});const _constants=require("../shared/lib/constants"),_path=require("path"),_require=require("./require"),_interopdefault=require("../lib/interop-default"),_tracer=require("./lib/trace/tracer"),_constants1=require("./lib/trace/constants"),_loadmanifest=require("./load-manifest"),_wait=require("../lib/wait"),_encryptionutils=require("./app-render/encryption-utils"),_actionutils=require("./app-render/action-utils"),_normalizepagepath=require("../shared/lib/page-path/normalize-page-path");async function loadManifestWithRetries(e,t=3){for(;;)try{return(0,_loadmanifest.loadManifest)(e)}catch(e){if(--t<=0)throw e;await(0,_wait.wait)(100)}}async function tryLoadManifestWithRetries(e,t=3){try{return await loadManifestWithRetries(e,t)}catch(e){return}}async function evalManifestWithRetries(e,t=3){for(;;)try{return(0,_loadmanifest.evalManifest)(e)}catch(e){if(--t<=0)throw e;await(0,_wait.wait)(100)}}async function tryLoadClientReferenceManifest(e,t,a){try{return(await evalManifestWithRetries(e,a)).__RSC_MANIFEST[t]}catch(e){return}}async function loadComponentsImpl({distDir:e,page:t,isAppPath:a,isDev:n,sriEnabled:i}){let r={},s={};a||([r,s]=await Promise.all([(0,_require.requirePage)("/_document",e,!1),(0,_require.requirePage)("/_app",e,!1)]));const o=n?3:1;let c;c=process.env.TURBOPACK?a?(0,_path.join)(e,"server","app",t,_constants.REACT_LOADABLE_MANIFEST):(0,_path.join)(e,"server","pages",(0,_normalizepagepath.normalizePagePath)(t),_constants.REACT_LOADABLE_MANIFEST):(0,_path.join)(e,_constants.REACT_LOADABLE_MANIFEST);const[p,l,u,_,f,d]=await Promise.all([loadManifestWithRetries((0,_path.join)(e,_constants.BUILD_MANIFEST),o),tryLoadManifestWithRetries(c,o),a||process.env.TURBOPACK?void 0:loadManifestWithRetries((0,_path.join)(e,`${_constants.DYNAMIC_CSS_MANIFEST}.json`),o).catch((()=>{})),a?tryLoadClientReferenceManifest((0,_path.join)(e,"server","app",t.replace(/%5F/g,"_")+"_"+_constants.CLIENT_REFERENCE_MANIFEST+".js"),t.replace(/%5F/g,"_"),o):void 0,a?loadManifestWithRetries((0,_path.join)(e,"server",_constants.SERVER_REFERENCE_MANIFEST+".json"),o).catch((()=>null)):null,i?loadManifestWithRetries((0,_path.join)(e,"server",_constants.SUBRESOURCE_INTEGRITY_MANIFEST+".json")).catch((()=>{})):void 0]);f&&_&&(0,_encryptionutils.setReferenceManifestsSingleton)({page:t,clientReferenceManifest:_,serverActionsManifest:f,serverModuleMap:(0,_actionutils.createServerModuleMap)({serverActionsManifest:f})});const M=await(0,_require.requirePage)(t,e,a),h=(0,_interopdefault.interopDefault)(M),R=(0,_interopdefault.interopDefault)(r),E=(0,_interopdefault.interopDefault)(s),{getServerSideProps:g,getStaticProps:A,getStaticPaths:S,routeModule:m}=M;return{App:E,Document:R,Component:h,buildManifest:p,subresourceIntegrityManifest:d,reactLoadableManifest:l||{},dynamicCssManifest:u,pageConfig:M.config||{},ComponentMod:M,getServerSideProps:g,getStaticProps:A,getStaticPaths:S,clientReferenceManifest:_,serverActionsManifest:f,isAppPath:a,page:t,routeModule:m}}const loadComponents=(0,_tracer.getTracer)().wrap(_constants1.LoadComponentsSpan.loadComponents,loadComponentsImpl);