"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{getCloneableBody:function(){return getCloneableBody},requestToBodyStream:function(){return requestToBodyStream}});const _stream=require("stream");function requestToBodyStream(e,r,t){return new e.ReadableStream({start:async e=>{for await(const o of t)e.enqueue(new r(o));e.close()}})}function replaceRequestBody(e,r){for(const t in r){let o=r[t];"function"==typeof o&&(o=o.bind(e)),e[t]=o}return e}function getCloneableBody(e){let r=null;const t=new Promise(((r,t)=>{e.on("end",r),e.on("error",t)})).catch((e=>({error:e})));return{async finalize(){if(r){const o=await t;if(o&&"object"==typeof o&&o.error)throw o.error;replaceRequestBody(e,r),r=e}},cloneBodyStream(){const t=r??e,o=new _stream.PassThrough,n=new _stream.PassThrough;return t.on("data",(e=>{o.push(e),n.push(e)})),t.on("end",(()=>{o.push(null),n.push(null)})),r=n,o}}}