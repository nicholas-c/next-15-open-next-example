"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"createDedupeFetch",{enumerable:!0,get:function(){return createDedupeFetch}});const _react=_interop_require_wildcard(require("react")),_cloneresponse=require("./clone-response"),_invarianterror=require("../../shared/lib/invariant-error");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interop_require_wildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var i=o?Object.getOwnPropertyDescriptor(e,c):null;i&&(i.get||i.set)?Object.defineProperty(n,c,i):n[c]=e[c]}return n.default=e,t&&t.set(e,n),n}const simpleCacheKey='["GET",[],null,"follow",null,null,null,null]';function generateCacheKey(e){return JSON.stringify([e.method,Array.from(e.headers.entries()),e.mode,e.redirect,e.credentials,e.referrer,e.referrerPolicy,e.integrity])}function createDedupeFetch(e){const r=_react.cache((e=>[]));return function(t,n){if(n&&n.signal)return e(t,n);let o,c;if("string"!=typeof t||n){const r="string"==typeof t||t instanceof URL?new Request(t,n):t;if("GET"!==r.method&&"HEAD"!==r.method||r.keepalive)return e(t,n);c=generateCacheKey(r),o=r.url}else c=simpleCacheKey,o=t;const i=r(o);for(let e=0,r=i.length;e<r;e+=1){const[r,t]=i[e];if(r===c)return t.then((()=>{const r=i[e][2];if(!r)throw Object.defineProperty(new _invarianterror.InvariantError("No cached response"),"__NEXT_ERROR_CODE",{value:"E579",enumerable:!1,configurable:!0});const[t,n]=(0,_cloneresponse.cloneResponse)(r);return i[e][2]=n,t}))}const u=e(t,n),a=[c,u,null];return i.push(a),u.then((e=>{const[r,t]=(0,_cloneresponse.cloneResponse)(e);return a[2]=t,r}))}}