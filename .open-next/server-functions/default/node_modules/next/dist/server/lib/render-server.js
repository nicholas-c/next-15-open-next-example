"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{clearAllModuleContexts:function(){return clearAllModuleContexts},clearModuleContext:function(){return clearModuleContext},getServerField:function(){return getServerField},initialize:function(){return initialize},propagateServerField:function(){return propagateServerField}});const _next=_interop_require_default(require("../next"));function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}let sandboxContext,initializations={};function clearAllModuleContexts(){return null==sandboxContext?void 0:sandboxContext.clearAllModuleContexts()}function clearModuleContext(e){return null==sandboxContext?void 0:sandboxContext.clearModuleContext(e)}async function getServerField(e,t){const r=await initializations[e];if(!r)throw Object.defineProperty(new Error("Invariant cant propagate server field, no app initialized"),"__NEXT_ERROR_CODE",{value:"E116",enumerable:!1,configurable:!0});const{server:n}=r;return n.server[t]}async function propagateServerField(e,t,r){const n=await initializations[e];if(!n)throw Object.defineProperty(new Error("Invariant cant propagate server field, no app initialized"),"__NEXT_ERROR_CODE",{value:"E116",enumerable:!1,configurable:!0});const{server:i}=n;let o=i.server;const a=t;o&&("function"==typeof o[a]?await o[a].apply(o,Array.isArray(r)?r:[]):o[a]=r)}async function initializeImpl(e){const t=process.env.__NEXT_PRIVATE_RENDER_WORKER;let r,n;t&&(process.title="next-render-worker-"+t);const i=(0,_next.default)({...e,hostname:e.hostname||"localhost",customServer:!1,httpServer:e.server,port:e.port});return r=i.getRequestHandler(),n=i.getUpgradeHandler(),await i.prepare(e.serverFields),{requestHandler:r,upgradeHandler:n,server:i,closeUpgraded(){var t;null==(t=e.bundlerService)||t.close()}}}async function initialize(e){return initializations[e.dir]?initializations[e.dir]:initializations[e.dir]=initializeImpl(e)}"production"!==process.env.NODE_ENV&&(sandboxContext=require("../web/sandbox/context"));