"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{MockedRequest:function(){return MockedRequest},MockedResponse:function(){return MockedResponse},createRequestResponseMocks:function(){return createRequestResponseMocks}});const _stream=_interop_require_default(require("stream")),_utils=require("../web/utils");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}class MockedRequest extends _stream.default.Readable{constructor({url:e,headers:r,method:t,socket:o=null,readable:n}){super(),this.httpVersion="1.0",this.httpVersionMajor=1,this.httpVersionMinor=0,this.socket=new Proxy({},{get:(e,r)=>{if("encrypted"!==r&&"remoteAddress"!==r)throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0});if("remoteAddress"!==r)return!1}}),this.url=e,this.headers=r,this.method=t,n&&(this.bodyReadable=n,this.bodyReadable.on("end",(()=>this.emit("end"))),this.bodyReadable.on("close",(()=>this.emit("close")))),o&&(this.socket=o)}get headersDistinct(){const e={};for(const[r,t]of Object.entries(this.headers))t&&(e[r]=Array.isArray(t)?t:[t]);return e}_read(e){if(this.bodyReadable)return this.bodyReadable._read(e);this.emit("end"),this.emit("close")}get connection(){return this.socket}get aborted(){throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0})}get complete(){throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0})}get trailers(){throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0})}get trailersDistinct(){throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0})}get rawTrailers(){throw Object.defineProperty(new Error("Method not implemented"),"__NEXT_ERROR_CODE",{value:"E52",enumerable:!1,configurable:!0})}get rawHeaders(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}setTimeout(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}}class MockedResponse extends _stream.default.Writable{constructor(e={}){super(),this.statusMessage="",this.finished=!1,this.headersSent=!1,this.buffers=[],this.statusCode=e.statusCode??200,this.socket=e.socket??null,this.headers=e.headers?(0,_utils.fromNodeOutgoingHttpHeaders)(e.headers):new Headers,this.headPromise=new Promise((e=>{this.headPromiseResolve=e})),this.hasStreamed=new Promise(((e,r)=>{this.on("finish",(()=>e(!0))),this.on("end",(()=>e(!0))),this.on("error",(e=>r(e)))})).then((e=>(null==this.headPromiseResolve||this.headPromiseResolve.call(this),e))),e.resWriter&&(this.resWriter=e.resWriter)}appendHeader(e,r){const t=Array.isArray(r)?r:[r];for(const r of t)this.headers.append(e,r);return this}get isSent(){return this.finished||this.headersSent}get connection(){return this.socket}write(e){return this.resWriter?this.resWriter(e):(this.buffers.push(Buffer.isBuffer(e)?e:Buffer.from(e)),!0)}end(){return this.finished=!0,super.end(...arguments)}_implicitHeader(){}_write(e,r,t){this.write(e),t()}writeHead(e,r,t){if(t||"string"==typeof r?"string"==typeof r&&r.length>0&&(this.statusMessage=r):t=r,t)if(Array.isArray(t))for(let e=0;e<t.length;e+=2)this.setHeader(t[e],t[e+1]);else for(const[e,r]of Object.entries(t))void 0!==r&&this.setHeader(e,r);return this.statusCode=e,this.headersSent=!0,null==this.headPromiseResolve||this.headPromiseResolve.call(this),this}hasHeader(e){return this.headers.has(e)}getHeader(e){return this.headers.get(e)??void 0}getHeaders(){return(0,_utils.toNodeOutgoingHttpHeaders)(this.headers)}getHeaderNames(){return Array.from(this.headers.keys())}setHeader(e,r){if(Array.isArray(r)){this.headers.delete(e);for(const t of r)this.headers.append(e,t)}else"number"==typeof r?this.headers.set(e,r.toString()):this.headers.set(e,r);return this}removeHeader(e){this.headers.delete(e)}flushHeaders(){}get strictContentLength(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}writeEarlyHints(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get req(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}assignSocket(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}detachSocket(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}writeContinue(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}writeProcessing(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get upgrading(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get chunkedEncoding(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get shouldKeepAlive(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get useChunkedEncodingByDefault(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}get sendDate(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}setTimeout(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}addTrailers(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}setHeaders(){throw Object.defineProperty(new Error("Method not implemented."),"__NEXT_ERROR_CODE",{value:"E41",enumerable:!1,configurable:!0})}}function createRequestResponseMocks({url:e,headers:r={},method:t="GET",bodyReadable:o,resWriter:n,socket:s=null}){return{req:new MockedRequest({url:e,headers:r,method:t,socket:s,readable:o}),res:new MockedResponse({socket:s,resWriter:n})}}