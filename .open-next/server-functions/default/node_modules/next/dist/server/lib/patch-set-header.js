"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"patchSetHeaderWithCookieSupport",{enumerable:!0,get:function(){return patchSetHeaderWithCookieSupport}});const _requestmeta=require("../request-meta");function patchSetHeaderWithCookieSupport(e,t){const r=t.setHeader.bind(t);t.setHeader=(o,a)=>{if("headersSent"in t&&t.headersSent)return t;if("set-cookie"===o.toLowerCase()){const t=(0,_requestmeta.getRequestMeta)(e,"middlewareCookie");t&&Array.isArray(a)&&a.every(((e,r)=>e===t[r]))||(a=[...new Set([...t||[],..."string"==typeof a?[a]:Array.isArray(a)?a:[]])])}return r(o,a)}}