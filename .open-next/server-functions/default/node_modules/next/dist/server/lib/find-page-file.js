"use strict";function _export(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createValidFileMatcher:function(){return createValidFileMatcher},findPageFile:function(){return findPageFile}});const _fileexists=require("../../lib/file-exists"),_getpagepaths=require("../../shared/lib/page-path/get-page-paths"),_nonnullable=require("../../lib/non-nullable"),_path=require("path"),_fs=require("fs"),_log=require("../../build/output/log"),_picocolors=require("../../lib/picocolors"),_ismetadataroute=require("../../lib/metadata/is-metadata-route");async function isTrueCasePagePath(e,t){const a=(0,_path.normalize)(e).split(_path.sep).filter(Boolean),i=a.map((async(e,i)=>{const n=(0,_path.join)(t,...a.slice(0,i));return(await _fs.promises.readdir(n)).includes(e)}));return(await Promise.all(i)).every(Boolean)}async function findPageFile(e,t,a,i){const n=(0,_getpagepaths.getPagePaths)(t,a,i),[r,...o]=(await Promise.all(n.map((async t=>{const a=(0,_path.join)(e,t);try{return await(0,_fileexists.fileExists)(a)?t:null}catch(e){var i;if(!(null==e||null==(i=e.code)?void 0:i.includes("ENOTDIR")))throw e}return null})))).filter(_nonnullable.nonNullable);return r&&await isTrueCasePagePath(r,e)?(o.length>0&&(0,_log.warn)(`Duplicate page detected. ${(0,_picocolors.cyan)((0,_path.join)("pages",r))} and ${(0,_picocolors.cyan)((0,_path.join)("pages",o[0]))} both resolve to ${(0,_picocolors.cyan)(t)}.`),r):null}function createValidFileMatcher(e,t){const a=e=>`(?:${e.join("|")})`,i=new RegExp("\\."+a(e)+"$"),n=new RegExp(`(^(page|route)|[\\\\/](page|route))\\.${a(e)}$`),r=new RegExp(`^not-found\\.${a(e)}$`);function o(a){const i=t?a.replace(t,""):a;return(0,_ismetadataroute.isMetadataRouteFile)(i,e,!0)}function l(e){return n.test(e)||o(e)}function s(e){return i.test(e)||o(e)}function u(e){if(!t)return!1;if(!e.startsWith(t+_path.sep))return!1;const a=e.slice(t.length+1);return r.test(a)}return{isPageFile:s,isAppRouterPage:l,isMetadataFile:o,isRootNotFound:u}}