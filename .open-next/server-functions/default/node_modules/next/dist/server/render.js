"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{errorToJSON:function(){return errorToJSON},renderToHTML:function(){return renderToHTML},renderToHTMLImpl:function(){return renderToHTMLImpl}});const _jsxruntime=require("react/jsx-runtime"),_apiutils=require("./api-utils"),_getcookieparser=require("./api-utils/get-cookie-parser"),_react=_interop_require_default(require("react")),_ReactDOMServerPages=_interop_require_default(require("next/dist/server/ReactDOMServerPages")),_styledjsx=require("styled-jsx"),_constants=require("../lib/constants"),_constants1=require("../shared/lib/constants"),_isserializableprops=require("../lib/is-serializable-props"),_ampmode=require("../shared/lib/amp-mode"),_ampcontextsharedruntime=require("../shared/lib/amp-context.shared-runtime"),_head=require("../shared/lib/head"),_headmanagercontextsharedruntime=require("../shared/lib/head-manager-context.shared-runtime"),_loadablesharedruntime=_interop_require_default(require("../shared/lib/loadable.shared-runtime")),_loadablecontextsharedruntime=require("../shared/lib/loadable-context.shared-runtime"),_routercontextsharedruntime=require("../shared/lib/router-context.shared-runtime"),_isdynamic=require("../shared/lib/router/utils/is-dynamic"),_utils=require("../shared/lib/utils"),_htmlcontextsharedruntime=require("../shared/lib/html-context.shared-runtime"),_normalizepagepath=require("../shared/lib/page-path/normalize-page-path"),_denormalizepagepath=require("../shared/lib/page-path/denormalize-page-path"),_requestmeta=require("./request-meta"),_redirectstatus=require("../lib/redirect-status"),_renderresult=_interop_require_default(require("./render-result")),_iserror=_interop_require_default(require("../lib/is-error")),_nodewebstreamshelper=require("./stream-utils/node-web-streams-helper"),_imageconfigcontextsharedruntime=require("../shared/lib/image-config-context.shared-runtime"),_stripansi=_interop_require_default(require("next/dist/compiled/strip-ansi")),_internalutils=require("./internal-utils"),_adapters=require("../shared/lib/router/adapters"),_approutercontextsharedruntime=require("../shared/lib/app-router-context.shared-runtime"),_hooksclientcontextsharedruntime=require("../shared/lib/hooks-client-context.shared-runtime"),_tracer=require("./lib/trace/tracer"),_constants2=require("./lib/trace/constants"),_reflect=require("./web/spec-extension/adapters/reflect"),_revalidate=require("./lib/revalidate"),_errorsource=require("../shared/lib/error-source");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}let tryGetPreviewData,warn,postProcessHTML;const DOCTYPE="<!DOCTYPE html>";function noRouter(){const e='No router instance found. you should only use "next/router" inside the client side of your app. https://nextjs.org/docs/messages/no-router-instance';throw Object.defineProperty(new Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}async function renderToString(e){const r=await _ReactDOMServerPages.default.renderToReadableStream(e);return await r.allReady,(0,_nodewebstreamshelper.streamToString)(r)}"edge"!==process.env.NEXT_RUNTIME?(tryGetPreviewData=require("./api-utils/node/try-get-preview-data").tryGetPreviewData,warn=require("../build/output/log").warn,postProcessHTML=require("./post-process").postProcessHTML):(warn=console.warn.bind(console),postProcessHTML=async(e,r)=>r);class ServerRouter{constructor(e,r,t,{isFallback:a},n,o,s,i,l,d,u,c){this.route=e.replace(/\/$/,"")||"/",this.pathname=e,this.query=r,this.asPath=t,this.isFallback=a,this.basePath=o,this.locale=s,this.locales=i,this.defaultLocale=l,this.isReady=n,this.domainLocales=d,this.isPreview=!!u,this.isLocaleDomain=!!c}push(){noRouter()}replace(){noRouter()}reload(){noRouter()}back(){noRouter()}forward(){noRouter()}prefetch(){noRouter()}beforePopState(){noRouter()}}function enhanceComponents(e,r,t){return"function"==typeof e?{App:r,Component:e(t)}:{App:e.enhanceApp?e.enhanceApp(r):r,Component:e.enhanceComponent?e.enhanceComponent(t):t}}function renderPageTree(e,r,t){return(0,_jsxruntime.jsx)(e,{Component:r,...t})}const invalidKeysMsg=(e,r)=>{const t=`invalid-${e.toLocaleLowerCase()}-value`;return`Additional keys were returned from \`${e}\`. Properties intended for your component must be nested under the \`props\` key, e.g.:\n\n\treturn { props: { title: 'My Title', content: '...' } }\n\nKeys that need to be moved: ${r.join(", ")}.\nRead more: https://nextjs.org/docs/messages/${t}`};function checkRedirectValues(e,r,t){const{destination:a,permanent:n,statusCode:o,basePath:s}=e;let i=[];const l=void 0!==o,d=void 0!==n;d&&l?i.push("`permanent` and `statusCode` can not both be provided"):d&&"boolean"!=typeof n?i.push("`permanent` must be `true` or `false`"):l&&!_redirectstatus.allowedStatusCodes.has(o)&&i.push(`\`statusCode\` must undefined or one of ${[..._redirectstatus.allowedStatusCodes].join(", ")}`);const u=typeof a;"string"!==u&&i.push(`\`destination\` should be string but received ${u}`);const c=typeof s;if("undefined"!==c&&"boolean"!==c&&i.push(`\`basePath\` should be undefined or a false, received ${c}`),i.length>0)throw Object.defineProperty(new Error(`Invalid redirect object returned from ${t} for ${r.url}\n`+i.join(" and ")+"\nSee more info here: https://nextjs.org/docs/messages/invalid-redirect-gssp"),"__NEXT_ERROR_CODE",{value:"E185",enumerable:!1,configurable:!0})}function errorToJSON(e){let r="server";return"edge"!==process.env.NEXT_RUNTIME&&(r=(0,_errorsource.getErrorSource)(e)||"server"),{name:e.name,source:r,message:(0,_stripansi.default)(e.message),stack:e.stack,digest:e.digest}}function serializeError(e,r){return e?errorToJSON(r):{name:"Internal Server Error.",message:"500 - Internal Server Error.",statusCode:500}}async function renderToHTMLImpl(e,r,t,a,n,o,s,i){(0,_apiutils.setLazyProp)({req:e},"cookies",(0,_getcookieparser.getCookieParser)(e.headers));const l={};if(l.assetQueryString=n.dev&&n.assetQueryString||"",n.dev&&!l.assetQueryString){const r=(e.headers["user-agent"]||"").toLowerCase();r.includes("safari")&&!r.includes("chrome")&&(l.assetQueryString=`?ts=${Date.now()}`)}s.deploymentId&&(l.assetQueryString+=`${l.assetQueryString?"&":"?"}dpl=${s.deploymentId}`),a=Object.assign({},a);const{err:d,dev:u=!1,ampPath:c="",pageConfig:p={},buildManifest:_,reactLoadableManifest:m,ErrorDebug:h,getStaticProps:g,getStaticPaths:f,getServerSideProps:E,isNextDataRequest:b,params:R,previewProps:v,basePath:P,images:x,runtime:T,isExperimentalCompile:O,expireTime:S}=n,{App:w}=o,y=l.assetQueryString;let j=o.Document,N=n.Component;const C=N,D=i.isFallback??!1,I=i.developmentNotFoundSourcePage;(0,_internalutils.stripInternalQueries)(a);const q=!!g,A=q&&n.nextExport,M=w.getInitialProps===w.origGetInitialProps,L=!!(null==N?void 0:N.getInitialProps),$=null==N?void 0:N.unstable_scriptLoader,X=(0,_isdynamic.isDynamicRoute)(t),F="/_error"===t&&N.getInitialProps===N.origGetInitialProps;n.nextExport&&L&&!F&&warn(`Detected getInitialProps on page '${t}' while running export. It's recommended to use getStaticProps which has a more correct behavior for static exporting.\nRead more: https://nextjs.org/docs/messages/get-initial-props-export`);let k=!L&&M&&!q&&!E;if(k&&!u&&O&&(r.setHeader("Cache-Control",(0,_revalidate.formatRevalidate)({revalidate:!1,expireTime:S})),k=!1),L&&q)throw Object.defineProperty(new Error(_constants.SSG_GET_INITIAL_PROPS_CONFLICT+` ${t}`),"__NEXT_ERROR_CODE",{value:"E262",enumerable:!1,configurable:!0});if(L&&E)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_GET_INIT_PROPS_CONFLICT+` ${t}`),"__NEXT_ERROR_CODE",{value:"E262",enumerable:!1,configurable:!0});if(E&&q)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_SSG_CONFLICT+` ${t}`),"__NEXT_ERROR_CODE",{value:"E262",enumerable:!1,configurable:!0});if(E&&"export"===n.nextConfigOutput)throw Object.defineProperty(new Error('getServerSideProps cannot be used with "output: export". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'),"__NEXT_ERROR_CODE",{value:"E369",enumerable:!1,configurable:!0});if(f&&!X)throw Object.defineProperty(new Error(`getStaticPaths is only allowed for dynamic SSG pages and was found on '${t}'.\nRead more: https://nextjs.org/docs/messages/non-dynamic-getstaticpaths-usage`),"__NEXT_ERROR_CODE",{value:"E187",enumerable:!1,configurable:!0});if(f&&!q)throw Object.defineProperty(new Error(`getStaticPaths was added without a getStaticProps in ${t}. Without getStaticProps, getStaticPaths does nothing`),"__NEXT_ERROR_CODE",{value:"E447",enumerable:!1,configurable:!0});if(q&&X&&!f)throw Object.defineProperty(new Error(`getStaticPaths is required for dynamic SSG pages and is missing for '${t}'.\nRead more: https://nextjs.org/docs/messages/invalid-getstaticpaths-value`),"__NEXT_ERROR_CODE",{value:"E255",enumerable:!1,configurable:!0});let z,H,G=n.resolvedAsPath||e.url;if(u){const{isValidElementType:r}=require("next/dist/compiled/react-is");if(!r(N))throw Object.defineProperty(new Error(`The default export is not a React Component in page: "${t}"`),"__NEXT_ERROR_CODE",{value:"E286",enumerable:!1,configurable:!0});if(!r(w))throw Object.defineProperty(new Error('The default export is not a React Component in page: "/_app"'),"__NEXT_ERROR_CODE",{value:"E464",enumerable:!1,configurable:!0});if(!r(j))throw Object.defineProperty(new Error('The default export is not a React Component in page: "/_document"'),"__NEXT_ERROR_CODE",{value:"E511",enumerable:!1,configurable:!0});if((k||D)&&(a={...a.amp?{amp:a.amp}:{}},G=`${t}${e.url.endsWith("/")&&"/"!==t&&!X?"/":""}`,e.url=t),"/404"===t&&(L||E))throw Object.defineProperty(new Error(`\`pages/404\` ${_constants.STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`),"__NEXT_ERROR_CODE",{value:"E134",enumerable:!1,configurable:!0});if(_constants1.STATIC_STATUS_PAGES.includes(t)&&(L||E))throw Object.defineProperty(new Error(`\`pages${t}\` ${_constants.STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR}`),"__NEXT_ERROR_CODE",{value:"E125",enumerable:!1,configurable:!0});(null==n?void 0:n.setIsrStatus)&&n.setIsrStatus(G,!(!q&&!k)||null)}for(const e of["getStaticProps","getServerSideProps","getStaticPaths"])if(null==N?void 0:N[e])throw Object.defineProperty(new Error(`page ${t} ${e} ${_constants.GSSP_COMPONENT_MEMBER_ERROR}`),"__NEXT_ERROR_CODE",{value:"E417",enumerable:!1,configurable:!0});await _loadablesharedruntime.default.preloadAll(),(q||E)&&!D&&"edge"!==process.env.NEXT_RUNTIME&&v&&(H=tryGetPreviewData(e,r,v,!!n.multiZoneDraftMode),z=!1!==H);const U=new ServerRouter(t,a,G,{isFallback:D},!!(E||L||!M&&!q||O),P,n.locale,n.locales,n.defaultLocale,n.domainLocales,z,(0,_requestmeta.getRequestMeta)(e,"isLocaleDomain")),V=(0,_adapters.adaptForAppRouterInstance)(U);let B={};const J=(0,_styledjsx.createStyleRegistry)(),Q={ampFirst:!0===p.amp,hasQuery:Boolean(a.amp),hybrid:"hybrid"===p.amp},W="edge"!==process.env.NEXT_RUNTIME&&(0,_ampmode.isInAmpMode)(Q);let Y=(0,_head.defaultHead)(W);const K=[];let Z={};$&&(Z.beforeInteractive=[].concat($()).filter((e=>"beforeInteractive"===e.props.strategy)).map((e=>e.props)));const ee=({children:e})=>(0,_jsxruntime.jsx)(_approutercontextsharedruntime.AppRouterContext.Provider,{value:V,children:(0,_jsxruntime.jsx)(_hooksclientcontextsharedruntime.SearchParamsContext.Provider,{value:(0,_adapters.adaptForSearchParams)(U),children:(0,_jsxruntime.jsx)(_adapters.PathnameContextProviderAdapter,{router:U,isAutoExport:k,children:(0,_jsxruntime.jsx)(_hooksclientcontextsharedruntime.PathParamsContext.Provider,{value:(0,_adapters.adaptForPathParams)(U),children:(0,_jsxruntime.jsx)(_routercontextsharedruntime.RouterContext.Provider,{value:U,children:(0,_jsxruntime.jsx)(_ampcontextsharedruntime.AmpStateContext.Provider,{value:Q,children:(0,_jsxruntime.jsx)(_headmanagercontextsharedruntime.HeadManagerContext.Provider,{value:{updateHead:e=>{Y=e},updateScripts:e=>{B=e},scripts:Z,mountedInstances:new Set},children:(0,_jsxruntime.jsx)(_loadablecontextsharedruntime.LoadableContext.Provider,{value:e=>K.push(e),children:(0,_jsxruntime.jsx)(_styledjsx.StyleRegistry,{registry:J,children:(0,_jsxruntime.jsx)(_imageconfigcontextsharedruntime.ImageConfigContext.Provider,{value:x,children:e})})})})})})})})})}),re=()=>null,te=({children:e})=>(0,_jsxruntime.jsxs)(_jsxruntime.Fragment,{children:[(0,_jsxruntime.jsx)(re,{}),(0,_jsxruntime.jsx)(ee,{children:(0,_jsxruntime.jsxs)(_jsxruntime.Fragment,{children:[u?(0,_jsxruntime.jsxs)(_jsxruntime.Fragment,{children:[e,(0,_jsxruntime.jsx)(re,{})]}):e,(0,_jsxruntime.jsx)(re,{})]})})]}),ae={err:d,req:k?void 0:e,res:k?void 0:r,pathname:t,query:a,asPath:G,locale:n.locale,locales:n.locales,defaultLocale:n.defaultLocale,AppTree:e=>(0,_jsxruntime.jsx)(te,{children:renderPageTree(w,C,{...e,router:U})}),defaultGetInitialProps:async(e,r={})=>{const t=e=>r=>(0,_jsxruntime.jsx)(e,{...r}),{html:a,head:n}=await e.renderPage({enhanceApp:t}),o=J.styles({nonce:r.nonce});return J.flush(),{html:a,head:n,styles:o}}};let ne;const oe=!q&&(n.nextExport||u&&(k||D)),se=()=>{const e=J.styles();return J.flush(),(0,_jsxruntime.jsx)(_jsxruntime.Fragment,{children:e})};if(ne=await(0,_utils.loadGetInitialProps)(w,{AppTree:ae.AppTree,Component:N,router:U,ctx:ae}),(q||E)&&z&&(ne.__N_PREVIEW=!0),q&&(ne[_constants1.STATIC_PROPS_ID]=!0),q&&!D){let r;try{r=await(0,_tracer.getTracer)().trace(_constants2.RenderSpan.getStaticProps,{spanName:`getStaticProps ${t}`,attributes:{"next.route":t}},(()=>g({...X?{params:R}:void 0,...z?{draftMode:!0,preview:!0,previewData:H}:void 0,locales:[...n.locales??[]],locale:n.locale,defaultLocale:n.defaultLocale,revalidateReason:n.isOnDemandRevalidate?"on-demand":A?"build":"stale"})))}catch(e){throw e&&"ENOENT"===e.code&&delete e.code,e}if(null==r)throw Object.defineProperty(new Error(_constants.GSP_NO_RETURNED_VALUE),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});const a=Object.keys(r).filter((e=>"revalidate"!==e&&"props"!==e&&"redirect"!==e&&"notFound"!==e));if(a.includes("unstable_revalidate"))throw Object.defineProperty(new Error(_constants.UNSTABLE_REVALIDATE_RENAME_ERROR),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if(a.length)throw Object.defineProperty(new Error(invalidKeysMsg("getStaticProps",a)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if("production"!==process.env.NODE_ENV&&void 0!==r.notFound&&void 0!==r.redirect)throw Object.defineProperty(new Error(`\`redirect\` and \`notFound\` can not both be returned from ${q?"getStaticProps":"getServerSideProps"} at the same time. Page: ${t}\nSee more info here: https://nextjs.org/docs/messages/gssp-mixed-not-found-redirect`),"__NEXT_ERROR_CODE",{value:"E454",enumerable:!1,configurable:!0});if("notFound"in r&&r.notFound){if("/404"===t)throw Object.defineProperty(new Error('The /404 page can not return notFound in "getStaticProps", please remove it to continue!'),"__NEXT_ERROR_CODE",{value:"E121",enumerable:!1,configurable:!0});l.isNotFound=!0}if("redirect"in r&&r.redirect&&"object"==typeof r.redirect){if(checkRedirectValues(r.redirect,e,"getStaticProps"),A)throw Object.defineProperty(new Error(`\`redirect\` can not be returned from getStaticProps during prerendering (${e.url})\nSee more info here: https://nextjs.org/docs/messages/gsp-redirect-during-prerender`),"__NEXT_ERROR_CODE",{value:"E497",enumerable:!1,configurable:!0});r.props={__N_REDIRECT:r.redirect.destination,__N_REDIRECT_STATUS:(0,_redirectstatus.getRedirectStatus)(r.redirect)},void 0!==r.redirect.basePath&&(r.props.__N_REDIRECT_BASE_PATH=r.redirect.basePath),l.isRedirect=!0}if((u||A)&&!l.isNotFound&&!(0,_isserializableprops.isSerializableProps)(t,"getStaticProps",r.props))throw Object.defineProperty(new Error("invariant: getStaticProps did not return valid props. Please report this."),"__NEXT_ERROR_CODE",{value:"E129",enumerable:!1,configurable:!0});let o;if("revalidate"in r){if(r.revalidate&&"export"===n.nextConfigOutput)throw Object.defineProperty(new Error('ISR cannot be used with "output: export". See more info here: https://nextjs.org/docs/advanced-features/static-html-export'),"__NEXT_ERROR_CODE",{value:"E201",enumerable:!1,configurable:!0});if("number"==typeof r.revalidate){if(!Number.isInteger(r.revalidate))throw Object.defineProperty(new Error(`A page's revalidate option must be seconds expressed as a natural number for ${e.url}. Mixed numbers, such as '${r.revalidate}', cannot be used.\nTry changing the value to '${Math.ceil(r.revalidate)}' or using \`Math.ceil()\` if you're computing the value.`),"__NEXT_ERROR_CODE",{value:"E438",enumerable:!1,configurable:!0});if(r.revalidate<=0)throw Object.defineProperty(new Error(`A page's revalidate option can not be less than or equal to zero for ${e.url}. A revalidate option of zero means to revalidate after _every_ request, and implies stale data cannot be tolerated.\n\nTo never revalidate, you can set revalidate to \`false\` (only ran once at build-time).\nTo revalidate as soon as possible, you can set the value to \`1\`.`),"__NEXT_ERROR_CODE",{value:"E311",enumerable:!1,configurable:!0});r.revalidate>31536e3&&console.warn(`Warning: A page's revalidate option was set to more than a year for ${e.url}. This may have been done in error.\nTo only run getStaticProps at build-time and not revalidate at runtime, you can set \`revalidate\` to \`false\`!`),o=r.revalidate}else if(!0===r.revalidate)o=1;else{if(!1!==r.revalidate&&void 0!==r.revalidate)throw Object.defineProperty(new Error(`A page's revalidate option must be seconds expressed as a natural number. Mixed numbers and strings cannot be used. Received '${JSON.stringify(r.revalidate)}' for ${e.url}`),"__NEXT_ERROR_CODE",{value:"E161",enumerable:!1,configurable:!0});o=!1}}else o=!1;if(ne.pageProps=Object.assign({},ne.pageProps,"props"in r?r.props:void 0),l.revalidate=o,l.pageData=ne,l.isNotFound)return new _renderresult.default(null,{metadata:l})}if(E&&(ne[_constants1.SERVER_PROPS_ID]=!0),E&&!D){let o,s=!0,i=r,d=!1;"production"!==process.env.NODE_ENV&&(i=new Proxy(r,{get:function(e,t){if(!s){const e="You should not access 'res' after getServerSideProps resolves.\nRead more: https://nextjs.org/docs/messages/gssp-no-mutating-res";if(d)throw Object.defineProperty(new Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});warn(e)}return _reflect.ReflectAdapter.get(e,t,r)}}));try{o=await(0,_tracer.getTracer)().trace(_constants2.RenderSpan.getServerSideProps,{spanName:`getServerSideProps ${t}`,attributes:{"next.route":t}},(async()=>E({req:e,res:i,query:a,resolvedUrl:n.resolvedUrl,...X?{params:R}:void 0,...!1!==H?{draftMode:!0,preview:!0,previewData:H}:void 0,locales:[...n.locales??[]],locale:n.locale,defaultLocale:n.defaultLocale}))),s=!1,l.revalidate=0}catch(e){throw(0,_iserror.default)(e)&&"ENOENT"===e.code&&delete e.code,e}if(null==o)throw Object.defineProperty(new Error(_constants.GSSP_NO_RETURNED_VALUE),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});o.props instanceof Promise&&(d=!0);const c=Object.keys(o).filter((e=>"props"!==e&&"redirect"!==e&&"notFound"!==e));if(o.unstable_notFound)throw Object.defineProperty(new Error(`unstable_notFound has been renamed to notFound, please update the field to continue. Page: ${t}`),"__NEXT_ERROR_CODE",{value:"E516",enumerable:!1,configurable:!0});if(o.unstable_redirect)throw Object.defineProperty(new Error(`unstable_redirect has been renamed to redirect, please update the field to continue. Page: ${t}`),"__NEXT_ERROR_CODE",{value:"E284",enumerable:!1,configurable:!0});if(c.length)throw Object.defineProperty(new Error(invalidKeysMsg("getServerSideProps",c)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if("notFound"in o&&o.notFound){if("/404"===t)throw Object.defineProperty(new Error('The /404 page can not return notFound in "getStaticProps", please remove it to continue!'),"__NEXT_ERROR_CODE",{value:"E121",enumerable:!1,configurable:!0});return l.isNotFound=!0,new _renderresult.default(null,{metadata:l})}if("redirect"in o&&"object"==typeof o.redirect&&(checkRedirectValues(o.redirect,e,"getServerSideProps"),o.props={__N_REDIRECT:o.redirect.destination,__N_REDIRECT_STATUS:(0,_redirectstatus.getRedirectStatus)(o.redirect)},void 0!==o.redirect.basePath&&(o.props.__N_REDIRECT_BASE_PATH=o.redirect.basePath),l.isRedirect=!0),d&&(o.props=await o.props),(u||A)&&!(0,_isserializableprops.isSerializableProps)(t,"getServerSideProps",o.props))throw Object.defineProperty(new Error("invariant: getServerSideProps did not return valid props. Please report this."),"__NEXT_ERROR_CODE",{value:"E31",enumerable:!1,configurable:!0});ne.pageProps=Object.assign({},ne.pageProps,o.props),l.pageData=ne}if(q||E||"production"===process.env.NODE_ENV||!Object.keys((null==ne?void 0:ne.pageProps)||{}).includes("url")||console.warn(`The prop \`url\` is a reserved prop in Next.js for legacy reasons and will be overridden on page ${t}\nSee more info here: https://nextjs.org/docs/messages/reserved-page-prop`),b&&!q||l.isRedirect)return new _renderresult.default(JSON.stringify(ne),{metadata:l});if(D&&(ne.pageProps={}),(0,_utils.isResSent)(r)&&!q)return new _renderresult.default(null,{metadata:l});let ie=_;if(k&&X){const e=(0,_denormalizepagepath.denormalizePagePath)((0,_normalizepagepath.normalizePagePath)(t));e in ie.pages&&(ie={...ie,pages:{...ie.pages,[e]:[...ie.pages[e],...ie.lowPriorityFiles.filter((e=>e.includes("_buildManifest")))]},lowPriorityFiles:ie.lowPriorityFiles.filter((e=>!e.includes("_buildManifest")))})}const le=({children:e})=>W?e:(0,_jsxruntime.jsx)("div",{id:"__next",children:e}),de=async()=>{const e=j[_constants1.NEXT_BUILTIN_DOCUMENT];if("edge"===process.env.NEXT_RUNTIME&&j.getInitialProps){if(!e)throw Object.defineProperty(new Error("`getInitialProps` in Document component is not supported with the Edge Runtime."),"__NEXT_ERROR_CODE",{value:"E386",enumerable:!1,configurable:!0});j=e}async function t(e){const t=async(r={})=>{if(ae.err&&h){e&&e(w,N);return{html:await renderToString((0,_jsxruntime.jsx)(le,{children:(0,_jsxruntime.jsx)(h,{})})),head:Y}}if(u&&(ne.router||ne.Component))throw Object.defineProperty(new Error("'router' and 'Component' can not be returned in getInitialProps from _app.js https://nextjs.org/docs/messages/cant-override-next-props"),"__NEXT_ERROR_CODE",{value:"E230",enumerable:!1,configurable:!0});const{App:t,Component:a}=enhanceComponents(r,w,N),n=await e(t,a);await n.allReady;return{html:await(0,_nodewebstreamshelper.streamToString)(n),head:Y}},a={...ae,renderPage:t},n=await(0,_utils.loadGetInitialProps)(j,a);if((0,_utils.isResSent)(r)&&!q)return null;if(!n||"string"!=typeof n.html){const e=`"${(0,_utils.getDisplayName)(j)}.getInitialProps()" should resolve to an object with a "html" prop set with a valid html string`;throw Object.defineProperty(new Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}return{docProps:n,documentCtx:a}}const a=(e,r)=>{const t=e||w,a=r||N;return ae.err&&h?(0,_jsxruntime.jsx)(le,{children:(0,_jsxruntime.jsx)(h,{})}):(0,_jsxruntime.jsx)(le,{children:(0,_jsxruntime.jsx)(te,{children:renderPageTree(t,a,{...ne,router:U})})})},n=async(e,r)=>{const t=a(e,r);return await(0,_nodewebstreamshelper.renderToInitialFizzStream)({ReactDOMServer:_ReactDOMServerPages.default,element:t})},o="edge"!==process.env.NEXT_RUNTIME&&!!j.getInitialProps;let s;const[i,l]=await Promise.all([renderToString(se()),(async()=>{if(o){if(s=await t(n),null===s)return null;const{docProps:e}=s;return e.html}{s={};const e=await n(w,N);return await e.allReady,(0,_nodewebstreamshelper.streamToString)(e)}})()]);if(null===l)return null;const d=i+l,{docProps:c}=s||{},p=e=>"edge"===process.env.NEXT_RUNTIME?j():(0,_jsxruntime.jsx)(j,{...e,...c});let _;return o?(_=c.styles,Y=c.head):(_=J.styles(),J.flush()),{contentHTML:d,documentElement:p,head:Y,headTags:[],styles:_}};(0,_tracer.getTracer)().setRootSpanAttribute("next.route",n.page);const ue=await(0,_tracer.getTracer)().trace(_constants2.RenderSpan.renderDocument,{spanName:`render route (pages) ${n.page}`,attributes:{"next.route":n.page}},(async()=>de()));if(!ue)return new _renderresult.default(null,{metadata:l});const ce=new Set,pe=new Set;for(const e of K){const r=m[e];r&&(ce.add(r.id),r.files.forEach((e=>{pe.add(e)})))}const _e=Q.hybrid,me={},{assetPrefix:he,defaultLocale:ge,disableOptimizedLoading:fe,domainLocales:Ee,locale:be,locales:Re,runtimeConfig:ve}=n,Pe={__NEXT_DATA__:{props:ne,page:t,query:a,buildId:s.buildId,assetPrefix:""===he?void 0:he,runtimeConfig:ve,nextExport:!0===oe||void 0,autoExport:!0===k||void 0,isFallback:D,isExperimentalCompile:O,dynamicIds:0===ce.size?void 0:Array.from(ce),err:n.err?serializeError(u,n.err):void 0,gsp:!!g||void 0,gssp:!!E||void 0,customServer:s.customServer,gip:!!L||void 0,appGip:!M||void 0,locale:be,locales:Re,defaultLocale:ge,domainLocales:Ee,isPreview:!0===z||void 0,notFoundSrcPage:I&&u?I:void 0},strictNextHead:n.strictNextHead,buildManifest:ie,docComponentsRendered:me,dangerousAsPath:U.asPath,canonicalBase:!n.ampPath&&(0,_requestmeta.getRequestMeta)(e,"didStripLocale")?`${n.canonicalBase||""}/${n.locale}`:n.canonicalBase,ampPath:c,inAmpMode:W,isDevelopment:!!u,hybridAmp:_e,dynamicImports:Array.from(pe),dynamicCssManifest:new Set(n.dynamicCssManifest||[]),assetPrefix:he,unstable_runtimeJS:"production"===process.env.NODE_ENV?p.unstable_runtimeJS:void 0,unstable_JsPreload:p.unstable_JsPreload,assetQueryString:y,scriptLoader:B,locale:be,disableOptimizedLoading:fe,head:ue.head,headTags:ue.headTags,styles:ue.styles,crossOrigin:n.crossOrigin,optimizeCss:n.optimizeCss,nextConfigOutput:n.nextConfigOutput,nextScriptWorkers:n.nextScriptWorkers,runtime:T,largePageDataBytes:n.largePageDataBytes,nextFontManifest:n.nextFontManifest,experimentalClientTraceMetadata:n.experimental.clientTraceMetadata},xe=(0,_jsxruntime.jsx)(_ampcontextsharedruntime.AmpStateContext.Provider,{value:Q,children:(0,_jsxruntime.jsx)(_htmlcontextsharedruntime.HtmlContext.Provider,{value:Pe,children:ue.documentElement(Pe)})}),Te=await(0,_tracer.getTracer)().trace(_constants2.RenderSpan.renderToString,(async()=>renderToString(xe)));if("production"!==process.env.NODE_ENV){const e=[],r=["Main","Head","NextScript","Html"];for(const t of r)me[t]||e.push(t);if(e.length){const r=e.map((e=>`<${e} />`)).join(", "),t=1!==e.length?"s":"";console.warn(`Your custom Document (pages/_document) did not render all the required subcomponent${t}.\nMissing component${t}: ${r}\nRead how to fix here: https://nextjs.org/docs/messages/missing-document-component`)}}const[Oe,Se]=Te.split("<next-js-internal-body-render-target></next-js-internal-body-render-target>",2);let we="";Te.startsWith(DOCTYPE)||(we+=DOCTYPE),we+=Oe,W&&(we+="\x3c!-- __NEXT_DATA__ --\x3e");const ye=we+ue.contentHTML+Se,je=await postProcessHTML(t,ye,n,{inAmpMode:W,hybridAmp:_e});return new _renderresult.default(je,{metadata:l})}const renderToHTML=(e,r,t,a,n,o,s)=>renderToHTMLImpl(e,r,t,a,n,n,o,s);