"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{sendEtagResponse:function(){return sendEtagResponse},sendRenderResult:function(){return sendRenderResult}});const _utils=require("../shared/lib/utils"),_etag=require("./lib/etag"),_fresh=_interop_require_default(require("next/dist/compiled/fresh")),_revalidate=require("./lib/revalidate"),_approuterheaders=require("../client/components/app-router-headers");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function sendEtagResponse(e,t,r){return r&&t.setHeader("ETag",r),!!(0,_fresh.default)(e.headers,{etag:r})&&(t.statusCode=304,t.end(),!0)}async function sendRenderResult({req:e,res:t,result:r,type:n,generateEtags:s,poweredByHeader:a,revalidate:o,expireTime:i}){if((0,_utils.isResSent)(t))return;a&&"html"===n&&t.setHeader("X-Powered-By","Next.js"),void 0===o||t.getHeader("Cache-Control")||t.setHeader("Cache-Control",(0,_revalidate.formatRevalidate)({revalidate:o,expireTime:i}));const d=r.isDynamic?null:r.toUnchunkedString();if(s&&null!==d){if(sendEtagResponse(e,t,(0,_etag.generateETag)(d)))return}t.getHeader("Content-Type")||t.setHeader("Content-Type",r.contentType?r.contentType:"rsc"===n?_approuterheaders.RSC_CONTENT_TYPE_HEADER:"json"===n?"application/json":"text/html; charset=utf-8"),d&&t.setHeader("Content-Length",Buffer.byteLength(d)),"HEAD"!==e.method?null===d?await r.pipeToNodeResponse(t):t.end(d):t.end(null)}