"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"AfterRunner",{enumerable:!0,get:function(){return AfterRunner}});const _detachedpromise=require("../../lib/detached-promise"),_webonclose=require("../web/web-on-close"),_awaiter=require("./awaiter");class AfterRunner{async executeAfter(){return this.closeController.dispatchClose(),await this.awaiter.awaiting(),this.finishedWithoutErrors.resolve(),this.finishedWithoutErrors.promise}constructor(){this.awaiter=new _awaiter.AwaiterOnce,this.closeController=new _webonclose.CloseController,this.finishedWithoutErrors=new _detachedpromise.DetachedPromise,this.context={waitUntil:this.awaiter.waitUntil.bind(this.awaiter),onClose:this.closeController.onClose.bind(this.closeController),onTaskError:e=>this.finishedWithoutErrors.reject(e)}}}