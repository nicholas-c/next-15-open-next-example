"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{ApiError:function(){return ApiError},COOKIE_NAME_PRERENDER_BYPASS:function(){return COOKIE_NAME_PRERENDER_BYPASS},COOKIE_NAME_PRERENDER_DATA:function(){return COOKIE_NAME_PRERENDER_DATA},RESPONSE_LIMIT_DEFAULT:function(){return RESPONSE_LIMIT_DEFAULT},SYMBOL_CLEARED_COOKIES:function(){return SYMBOL_CLEARED_COOKIES},SYMBOL_PREVIEW_DATA:function(){return SYMBOL_PREVIEW_DATA},checkIsOnDemandRevalidate:function(){return checkIsOnDemandRevalidate},clearPreviewData:function(){return clearPreviewData},redirect:function(){return redirect},sendError:function(){return sendError},sendStatusCode:function(){return sendStatusCode},setLazyProp:function(){return setLazyProp},wrapApiHandler:function(){return wrapApiHandler}});const _headers=require("../web/spec-extension/adapters/headers"),_constants=require("../../lib/constants"),_tracer=require("../lib/trace/tracer"),_constants1=require("../lib/trace/constants");function wrapApiHandler(e,r){return(...t)=>((0,_tracer.getTracer)().setRootSpanAttribute("next.route",e),(0,_tracer.getTracer)().trace(_constants1.NodeSpan.runHandler,{spanName:`executing api route (pages) ${e}`},(()=>r(...t))))}function sendStatusCode(e,r){return e.statusCode=r,e}function redirect(e,r,t){if("string"==typeof r&&(t=r,r=307),"number"!=typeof r||"string"!=typeof t)throw Object.defineProperty(new Error("Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination')."),"__NEXT_ERROR_CODE",{value:"E389",enumerable:!1,configurable:!0});return e.writeHead(r,{Location:t}),e.write(t),e.end(),e}function checkIsOnDemandRevalidate(e,r){const t=_headers.HeadersAdapter.from(e.headers);return{isOnDemandRevalidate:t.get(_constants.PRERENDER_REVALIDATE_HEADER)===r.previewModeId,revalidateOnlyGenerated:t.has(_constants.PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER)}}const COOKIE_NAME_PRERENDER_BYPASS="__prerender_bypass",COOKIE_NAME_PRERENDER_DATA="__next_preview_data",RESPONSE_LIMIT_DEFAULT=4194304,SYMBOL_PREVIEW_DATA=Symbol(COOKIE_NAME_PRERENDER_DATA),SYMBOL_CLEARED_COOKIES=Symbol(COOKIE_NAME_PRERENDER_BYPASS);function clearPreviewData(e,r={}){if(SYMBOL_CLEARED_COOKIES in e)return e;const{serialize:t}=require("next/dist/compiled/cookie"),n=e.getHeader("Set-Cookie");return e.setHeader("Set-Cookie",[..."string"==typeof n?[n]:Array.isArray(n)?n:[],t(COOKIE_NAME_PRERENDER_BYPASS,"",{expires:new Date(0),httpOnly:!0,sameSite:"development"!==process.env.NODE_ENV?"none":"lax",secure:"development"!==process.env.NODE_ENV,path:"/",...void 0!==r.path?{path:r.path}:void 0}),t(COOKIE_NAME_PRERENDER_DATA,"",{expires:new Date(0),httpOnly:!0,sameSite:"development"!==process.env.NODE_ENV?"none":"lax",secure:"development"!==process.env.NODE_ENV,path:"/",...void 0!==r.path?{path:r.path}:void 0})]),Object.defineProperty(e,SYMBOL_CLEARED_COOKIES,{value:!0,enumerable:!1}),e}class ApiError extends Error{constructor(e,r){super(r),this.statusCode=e}}function sendError(e,r,t){e.statusCode=r,e.statusMessage=t,e.end(t)}function setLazyProp({req:e},r,t){const n={configurable:!0,enumerable:!0},a={...n,writable:!0};Object.defineProperty(e,r,{...n,get:()=>{const n=t();return Object.defineProperty(e,r,{...a,value:n}),n},set:t=>{Object.defineProperty(e,r,{...a,value:t})}})}