"use strict";function _export(e,o){for(var r in o)Object.defineProperty(e,r,{enumerable:!0,get:o[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createRequestStoreForAPI:function(){return createRequestStoreForAPI},createRequestStoreForRender:function(){return createRequestStoreForRender},synchronizeMutableCookies:function(){return synchronizeMutableCookies}});const _approuterheaders=require("../../client/components/app-router-headers"),_headers=require("../web/spec-extension/adapters/headers"),_requestcookies=require("../web/spec-extension/adapters/request-cookies"),_cookies=require("../web/spec-extension/cookies"),_draftmodeprovider=require("./draft-mode-provider"),_utils=require("../web/utils");function getHeaders(e){const o=_headers.HeadersAdapter.from(e);for(const e of _approuterheaders.FLIGHT_HEADERS)o.delete(e.toLowerCase());return _headers.HeadersAdapter.seal(o)}function getMutableCookies(e,o){const r=new _cookies.RequestCookies(_headers.HeadersAdapter.from(e));return _requestcookies.MutableRequestCookiesAdapter.wrap(r,o)}function mergeMiddlewareCookies(e,o){if("x-middleware-set-cookie"in e.headers&&"string"==typeof e.headers["x-middleware-set-cookie"]){const r=e.headers["x-middleware-set-cookie"],s=new Headers;for(const e of(0,_utils.splitCookiesString)(r))s.append("set-cookie",e);const t=new _cookies.ResponseCookies(s);for(const e of t.getAll())o.set(e)}}function createRequestStoreForRender(e,o,r,s,t,i,a,n,u,c){return createRequestStoreImpl("render",e,o,r,s,t,i,c,a,n,u)}function createRequestStoreForAPI(e,o,r,s,t){return createRequestStoreImpl("action",e,void 0,o,{},r,s,void 0,t,!1,void 0)}function createRequestStoreImpl(e,o,r,s,t,i,a,n,u,c,d){function k(e){r&&r.setHeader("Set-Cookie",e)}const p={};return{type:"request",phase:e,implicitTags:i??[],url:{pathname:s.pathname,search:s.search??""},rootParams:t,get headers(){return p.headers||(p.headers=getHeaders(o.headers)),p.headers},get cookies(){if(!p.cookies){const e=new _cookies.RequestCookies(_headers.HeadersAdapter.from(o.headers));mergeMiddlewareCookies(o,e),p.cookies=_requestcookies.RequestCookiesAdapter.seal(e)}return p.cookies},set cookies(e){p.cookies=e},get mutableCookies(){if(!p.mutableCookies){const e=getMutableCookies(o.headers,a||(r?k:void 0));mergeMiddlewareCookies(o,e),p.mutableCookies=e}return p.mutableCookies},get userspaceMutableCookies(){if(!p.userspaceMutableCookies){const e=(0,_requestcookies.wrapWithMutableAccessCheck)(this.mutableCookies);p.userspaceMutableCookies=e}return p.userspaceMutableCookies},get draftMode(){return p.draftMode||(p.draftMode=new _draftmodeprovider.DraftModeProvider(u,o,this.cookies,this.mutableCookies)),p.draftMode},renderResumeDataCache:n??null,isHmrRefresh:c,serverComponentsHmrCache:d||globalThis.__serverComponentsHmrCache}}function synchronizeMutableCookies(e){e.cookies=_requestcookies.RequestCookiesAdapter.seal((0,_requestcookies.responseCookiesToRequestCookies)(e.mutableCookies))}