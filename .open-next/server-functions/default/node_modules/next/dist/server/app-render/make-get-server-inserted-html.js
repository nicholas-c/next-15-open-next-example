"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"makeGetServerInsertedHTML",{enumerable:!0,get:function(){return makeGetServerInsertedHTML}});const _jsxruntime=require("react/jsx-runtime"),_react=_interop_require_default(require("react")),_httpaccessfallback=require("../../client/components/http-access-fallback/http-access-fallback"),_redirect=require("../../client/components/redirect"),_redirecterror=require("../../client/components/redirect-error"),_serveredge=require("react-dom/server.edge"),_nodewebstreamshelper=require("../stream-utils/node-web-streams-helper"),_redirectstatuscode=require("../../client/components/redirect-status-code"),_addpathprefix=require("../../shared/lib/router/utils/add-path-prefix");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function makeGetServerInsertedHTML({polyfills:e,renderServerInsertedHTML:r,serverCapturedErrors:t,tracingMetadata:n,basePath:s}){let a=0,i=!1;const c=e.map((e=>(0,_jsxruntime.jsx)("script",{...e},e.src)));return async function(){const e=[];for(;a<t.length;){const r=t[a];if(a++,(0,_httpaccessfallback.isHTTPAccessFallbackError)(r))e.push((0,_jsxruntime.jsx)("meta",{name:"robots",content:"noindex"},r.digest),"development"===process.env.NODE_ENV?(0,_jsxruntime.jsx)("meta",{name:"next-error",content:"not-found"},"next-error"):null);else if((0,_redirecterror.isRedirectError)(r)){const t=(0,_addpathprefix.addPathPrefix)((0,_redirect.getURLFromRedirectError)(r),s),n=(0,_redirect.getRedirectStatusCodeFromError)(r)===_redirectstatuscode.RedirectStatusCode.PermanentRedirect;t&&e.push((0,_jsxruntime.jsx)("meta",{id:"__next-page-redirect",httpEquiv:"refresh",content:`${n?0:1};url=${t}`},r.digest))}}const o=(n||[]).map((({key:e,value:r},t)=>(0,_jsxruntime.jsx)("meta",{name:e,content:r},`next-trace-data-${t}`))),d=r();if(0===c.length&&0===o.length&&0===e.length&&Array.isArray(d)&&0===d.length)return"";const u=await(0,_serveredge.renderToReadableStream)((0,_jsxruntime.jsxs)(_jsxruntime.Fragment,{children:[i?null:c,d,i?null:o,e]}),{progressiveChunkSize:1048576});return i=!0,(0,_nodewebstreamshelper.streamToString)(u)}}