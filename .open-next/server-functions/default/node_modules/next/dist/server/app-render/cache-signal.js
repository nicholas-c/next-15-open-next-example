"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"CacheSignal",{enumerable:!0,get:function(){return CacheSignal}});class CacheSignal{constructor(){this.count=0,this.earlyListeners=[],this.listeners=[],this.tickPending=!1,this.taskPending=!1}noMorePendingCaches(){this.tickPending||(this.tickPending=!0,process.nextTick((()=>{if(this.tickPending=!1,0===this.count){for(let e=0;e<this.earlyListeners.length;e++)this.earlyListeners[e]();this.earlyListeners.length=0}}))),this.taskPending||(this.taskPending=!0,setTimeout((()=>{if(this.taskPending=!1,0===this.count){for(let e=0;e<this.listeners.length;e++)this.listeners[e]();this.listeners.length=0}}),0))}inputReady(){return new Promise((e=>{this.earlyListeners.push(e),0===this.count&&this.noMorePendingCaches()}))}cacheReady(){return new Promise((e=>{this.listeners.push(e),0===this.count&&this.noMorePendingCaches()}))}beginRead(){this.count++}endRead(){this.count--,0===this.count&&this.noMorePendingCaches()}}