"use strict";function _export(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createInlinedDataReadableStream:function(){return createInlinedDataReadableStream},useFlightStream:function(){return useFlightStream}});const _htmlescape=require("../htmlescape"),isEdgeRuntime="edge"===process.env.NEXT_RUNTIME,INLINE_FLIGHT_PAYLOAD_BOOTSTRAP=0,INLINE_FLIGHT_PAYLOAD_DATA=1,INLINE_FLIGHT_PAYLOAD_FORM_STATE=2,INLINE_FLIGHT_PAYLOAD_BINARY=3,flightResponses=new WeakMap,encoder=new TextEncoder;function useFlightStream(e,t,n){const r=flightResponses.get(e);if(r)return r;let s;s=process.env.TURBOPACK?require("react-server-dom-turbopack/client.edge").createFromReadableStream:require("react-server-dom-webpack/client.edge").createFromReadableStream;const a=s(e,{serverConsumerManifest:{moduleLoading:t.moduleLoading,moduleMap:isEdgeRuntime?t.edgeSSRModuleMapping:t.ssrModuleMapping,serverModuleMap:null},nonce:n});return flightResponses.set(e,a),a}function createInlinedDataReadableStream(e,t,n){const r=t?`<script nonce=${JSON.stringify(t)}>`:"<script>",s=e.getReader(),a=new TextDecoder("utf-8",{fatal:!0});return new ReadableStream({type:"bytes",start(e){try{writeInitialInstructions(e,r,n)}catch(t){e.error(t)}},async pull(e){try{const{done:t,value:n}=await s.read();if(n)try{const s=a.decode(n,{stream:!t});writeFlightDataInstruction(e,r,s)}catch{writeFlightDataInstruction(e,r,n)}t&&e.close()}catch(t){e.error(t)}}})}function writeInitialInstructions(e,t,n){null!=n?e.enqueue(encoder.encode(`${t}(self.__next_f=self.__next_f||[]).push(${(0,_htmlescape.htmlEscapeJsonString)(JSON.stringify([INLINE_FLIGHT_PAYLOAD_BOOTSTRAP]))});self.__next_f.push(${(0,_htmlescape.htmlEscapeJsonString)(JSON.stringify([INLINE_FLIGHT_PAYLOAD_FORM_STATE,n]))})<\/script>`)):e.enqueue(encoder.encode(`${t}(self.__next_f=self.__next_f||[]).push(${(0,_htmlescape.htmlEscapeJsonString)(JSON.stringify([INLINE_FLIGHT_PAYLOAD_BOOTSTRAP]))})<\/script>`))}function writeFlightDataInstruction(e,t,n){let r;if("string"==typeof n)r=(0,_htmlescape.htmlEscapeJsonString)(JSON.stringify([INLINE_FLIGHT_PAYLOAD_DATA,n]));else{const e=btoa(String.fromCodePoint(...n));r=(0,_htmlescape.htmlEscapeJsonString)(JSON.stringify([INLINE_FLIGHT_PAYLOAD_BINARY,e]))}e.enqueue(encoder.encode(`${t}self.__next_f.push(${r})<\/script>`))}