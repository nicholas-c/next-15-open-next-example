"use strict";function _export(e,r){for(var a in r)Object.defineProperty(e,a,{enumerable:!0,get:r[a]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createServerModuleMap:function(){return createServerModuleMap},selectWorkerForForwarding:function(){return selectWorkerForForwarding}});const _apppaths=require("../../shared/lib/router/utils/app-paths"),_pathhasprefix=require("../../shared/lib/router/utils/path-has-prefix"),_removepathprefix=require("../../shared/lib/router/utils/remove-path-prefix"),_workasyncstorageexternal=require("./work-async-storage.external");function createServerModuleMap({serverActionsManifest:e}){return new Proxy({},{get:(r,a)=>{const t=e["edge"===process.env.NEXT_RUNTIME?"edge":"node"][a].workers,o=_workasyncstorageexternal.workAsyncStorage.getStore();let n;if(n=o?t[normalizeWorkerPageName(o.page)]:Object.values(t).at(0),!n)return;const{moduleId:s,async:i}=n;return{id:s,name:a,chunks:[],async:i}}})}function selectWorkerForForwarding(e,r,a){var t;const o=null==(t=a["edge"===process.env.NEXT_RUNTIME?"edge":"node"][e])?void 0:t.workers,n=normalizeWorkerPageName(r);if(o&&!o[n])return denormalizeWorkerPageName(Object.keys(o)[0])}function normalizeWorkerPageName(e){return(0,_pathhasprefix.pathHasPrefix)(e,"app")?e:"app"+e}function denormalizeWorkerPageName(e){return(0,_apppaths.normalizeAppPath)((0,_removepathprefix.removePathPrefix)(e,"app"))}