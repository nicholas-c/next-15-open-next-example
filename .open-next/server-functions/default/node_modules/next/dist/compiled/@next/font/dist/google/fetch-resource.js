"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.fetchResource=fetchResource;const node_http_1=__importDefault(require("node:http")),node_https_1=__importDefault(require("node:https")),get_proxy_agent_1=require("./get-proxy-agent");function fetchResource(e,t,o){return new Promise(((r,n)=>{const{protocol:s}=new URL(e),u="https:"===s?node_https_1.default:node_http_1.default,_=t?3e3:void 0,a=u.request(e,{agent:(0,get_proxy_agent_1.getProxyAgent)(),headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36"}},(t=>{if(200!==t.statusCode)return void n(new Error(o||`Request failed: ${e} (status: ${t.statusCode})`));const s=[];t.on("data",(e=>s.push(Buffer.from(e)))),t.on("end",(()=>r(Buffer.concat(s))))}));_&&a.setTimeout(_,(()=>{a.destroy(new Error(`Request timed out after ${_}ms`))})),a.on("error",(e=>n(e))),a.end()}))}