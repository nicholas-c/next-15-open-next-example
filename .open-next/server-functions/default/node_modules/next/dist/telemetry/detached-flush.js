"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const _fs=_interop_require_default(require("fs")),_path=_interop_require_default(require("path")),_storage=require("./storage"),_config=_interop_require_default(require("../server/config")),_getprojectdir=require("../lib/get-project-dir"),_constants=require("../shared/lib/constants");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}(async()=>{const e=[...process.argv];let t=e.pop();const r=e.pop();if(!t||"dev"!==r)throw Object.defineProperty(new Error("Invalid flags should be run as node detached-flush dev ./path-to/project"),"__NEXT_ERROR_CODE",{value:"E24",enumerable:!1,configurable:!0});t=(0,_getprojectdir.getProjectDir)(t);const o=await(0,_config.default)(_constants.PHASE_DEVELOPMENT_SERVER,t),i=_path.default.join(t,o.distDir||".next"),s=_path.default.join(i,"_events.json");let a;try{a=JSON.parse(_fs.default.readFileSync(s,"utf8"))}catch(e){throw"ENOENT"===e.code&&process.exit(0),e}const n=new _storage.Telemetry({distDir:i});await n.record(a),await n.flush(),_fs.default.unlinkSync(s),process.exit(0)})();