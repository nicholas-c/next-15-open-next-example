"use strict";function _export(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{getJestSWCOptions:function(){return getJestSWCOptions},getLoaderSWCOptions:function(){return getLoaderSWCOptions},getParserOptions:function(){return getParserOptions}});const _path=_interop_require_default(require("path")),_constants=require("../../lib/constants"),_utils=require("../utils"),_escaperegexp=require("../../shared/lib/escape-regexp");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}const nextDirname=_path.default.dirname(require.resolve("next/package.json")),nextDistPath=new RegExp(`${(0,_escaperegexp.escapeStringRegexp)(nextDirname)}[\\/]dist[\\/](shared[\\/]lib|client|pages)`),nodeModulesPath=/[\\/]node_modules[\\/]/,regeneratorRuntimePath=require.resolve("next/dist/compiled/regenerator-runtime");function isTypeScriptFile(e){return e.endsWith(".ts")||e.endsWith(".tsx")}function isCommonJSFile(e){return e.endsWith(".cjs")}function shouldOutputCommonJs(e){return isCommonJSFile(e)||nextDistPath.test(e)}function getParserOptions({filename:e,jsConfig:t,...s}){var r;const o=e.endsWith(".ts"),n=isTypeScriptFile(e);return{...s,syntax:n?"typescript":"ecmascript",dynamicImport:!0,decorators:Boolean(null==t||null==(r=t.compilerOptions)?void 0:r.experimentalDecorators),[n?"tsx":"jsx"]:!o,importAssertions:!0}}function getBaseSWCOptions({filename:e,jest:t,development:s,hasReactRefresh:r,globalWindow:o,esm:n,modularizeImports:i,swcPlugins:a,compilerOptions:l,resolvedBaseUrl:p,jsConfig:m,swcCacheDir:c,serverComponents:u,serverReferenceHashSalt:d,bundleLayer:g,isDynamicIo:v,cacheHandlers:f,useCacheEnabled:h}){var b,C,y,x,O;const S=(0,_utils.isWebpackServerOnlyLayer)(g),R=(0,_utils.isWebpackAppPagesLayer)(g),P=getParserOptions({filename:e,jsConfig:m}),j=null==m||null==(b=m.compilerOptions)?void 0:b.paths,D=Boolean(null==m||null==(C=m.compilerOptions)?void 0:C.experimentalDecorators),w=Boolean(null==m||null==(y=m.compilerOptions)?void 0:y.emitDecoratorMetadata),_=Boolean(null==m||null==(x=m.compilerOptions)?void 0:x.useDefineForClassFields),F=(a??[]).filter(Array.isArray).map((([e,t])=>[require.resolve(e),t]));return{jsc:{...p&&j?{baseUrl:p.baseUrl,paths:j}:{},externalHelpers:!process.versions.pnp&&!t,parser:P,experimental:{keepImportAttributes:!0,emitAssertForImportAttributes:!0,plugins:F,cacheRoot:c},transform:{...t?{hidden:{jest:!0}}:{},legacyDecorator:D,decoratorMetadata:w,useDefineForClassFields:_,react:{importSource:(null==m||null==(O=m.compilerOptions)?void 0:O.jsxImportSource)??((null==l?void 0:l.emotion)&&!S?"@emotion/react":"react"),runtime:"automatic",pragmaFrag:"React.Fragment",throwIfNamespace:!0,development:!!s,useBuiltins:!0,refresh:!!r},optimizer:{simplify:!1,globals:t?null:{typeofs:{window:o?"object":"undefined"},envs:{NODE_ENV:s?'"development"':'"production"'}}},regenerator:{importPath:regeneratorRuntimePath}}},sourceMaps:t?"inline":void 0,removeConsole:null==l?void 0:l.removeConsole,reactRemoveProperties:!t&&(null==l?void 0:l.reactRemoveProperties),modularizeImports:i?Object.fromEntries(Object.entries(i).map((([e,t])=>[e,{...t,transform:"string"==typeof t.transform?t.transform:Object.entries(t.transform).map((([e,t])=>[e,t]))}]))):void 0,relay:null==l?void 0:l.relay,styledJsx:{},...!S&&{emotion:getEmotionOptions(null==l?void 0:l.emotion,s),styledComponents:getStyledComponentsOptions(null==l?void 0:l.styledComponents,s)},serverComponents:u&&!t?{isReactServerLayer:S,dynamicIoEnabled:v,useCacheEnabled:h}:void 0,serverActions:R&&!t?{isReactServerLayer:S,useCacheEnabled:h,hashSalt:d,cacheKinds:["default","remote"].concat(f?Object.keys(f):[])}:void 0,preferEsm:n,lintCodemodComments:!0,debugFunctionName:s}}function getStyledComponentsOptions(e,t){return e?"object"==typeof e?{...e,displayName:e.displayName??Boolean(t)}:{displayName:Boolean(t)}:null}function getEmotionOptions(e,t){if(!e)return null;let s=!!t;switch("object"==typeof e&&e.autoLabel){case"never":s=!1;break;case"always":s=!0}return{enabled:!0,autoLabel:s,sourcemap:t,..."object"==typeof e&&{importMap:e.importMap,labelFormat:e.labelFormat,sourcemap:t&&e.sourceMap}}}function getJestSWCOptions({isServer:e,filename:t,esm:s,modularizeImports:r,swcPlugins:o,compilerOptions:n,jsConfig:i,resolvedBaseUrl:a,pagesDir:l,serverReferenceHashSalt:p}){let m=getBaseSWCOptions({filename:t,jest:!0,development:!1,hasReactRefresh:!1,globalWindow:!e,modularizeImports:r,swcPlugins:o,compilerOptions:n,jsConfig:i,resolvedBaseUrl:a,esm:s,bundleLayer:void 0,serverComponents:!1,serverReferenceHashSalt:p});const c=shouldOutputCommonJs(t);return{...m,env:{targets:{node:process.versions.node}},module:{type:s&&!c?"es6":"commonjs"},disableNextSsg:!0,disablePageConfig:!0,pagesDir:l}}function getLoaderSWCOptions({filename:e,development:t,isServer:s,pagesDir:r,appDir:o,isPageFile:n,isDynamicIo:i,hasReactRefresh:a,modularizeImports:l,optimizeServerReact:p,optimizePackageImports:m,swcPlugins:c,compilerOptions:u,jsConfig:d,supportedBrowsers:g,swcCacheDir:v,relativeFilePathFromRoot:f,serverComponents:h,serverReferenceHashSalt:b,bundleLayer:C,esm:y,cacheHandlers:x,useCacheEnabled:O}){let S=getBaseSWCOptions({filename:e,development:t,globalWindow:!s,hasReactRefresh:a,modularizeImports:l,swcPlugins:c,compilerOptions:u,jsConfig:d,swcCacheDir:v,bundleLayer:C,serverComponents:h,serverReferenceHashSalt:b,esm:!!y,isDynamicIo:i,cacheHandlers:x,useCacheEnabled:O});S.fontLoaders={fontLoaders:["next/font/local","next/font/google"],relativeFilePathFromRoot:f},S.cjsRequireOptimizer={packages:{"next/server":{transforms:{NextRequest:"next/dist/server/web/spec-extension/request",NextResponse:"next/dist/server/web/spec-extension/response",ImageResponse:"next/dist/server/web/spec-extension/image-response",userAgentFromString:"next/dist/server/web/spec-extension/user-agent",userAgent:"next/dist/server/web/spec-extension/user-agent"}}}},p&&s&&!t&&(S.optimizeServerReact={optimize_use_state:!1}),m&&(S.autoModularizeImports={packages:m});const R=nodeModulesPath.test(e),P=C===_constants.WEBPACK_LAYERS.appPagesBrowser,j=shouldOutputCommonJs(e)?{module:{type:"commonjs"}}:{};let D;var w;(s?D={...S,...j,disableNextSsg:!0,disablePageConfig:!0,isDevelopment:t,isServerCompiler:s,pagesDir:r,appDir:o,preferEsm:!!y,isPageFile:n,env:{targets:{node:process.versions.node}}}:(D={...S,...j,disableNextSsg:!n,isDevelopment:t,isServerCompiler:s,pagesDir:r,appDir:o,isPageFile:n,...g&&g.length>0?{env:{targets:g}}:{}},D.env||(D.jsc.target="es5")),P&&R)&&(D.disableNextSsg=!0,D.disablePageConfig=!0,D.isPageFile=!1,D.optimizeServerReact=void 0,D.cjsRequireOptimizer=void 0,(null==(w=D.jsc.transform.optimizer.globals)?void 0:w.typeofs)&&delete D.jsc.transform.optimizer.globals.typeofs.window);return D}