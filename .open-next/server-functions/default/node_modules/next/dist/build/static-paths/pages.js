"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"buildPagesStaticPaths",{enumerable:!0,get:function(){return buildPagesStaticPaths}});const _normalizelocalepath=require("../../shared/lib/i18n/normalize-locale-path"),_fallback=require("../../lib/fallback"),_escapepathdelimiters=_interop_require_default(require("../../shared/lib/router/utils/escape-path-delimiters")),_removetrailingslash=require("../../shared/lib/router/utils/remove-trailing-slash"),_routematcher=require("../../shared/lib/router/utils/route-matcher"),_routeregex=require("../../shared/lib/router/utils/route-regex"),_utils=require("./utils");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}async function buildPagesStaticPaths({page:e,getStaticPaths:a,configFileName:t,locales:r,defaultLocale:l}){const o=[],i=(0,_routeregex.getRouteRegex)(e),n=(0,_routematcher.getRouteMatcher)(i),s=Object.keys(n(e)),c=await a({locales:[...r??[]],defaultLocale:l}),u="Expected: { paths: [], fallback: boolean }\nSee here for more info: https://nextjs.org/docs/messages/invalid-getstaticpaths-value";if(!c||"object"!=typeof c||Array.isArray(c))throw Object.defineProperty(new Error(`Invalid value returned from getStaticPaths in ${e}. Received ${typeof c} ${u}`),"__NEXT_ERROR_CODE",{value:"E241",enumerable:!1,configurable:!0});const d=Object.keys(c).filter((e=>!("paths"===e||"fallback"===e)));if(d.length>0)throw Object.defineProperty(new Error(`Extra keys returned from getStaticPaths in ${e} (${d.join(", ")}) ${u}`),"__NEXT_ERROR_CODE",{value:"E38",enumerable:!1,configurable:!0});if("boolean"!=typeof c.fallback&&"blocking"!==c.fallback)throw Object.defineProperty(new Error(`The \`fallback\` key must be returned from getStaticPaths in ${e}.\n`+u),"__NEXT_ERROR_CODE",{value:"E243",enumerable:!1,configurable:!0});const f=c.paths;if(!Array.isArray(f))throw Object.defineProperty(new Error(`Invalid \`paths\` value returned from getStaticPaths in ${e}.\n\`paths\` must be an array of strings or objects of shape { params: [key: string]: string }`),"__NEXT_ERROR_CODE",{value:"E83",enumerable:!1,configurable:!0});f.forEach((a=>{if("string"==typeof a){a=(0,_removetrailingslash.removeTrailingSlash)(a);const t=(0,_normalizelocalepath.normalizeLocalePath)(a,r);let i=a;t.detectedLocale?i=a.slice(t.detectedLocale.length+1):l&&(a=`/${l}${a}`);if(!n(i))throw Object.defineProperty(new Error(`The provided path \`${i}\` does not match the page: \`${e}\`.`),"__NEXT_ERROR_CODE",{value:"E481",enumerable:!1,configurable:!0});o.push({pathname:a.split("/").map((e=>(0,_escapepathdelimiters.default)(decodeURIComponent(e),!0))).join("/"),encodedPathname:a,fallbackRouteParams:void 0,fallbackMode:(0,_fallback.parseStaticPathsResult)(c.fallback),fallbackRootParams:void 0})}else{const n=Object.keys(a).filter((e=>"params"!==e&&"locale"!==e));if(n.length)throw Object.defineProperty(new Error(`Additional keys were returned from \`getStaticPaths\` in page "${e}". URL Parameters intended for this dynamic route must be nested under the \`params\` key, i.e.:\n\n\treturn { params: { ${s.map((e=>`${e}: ...`)).join(", ")} } }\n\nKeys that need to be moved: ${n.join(", ")}.\n`),"__NEXT_ERROR_CODE",{value:"E322",enumerable:!1,configurable:!0});const{params:u={}}=a;let d=e,f=e;if(s.forEach((a=>{const{repeat:t,optional:r}=i.groups[a];let l=u[a];if(r&&u.hasOwnProperty(a)&&(null==l||!1===l)&&(l=[]),t&&!Array.isArray(l)||!t&&"string"!=typeof l||void 0===l)throw Object.defineProperty(new Error(`A required parameter (${a}) was not provided as ${t?"an array":"a string"} received ${typeof l} in getStaticPaths for ${e}`),"__NEXT_ERROR_CODE",{value:"E620",enumerable:!1,configurable:!0});let o=`[${t?"...":""}${a}]`;r&&(o=`[${o}]`),d=d.replace(o,(0,_utils.encodeParam)(l,(e=>(0,_escapepathdelimiters.default)(e,!0)))),f=f.replace(o,(0,_utils.encodeParam)(l,encodeURIComponent))})),!d&&!f)return;if(a.locale&&!(null==r?void 0:r.includes(a.locale)))throw Object.defineProperty(new Error(`Invalid locale returned from getStaticPaths for ${e}, the locale ${a.locale} is not specified in ${t}`),"__NEXT_ERROR_CODE",{value:"E358",enumerable:!1,configurable:!0});const h=a.locale||l||"";o.push({pathname:(0,_utils.normalizePathname)(`${h?`/${h}`:""}${h&&"/"===d?"":d}`),encodedPathname:(0,_utils.normalizePathname)(`${h?`/${h}`:""}${h&&"/"===f?"":f}`),fallbackRouteParams:void 0,fallbackMode:(0,_fallback.parseStaticPathsResult)(c.fallback),fallbackRootParams:void 0})}}));const h=new Set;return{fallbackMode:(0,_fallback.parseStaticPathsResult)(c.fallback),prerenderedRoutes:o.filter((e=>!h.has(e.pathname)&&(h.add(e.pathname),!0)))}}