"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"transpileConfig",{enumerable:!0,get:function(){return transpileConfig}});const _nodepath=require("node:path"),_promises=require("node:fs/promises"),_requirehook=require("./require-hook"),_loadjsconfig=require("../load-jsconfig");function resolveSWCOptions(e,o){const r=(0,_nodepath.join)(e,o.baseUrl??".");return{jsc:{target:"es5",parser:{syntax:"typescript"},paths:o.paths,baseUrl:r},module:{type:"commonjs"},isModule:"unknown"}}async function lazilyGetTSConfig(e){let o;try{o=(0,_loadjsconfig.parseJsonFile)((0,_nodepath.join)(e,"tsconfig.json"))}catch(e){if("ENOENT"!==e.code)throw e;o={compilerOptions:{}}}return o}async function transpileConfig({nextConfigPath:e,cwd:o}){let r=!1;try{const{compilerOptions:t}=await lazilyGetTSConfig(o),i=resolveSWCOptions(o,t),n=await(0,_promises.readFile)(e,"utf8"),{transform:s}=require("../swc"),{code:a}=await s(n,i);return a.includes("require(")&&((0,_requirehook.registerHook)(i),r=!0),(0,_requirehook.requireFromString)(a,(0,_nodepath.join)(o,"next.config.compiled.js"))}catch(e){throw e}finally{r&&(0,_requirehook.deregisterHook)()}}