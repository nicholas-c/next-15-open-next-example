"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return transform}});const _traverse=_interop_require_default(require("next/dist/compiled/babel/traverse")),_generator=_interop_require_default(require("next/dist/compiled/babel/generator")),_corelibnormalizefile=_interop_require_default(require("next/dist/compiled/babel/core-lib-normalize-file")),_corelibnormalizeopts=_interop_require_default(require("next/dist/compiled/babel/core-lib-normalize-opts")),_corelibblockhoistplugin=_interop_require_default(require("next/dist/compiled/babel/core-lib-block-hoist-plugin")),_corelibpluginpass=_interop_require_default(require("next/dist/compiled/babel/core-lib-plugin-pass")),_getconfig=_interop_require_default(require("./get-config")),_util=require("./util");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function getTraversalParams(e,r){const t=[],o=[],i=[];for(const s of r.concat((0,_corelibblockhoistplugin.default)())){const r=new _corelibpluginpass.default(e,s.key,s.options);t.push([s,r]),o.push(r),i.push(s.visitor)}return{passPairs:t,passes:o,visitors:i}}function invokePluginPre(e,r){for(const[{pre:t},o]of r)t&&t.call(o,e)}function invokePluginPost(e,r){for(const[{post:t},o]of r)t&&t.call(o,e)}function transformAstPass(e,r,t){const{passPairs:o,passes:i,visitors:s}=getTraversalParams(e,r);invokePluginPre(e,o);const a=_traverse.default.visitors.merge(s,i,e.opts.wrapPluginVisitorMethod);t.traceChild("babel-turbo-traverse").traceFn((()=>(0,_traverse.default)(e.ast,a,e.scope))),invokePluginPost(e,o)}function transformAst(e,r,t){for(const o of r.passes)transformAstPass(e,o,t)}function transform(e,r,t,o,i,s){const a=s.traceChild("babel-turbo-get-config"),n=_getconfig.default.call(this,{source:e,loaderOptions:t,inputSourceMap:r,target:i,filename:o});if(!n)return{code:e,map:r};a.stop();const l=s.traceChild("babel-turbo-normalize-file"),u=(0,_util.consumeIterator)((0,_corelibnormalizefile.default)(n.passes,(0,_corelibnormalizeopts.default)(n),e));l.stop();const c=s.traceChild("babel-turbo-transform");transformAst(u,n,c),c.stop();const p=s.traceChild("babel-turbo-generate"),{code:f,map:b}=(0,_generator.default)(u.ast,u.opts.generatorOpts,u.code);return p.stop(),{code:f,map:b}}