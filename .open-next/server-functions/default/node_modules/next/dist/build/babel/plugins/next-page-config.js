"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return nextPageConfig}});const _core=require("next/dist/compiled/babel/core"),_constants=require("../../../shared/lib/constants"),CONFIG_KEY="config";function replaceBundle(e,r){e.parentPath.replaceWith(r.program([r.variableDeclaration("const",[r.variableDeclarator(r.identifier(_constants.STRING_LITERAL_DROP_BUNDLE),r.stringLiteral(`${_constants.STRING_LITERAL_DROP_BUNDLE} ${Date.now()}`))])],[]))}function errorMessage(e,r){return`Invalid page config export found. ${r} in file ${(e.filename||"").split(e.cwd||"").pop()||"unknown"}. See: https://nextjs.org/docs/messages/invalid-page-config`}function nextPageConfig({types:e}){return{visitor:{Program:{enter(r,o){r.traverse({ExportDeclaration(r,o){var t;if(_core.types.isExportNamedDeclaration(r.node)&&(null==(t=r.node.specifiers)?void 0:t.some((r=>(e.isIdentifier(r.exported)?r.exported.name:r.exported.value)===CONFIG_KEY)))&&_core.types.isStringLiteral(r.node.source))throw Object.defineProperty(new Error(errorMessage(o,"Expected object but got export from")),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})},ExportNamedDeclaration(r,o){var t,n;if(o.bundleDropped||!r.node.declaration&&0===r.node.specifiers.length)return;const i={},a=[...(null==(t=r.node.declaration)?void 0:t.declarations)||[],null==(n=r.scope.getBinding(CONFIG_KEY))?void 0:n.path.node].filter(Boolean);for(const t of r.node.specifiers)if((e.isIdentifier(t.exported)?t.exported.name:t.exported.value)===CONFIG_KEY){if(_core.types.isStringLiteral(r.node.source))throw Object.defineProperty(new Error(errorMessage(o,"Expected object but got import")),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});var s;if(_core.types.isIdentifier(t.local)&&_core.types.isImportSpecifier(null==(s=r.scope.getBinding(t.local.name))?void 0:s.path.node))throw Object.defineProperty(new Error(errorMessage(o,"Expected object but got import")),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}for(const e of a){if(!_core.types.isIdentifier(e.id,{name:CONFIG_KEY}))continue;let{init:r}=e;if(_core.types.isTSAsExpression(r)&&(r=r.expression),!_core.types.isObjectExpression(r)){const e=r?r.type:"undefined";throw Object.defineProperty(new Error(errorMessage(o,`Expected object but got ${e}`)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}for(const e of r.properties){if(_core.types.isSpreadElement(e))throw Object.defineProperty(new Error(errorMessage(o,"Property spread is not allowed")),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});const{name:r}=e.key;if(_core.types.isIdentifier(e.key,{name:"amp"})){if(!_core.types.isObjectProperty(e))throw Object.defineProperty(new Error(errorMessage(o,`Invalid property "${r}"`)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if(!_core.types.isBooleanLiteral(e.value)&&!_core.types.isStringLiteral(e.value))throw Object.defineProperty(new Error(errorMessage(o,`Invalid value for "${r}"`)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});i.amp=e.value.value}}}var l,c;return!0===i.amp?((null==(c=o.file)||null==(l=c.opts)?void 0:l.caller.isDev)||replaceBundle(r,e),void(o.bundleDropped=!0)):void 0}},o)}}}}}