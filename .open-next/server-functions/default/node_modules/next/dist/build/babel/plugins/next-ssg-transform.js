"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{EXPORT_NAME_GET_SERVER_PROPS:function(){return EXPORT_NAME_GET_SERVER_PROPS},EXPORT_NAME_GET_STATIC_PATHS:function(){return EXPORT_NAME_GET_STATIC_PATHS},EXPORT_NAME_GET_STATIC_PROPS:function(){return EXPORT_NAME_GET_STATIC_PROPS},default:function(){return nextTransformSsg}});const _constants=require("../../../lib/constants"),_constants1=require("../../../shared/lib/constants"),EXPORT_NAME_GET_STATIC_PROPS="getStaticProps",EXPORT_NAME_GET_STATIC_PATHS="getStaticPaths",EXPORT_NAME_GET_SERVER_PROPS="getServerSideProps",ssgExports=new Set([EXPORT_NAME_GET_STATIC_PROPS,EXPORT_NAME_GET_STATIC_PATHS,EXPORT_NAME_GET_SERVER_PROPS,"unstable_getStaticProps","unstable_getStaticPaths","unstable_getServerProps","unstable_getServerSideProps"]);function decorateSsgExport(e,t,r){const n=r.isPrerender?_constants1.STATIC_PROPS_ID:_constants1.SERVER_PROPS_ID,o=e.identifier(n),i=t=>{if(r.done)return;r.done=!0;const[n]=t.replaceWithMultiple([e.exportNamedDeclaration(e.variableDeclaration("var",[e.variableDeclarator(o,e.booleanLiteral(!0))]),[e.exportSpecifier(o,o)]),t.node]);t.scope.registerDeclaration(n)};t.traverse({ExportDefaultDeclaration(e){i(e)},ExportNamedDeclaration(e){i(e)}})}const isDataIdentifier=(e,t)=>{if(ssgExports.has(e)){if(e===EXPORT_NAME_GET_SERVER_PROPS){if(t.isPrerender)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_SSG_CONFLICT),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});t.isServerProps=!0}else{if(t.isServerProps)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_SSG_CONFLICT),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});t.isPrerender=!0}return!0}return!1};function nextTransformSsg({types:e}){function t(e){const t=e.parentPath;if("VariableDeclarator"===t.type){const e=t.get("id");return"Identifier"===e.node.type?e:null}if("AssignmentExpression"===t.type){const e=t.get("left");return"Identifier"===e.node.type?e:null}return"ArrowFunctionExpression"===e.node.type?null:e.node.id&&"Identifier"===e.node.id.type?e.get("id"):null}function r(e){const t=e.scope.getBinding(e.node.name);return!!(null==t?void 0:t.referenced)&&("FunctionDeclaration"!==t.path.type||!t.constantViolations.concat(t.referencePaths).every((e=>e.findParent((e=>e===t.path)))))}function n(e,n){const o=t(e);(null==o?void 0:o.node)&&r(o)&&n.refs.add(o)}function o(e,t){const n=e.get("local");r(n)&&t.refs.add(n)}return{visitor:{Program:{enter(i,a){if(a.refs=new Set,a.isPrerender=!1,a.isServerProps=!1,a.done=!1,i.traverse({VariableDeclarator(e,t){if("Identifier"===e.node.id.type){const n=e.get("id");r(n)&&t.refs.add(n)}else if("ObjectPattern"===e.node.id.type){e.get("id").get("properties").forEach((e=>{const n=e.get("ObjectProperty"===e.node.type?"value":"RestElement"===e.node.type?"argument":function(){throw Object.defineProperty(new Error("invariant"),"__NEXT_ERROR_CODE",{value:"E400",enumerable:!1,configurable:!0})}());r(n)&&t.refs.add(n)}))}else if("ArrayPattern"===e.node.id.type){e.get("id").get("elements").forEach((e=>{var n,o;let i;if("Identifier"===(null==(n=e.node)?void 0:n.type))i=e;else{if("RestElement"!==(null==(o=e.node)?void 0:o.type))return;i=e.get("argument")}r(i)&&t.refs.add(i)}))}},FunctionDeclaration:n,FunctionExpression:n,ArrowFunctionExpression:n,ImportSpecifier:o,ImportDefaultSpecifier:o,ImportNamespaceSpecifier:o,ExportNamedDeclaration(t,r){const n=t.get("specifiers");if(n.length)return n.forEach((t=>{isDataIdentifier(e.isIdentifier(t.node.exported)?t.node.exported.name:t.node.exported.value,r)&&t.remove()})),void(t.node.specifiers.length<1&&t.remove());const o=t.get("declaration");if(null!=o&&null!=o.node)switch(o.node.type){case"FunctionDeclaration":{const e=o.node.id.name;isDataIdentifier(e,r)&&t.remove();break}case"VariableDeclaration":o.get("declarations").forEach((e=>{if("Identifier"!==e.node.id.type)return;const t=e.node.id.name;isDataIdentifier(t,r)&&e.remove()}));break}}},a),!a.isPrerender&&!a.isServerProps)return;const s=a.refs;let c;function d(n){const o=t(n);(null==o?void 0:o.node)&&s.has(o)&&!r(o)&&(++c,e.isAssignmentExpression(n.parentPath.node)||e.isVariableDeclarator(n.parentPath.node)?n.parentPath.remove():n.remove())}function l(e){const t=e.get("local");s.has(t)&&!r(t)&&(++c,e.remove(),0===e.parent.specifiers.length&&e.parentPath.remove())}do{i.scope.crawl(),c=0,i.traverse({VariableDeclarator(e){if("Identifier"===e.node.id.type){const t=e.get("id");s.has(t)&&!r(t)&&(++c,e.remove())}else if("ObjectPattern"===e.node.id.type){const t=e.get("id"),n=c;t.get("properties").forEach((e=>{const t=e.get("ObjectProperty"===e.node.type?"value":"RestElement"===e.node.type?"argument":function(){throw Object.defineProperty(new Error("invariant"),"__NEXT_ERROR_CODE",{value:"E400",enumerable:!1,configurable:!0})}());s.has(t)&&!r(t)&&(++c,e.remove())})),n!==c&&t.get("properties").length<1&&e.remove()}else if("ArrayPattern"===e.node.id.type){const t=e.get("id"),n=c;t.get("elements").forEach((e=>{var t,n;let o;if("Identifier"===(null==(t=e.node)?void 0:t.type))o=e;else{if("RestElement"!==(null==(n=e.node)?void 0:n.type))return;o=e.get("argument")}s.has(o)&&!r(o)&&(++c,e.remove())})),n!==c&&t.get("elements").length<1&&e.remove()}},FunctionDeclaration:d,FunctionExpression:d,ArrowFunctionExpression:d,ImportSpecifier:l,ImportDefaultSpecifier:l,ImportNamespaceSpecifier:l})}while(c);decorateSsgExport(e,i,a)}}}}}