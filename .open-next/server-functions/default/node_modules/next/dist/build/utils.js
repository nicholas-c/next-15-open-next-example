"use strict";function _export(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{NestedMiddlewareError:function(){return NestedMiddlewareError},collectMeta:function(){return collectMeta},collectRoutesUsingEdgeRuntime:function(){return collectRoutesUsingEdgeRuntime},computeFromManifest:function(){return computeFromManifest},copyTracedFiles:function(){return copyTracedFiles},detectConflictingPaths:function(){return detectConflictingPaths},difference:function(){return difference},getDefinedNamedExports:function(){return getDefinedNamedExports},getJsPageSizeInKb:function(){return getJsPageSizeInKb},getPossibleInstrumentationHookFilenames:function(){return getPossibleInstrumentationHookFilenames},getPossibleMiddlewareFilenames:function(){return getPossibleMiddlewareFilenames},getSupportedBrowsers:function(){return getSupportedBrowsers},hasCustomGetInitialProps:function(){return hasCustomGetInitialProps},isAppBuiltinNotFoundPage:function(){return isAppBuiltinNotFoundPage},isCustomErrorPage:function(){return isCustomErrorPage},isInstrumentationHookFile:function(){return isInstrumentationHookFile},isInstrumentationHookFilename:function(){return isInstrumentationHookFilename},isMiddlewareFile:function(){return isMiddlewareFile},isMiddlewareFilename:function(){return isMiddlewareFilename},isPageStatic:function(){return isPageStatic},isReservedPage:function(){return isReservedPage},isWebpackAppPagesLayer:function(){return isWebpackAppPagesLayer},isWebpackBundledLayer:function(){return isWebpackBundledLayer},isWebpackClientOnlyLayer:function(){return isWebpackClientOnlyLayer},isWebpackDefaultLayer:function(){return isWebpackDefaultLayer},isWebpackServerOnlyLayer:function(){return isWebpackServerOnlyLayer},printCustomRoutes:function(){return printCustomRoutes},printTreeView:function(){return printTreeView},reduceAppConfig:function(){return reduceAppConfig},unique:function(){return unique}}),require("../server/require-hook"),require("../server/node-polyfill-crypto"),require("../server/node-environment");const _picocolors=require("../lib/picocolors"),_gzipsize=_interop_require_default(require("next/dist/compiled/gzip-size")),_texttable=_interop_require_default(require("next/dist/compiled/text-table")),_path=_interop_require_default(require("path")),_fs=require("fs"),_reactis=require("next/dist/compiled/react-is"),_stripansi=_interop_require_default(require("next/dist/compiled/strip-ansi")),_browserslist=_interop_require_default(require("next/dist/compiled/browserslist")),_constants=require("../lib/constants"),_constants1=require("../shared/lib/constants"),_prettybytes=_interop_require_default(require("../lib/pretty-bytes")),_isdynamic=require("../shared/lib/router/utils/is-dynamic"),_findpagefile=require("../server/lib/find-page-file"),_isedgeruntime=require("../lib/is-edge-runtime"),_log=_interop_require_wildcard(require("./output/log")),_loadcomponents=require("../server/load-components"),_trace=require("../trace"),_setuphttpagentenv=require("../server/setup-http-agent-env"),_asyncsema=require("next/dist/compiled/async-sema"),_denormalizepagepath=require("../shared/lib/page-path/denormalize-page-path"),_normalizepagepath=require("../shared/lib/page-path/normalize-page-path"),_sandbox=require("../server/web/sandbox"),_clientandserverreferences=require("../lib/client-and-server-references"),_apppaths=require("../shared/lib/router/utils/app-paths"),_denormalizeapppath=require("../shared/lib/page-path/denormalize-app-path"),_routekind=require("../server/route-kind"),_interceptionroutes=require("../server/lib/interception-routes"),_ppr=require("../server/lib/experimental/ppr"),_appsegments=require("./segment-config/app/app-segments"),_createincrementalcache=require("../export/helpers/create-incremental-cache"),_collectrootparamkeys=require("./segment-config/app/collect-root-param-keys"),_app=require("./static-paths/app"),_pages=require("./static-paths/pages");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}function _interop_require_wildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_getRequireWildcardCache(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const print=console.log,RESERVED_PAGE=/^\/(_app|_error|_document|api(\/|$))/,fileGzipStats={},fsStatGzip=e=>{const t=fileGzipStats[e];return t||(fileGzipStats[e]=_gzipsize.default.file(e))},fileSize=async e=>(await _fs.promises.stat(e)).size,fileStats={},fsStat=e=>{const t=fileStats[e];return t||(fileStats[e]=fileSize(e))};function unique(e,t){return[...new Set([...e,...t])]}function difference(e,t){const n=new Set(e),r=new Set(t);return[...n].filter((e=>!r.has(e)))}function intersect(e,t){const n=new Set(e),r=new Set(t);return[...new Set([...n].filter((e=>r.has(e))))]}function sum(e){return e.reduce(((e,t)=>e+t),0)}let cachedBuildManifest,cachedAppBuildManifest,lastCompute,lastComputePageInfo;async function computeFromManifest(e,t,n=!0,r){var i,a;if(Object.is(cachedBuildManifest,e.build)&&lastComputePageInfo===!!r&&Object.is(cachedAppBuildManifest,e.app))return lastCompute;const s=(e,t,n)=>{for(const r of n[t])"/_app"===t?e.set(r,1/0):e.has(r)?e.set(r,e.get(r)+1):e.set(r,1)},o={pages:{each:new Map,expected:0}};for(const t in e.build.pages){if(r){const e=r.get(t);if(null==e?void 0:e.isHybridAmp)continue}o.pages.expected++,s(o.pages.each,t,e.build.pages)}if(null==(i=e.app)?void 0:i.pages){o.app={each:new Map,expected:0};for(const t in e.app.pages)o.app.expected++,s(o.app.each,t,e.app.pages)}const c=n?fsStatGzip:fsStat,l=new Map;await Promise.all([...new Set([...o.pages.each.keys(),...(null==(a=o.app)?void 0:a.each.keys())??[]])].map((async e=>{try{l.set(e,await c(_path.default.join(t,e)))}catch{}})));const p=async e=>{const t=[...e.each.entries()],n=e=>e.reduce(((e,[t])=>{e.files.push(t);const n=l.get(t);return"number"==typeof n&&(e.size.total+=n),e}),{files:[],size:{total:0}});return{unique:n(t.filter((([,e])=>1===e))),common:n(t.filter((([,t])=>t===e.expected||t===1/0)))}};return lastCompute={router:{pages:await p(o.pages),app:o.app?await p(o.app):void 0},sizes:l},cachedBuildManifest=e.build,cachedAppBuildManifest=e.app,lastComputePageInfo=!!r,lastCompute}function isMiddlewareFilename(e){return e===_constants.MIDDLEWARE_FILENAME||e===`src/${_constants.MIDDLEWARE_FILENAME}`}function isInstrumentationHookFilename(e){return e===_constants.INSTRUMENTATION_HOOK_FILENAME||e===`src/${_constants.INSTRUMENTATION_HOOK_FILENAME}`}const filterAndSortList=(e,t,n)=>{let r;return r="app"===t?e.filter((e=>"/favicon.ico"!==e)):e.slice().filter((e=>!("/_document"===e||"/_error"===e||!n&&"/_app"===e))),r.sort(((e,t)=>e.localeCompare(t)))};function collectRoutesUsingEdgeRuntime(e){const t={};for(const[n,r]of e.entries())(0,_isedgeruntime.isEdgeRuntime)(r.runtime)&&(t[n]=0);return t}async function printTreeView(e,t,{distPath:n,buildId:r,pagesDir:i,pageExtensions:a,buildManifest:s,appBuildManifest:o,middlewareManifest:c,useStaticPages404:l,gzipSize:p=!0}){var u,d;const f=(e,{strong:t}={})=>{const n=process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT?"N/A kB":(0,_prettybytes.default)(e);return t?(0,_picocolors.white)((0,_picocolors.bold)(n)):n},m=process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT?1/0:300,_=e=>{const t=`${e} ms`;return e<1e3?(0,_picocolors.green)(t):e<2e3?(0,_picocolors.yellow)(t):(0,_picocolors.red)((0,_picocolors.bold)(t))},g=e=>e.replace(/^static\//,"").replace(/^<buildId>/,"static").replace(/(?:^|[.-])([0-9a-z]{6})[0-9a-z]{14}(?=\.)/,".$1"),h=!(!i||!await(0,_findpagefile.findPageFile)(i,"/_app",a,!1)),E=new Set,P=[],y=await computeFromManifest({build:s,app:o},n,p,t),b=async({list:e,routerType:n})=>{var i,a;const o=filterAndSortList(e,n,h);if(0===o.length)return;P.push(["app"===n?"Route (app)":"Route (pages)","Size","First Load JS"].map((e=>(0,_picocolors.underline)(e)))),o.forEach(((e,r,i)=>{var a,o,c;const l=0===r?1===i.length?"─":"┌":r===i.length-1?"└":"├",p=t.get(e),u=s.ampFirstPages.includes(e),d=((null==p?void 0:p.pageDuration)||0)+((null==p||null==(a=p.ssgPageDurations)?void 0:a.reduce(((e,t)=>e+(t||0)),0))||0);let h;h="/_app"===e||"/_app.server"===e?" ":(0,_isedgeruntime.isEdgeRuntime)(null==p?void 0:p.runtime)?"ƒ":(null==p?void 0:p.isRoutePPREnabled)?(null==p?void 0:p.hasEmptyPrelude)||p.isDynamicAppRoute&&!p.hasPostponed?"ƒ":(null==p?void 0:p.hasPostponed)?"◐":"○":(null==p?void 0:p.isStatic)?"○":(null==p?void 0:p.isSSG)?"●":"ƒ",E.add(h),(null==p?void 0:p.initialRevalidateSeconds)&&E.add("ISR"),P.push([`${l} ${h} ${(null==p?void 0:p.initialRevalidateSeconds)?`${e} (ISR: ${null==p?void 0:p.initialRevalidateSeconds} Seconds)`:e}${d>m?` (${_(d)})`:""}`,p?u?(0,_picocolors.cyan)("AMP"):p.size>=0?f(p.size):"":"",p?u?(0,_picocolors.cyan)("AMP"):p.size>=0?f(p.totalSize,{strong:!0}):"":""]);const b=(null==(o=s.pages[e])?void 0:o.filter((e=>{var t;return e.endsWith(".css")&&(null==(t=y.router[n])?void 0:t.unique.files.includes(e))})))||[];if(b.length>0){const e=r===i.length-1?" ":"├";b.forEach(((t,n,{length:r})=>{const i=n===r-1?"└":"├",a=y.sizes.get(t);P.push([`${e}   ${i} ${g(t)}`,"number"==typeof a?f(a):"",""])}))}if(null==p||null==(c=p.ssgPageRoutes)?void 0:c.length){const e=p.ssgPageRoutes.length,t=r===i.length-1?" ":"├";let n;if(p.ssgPageDurations&&p.ssgPageDurations.some((e=>e>m))){const t=8===e?8:Math.min(e,7),r=p.ssgPageRoutes.map(((e,t)=>({route:e,duration:p.ssgPageDurations[t]||0}))).sort((({duration:e},{duration:t})=>e<=m&&t<=m?0:t-e));n=r.slice(0,t);const i=r.slice(t);if(i.length){const e=i.length,t=Math.round(i.reduce(((e,{duration:t})=>e+t),0)/i.length);n.push({route:`[+${e} more paths]`,duration:0,avgDuration:t})}}else{const t=4===e?4:Math.min(e,3);if(n=p.ssgPageRoutes.slice(0,t).map((e=>({route:e,duration:0}))),e>t){const r=e-t;n.push({route:`[+${r} more paths]`,duration:0})}}n.forEach((({route:e,duration:n,avgDuration:r},i,{length:a})=>{const s=i===a-1?"└":"├";P.push([`${t}   ${s} ${e}${n>m?` (${_(n)})`:""}${r&&r>m?` (avg ${_(r)})`:""}`,"",""])}))}}));const c=null==(i=y.router[n])?void 0:i.common.size.total,l=process.env.__NEXT_PRIVATE_DETERMINISTIC_BUILD_OUTPUT?[]:(null==(a=y.router[n])?void 0:a.common.files)??[];P.push(["+ First Load JS shared by all","number"==typeof c?f(c,{strong:!0}):"",""]);const p=[],u=[...l.filter((e=>!e.endsWith(".css")||(p.push(e),!1))).map((e=>e.replace(r,"<buildId>"))).sort(),...p.map((e=>e.replace(r,"<buildId>"))).sort()],d=1e4;let b=0,v=0;u.forEach(((e,t,{length:n})=>{const i=t+v===n-1?"└":"├",a=e.replace("<buildId>",r),s=g(e),o=y.sizes.get(a);if(!o||o<d)return v++,void(b+=o||0);P.push([`  ${i} ${s}`,f(o),""])})),v>0&&P.push(["  └ other shared chunks (total)",f(b),""])};e.app&&y.router.app&&(await b({routerType:"app",list:e.app}),P.push(["","",""])),t.set("/404",{...t.get("/404")||t.get("/_error"),isStatic:l}),e.pages.includes("/404")||(null==(u=e.app)?void 0:u.includes(_constants1.UNDERSCORE_NOT_FOUND_ROUTE))||(e.pages=[...e.pages,"/404"]),await b({routerType:"pages",list:e.pages});const v=null==(d=c.middleware)?void 0:d["/"];if((null==v?void 0:v.files.length)>0){const e=await Promise.all(v.files.map((e=>`${n}/${e}`)).map(p?fsStatGzip:fsStat));P.push(["","",""]),P.push(["ƒ Middleware",f(sum(e),{strong:!0}),""])}print((0,_texttable.default)(P,{align:["l","l","r"],stringLength:e=>(0,_stripansi.default)(e).length}));const w=e.app&&y.router.app?"generateStaticParams":"getStaticProps";print(),print((0,_texttable.default)([E.has("○")&&["○","(Static)","prerendered as static content"],E.has("●")&&["●","(SSG)",`prerendered as static HTML (uses ${(0,_picocolors.cyan)(w)})`],E.has("ISR")&&["","(ISR)",`incremental static regeneration (uses revalidate in ${(0,_picocolors.cyan)(w)})`],E.has("◐")&&["◐","(Partial Prerender)","prerendered as static HTML with dynamic server-streamed content"],E.has("ƒ")&&["ƒ","(Dynamic)","server-rendered on demand"]].filter((e=>e)),{align:["l","l","l"],stringLength:e=>(0,_stripansi.default)(e).length})),print()}function printCustomRoutes({redirects:e,rewrites:t,headers:n}){const r=(e,t)=>{const r="Redirects"===t,i="Headers"===t;print((0,_picocolors.underline)(t));const a=e.map((e=>{let t=`┌ source: ${e.source}\n`;if(!i){t+=`${r?"├":"└"} destination: ${e.destination}\n`}if(r){const n=e;t+=`└ ${n.statusCode?`status: ${n.statusCode}`:`permanent: ${n.permanent}`}\n`}if(i){const r=e;t+="└ headers:\n";for(let e=0;e<r.headers.length;e++){const i=r.headers[e];t+=`  ${e===n.length-1?"└":"├"} ${i.key}: ${i.value}\n`}}return t})).join("\n");print(`${a}\n`)};print(),e.length&&r(e,"Redirects"),n.length&&r(n,"Headers");const i=[...t.beforeFiles,...t.afterFiles,...t.fallback];i.length&&r(i,"Rewrites")}async function getJsPageSizeInKb(e,t,n,r,i,a=!0,s){const o="pages"===e?r:i;if(!o)throw Object.defineProperty(new Error('expected appBuildManifest with an "app" pageType'),"__NEXT_ERROR_CODE",{value:"E29",enumerable:!1,configurable:!0});"app"===e&&(o.pages=Object.entries(o.pages).reduce(((e,[t,n])=>(e[(0,_apppaths.normalizeAppPath)(t)]=n,e)),{}));const c=s??await computeFromManifest({build:r,app:i},n,a),l=c.router[e];if(!l)throw Object.defineProperty(new Error('expected "app" manifest data with an "app" pageType'),"__NEXT_ERROR_CODE",{value:"E76",enumerable:!1,configurable:!0});const p="pages"===e?(0,_denormalizepagepath.denormalizePagePath)(t):(0,_denormalizeapppath.denormalizeAppPagePath)(t),u=e=>e.endsWith(".js"),d=(o.pages[p]??[]).filter(u),f=e=>`${n}/${e}`,m=unique(d,(o.pages["/_app"]??[]).filter(u)).map(f),_=difference(intersect(d,l.unique.files),l.common.files).map(f),g=a?fsStatGzip:fsStat,h=async e=>{const t=e.slice(n.length+1),r=c.sizes.get(t);return"number"!=typeof r?g(e):r};try{const e=sum(await Promise.all(m.map(h)));return[sum(await Promise.all(_.map(h))),e]}catch{}return[-1,-1]}async function isPageStatic({dir:e,page:t,distDir:n,configFileName:r,runtimeEnvConfig:i,httpAgentOptions:a,locales:s,defaultLocale:o,parentId:c,pageRuntime:l,edgeInfo:p,pageType:u,dynamicIO:d,authInterrupts:f,originalAppPath:m,isrFlushToDisk:_,maxMemoryCacheSize:g,nextConfigOutput:h,cacheHandler:E,cacheHandlers:P,cacheLifeProfiles:y,pprConfig:b,buildId:v,sriEnabled:w}){await(0,_createincrementalcache.createIncrementalCache)({cacheHandler:E,cacheHandlers:P,distDir:n,dir:e,flushToDisk:_,cacheMaxMemorySize:g});return(0,_trace.trace)("is-page-static-utils",c).traceAsyncFn((async()=>{let c,P,R;require("../shared/lib/runtime-config.external").setConfig(i),(0,_setuphttpagentenv.setHttpClientAndAgentOptions)({httpAgentOptions:a});let S,O={},I=!1;const C=(0,_isedgeruntime.isEdgeRuntime)(l);if(C){const e=await(0,_sandbox.getRuntimeContext)({paths:p.files.map((e=>_path.default.join(n,e))),edgeFunctionEntry:{...p,wasm:(p.wasm??[]).map((e=>({...e,filePath:_path.default.join(n,e.filePath)})))},name:p.name,useCache:!0,distDir:n}),r=(await e.context._ENTRIES[`middleware_${p.name}`]).ComponentMod,i={};I=(0,_clientandserverreferences.isClientReference)(r),c={Component:r.default,Document:r.Document,App:r.App,routeModule:r.routeModule,page:t,ComponentMod:r,pageConfig:r.config||{},buildManifest:i,reactLoadableManifest:{},getServerSideProps:r.getServerSideProps,getStaticPaths:r.getStaticPaths,getStaticProps:r.getStaticProps}}else c=await(0,_loadcomponents.loadComponents)({distDir:n,page:m||t,isAppPath:"app"===u,isDev:!1,sriEnabled:w});const A=c.Component,M=c.routeModule;let T=!1;if("app"===u){const r=c.ComponentMod;let i;I=(0,_clientandserverreferences.isClientReference)(c.ComponentMod);try{i=await(0,_appsegments.collectSegments)(c)}catch(e){throw Object.defineProperty(new Error(`Failed to collect configuration for ${t}`,{cause:e}),"__NEXT_ERROR_CODE",{value:"E434",enumerable:!1,configurable:!0})}O=reduceAppConfig(i),"force-static"===O.dynamic&&C&&_log.warn(`Page "${t}" is using runtime = 'edge' which is currently incompatible with dynamic = 'force-static'. Please remove either "runtime" or "force-static" for correct behavior`),S=(0,_collectrootparamkeys.collectRootParamKeys)(c),T=M.definition.kind===_routekind.RouteKind.APP_PAGE&&!(0,_interceptionroutes.isInterceptionRouteAppPath)(t)&&(0,_ppr.checkIsRoutePPREnabled)(b,O),"force-dynamic"!==O.dynamic||T||(O.revalidate=0),(0,_isdynamic.isDynamicRoute)(t)&&!C&&({prerenderedRoutes:P,fallbackMode:R}=await(0,_app.buildAppStaticPaths)({dir:e,page:t,dynamicIO:d,authInterrupts:f,segments:i,distDir:n,requestHeaders:{},isrFlushToDisk:_,maxMemoryCacheSize:g,cacheHandler:E,cacheLifeProfiles:y,ComponentMod:r,nextConfigOutput:h,isRoutePPREnabled:T,buildId:v,rootParamKeys:S}))}else if(!A||!(0,_reactis.isValidElementType)(A)||"string"==typeof A)throw Object.defineProperty(new Error("INVALID_DEFAULT_EXPORT"),"__NEXT_ERROR_CODE",{value:"E457",enumerable:!1,configurable:!0});const N=!!(null==A?void 0:A.getInitialProps),D=!!c.getStaticProps,$=!!c.getStaticPaths,L=!!c.getServerSideProps;if(N&&D)throw Object.defineProperty(new Error(_constants.SSG_GET_INITIAL_PROPS_CONFLICT),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if(N&&L)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_GET_INIT_PROPS_CONFLICT),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});if(D&&L)throw Object.defineProperty(new Error(_constants.SERVER_PROPS_SSG_CONFLICT),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});const F=(0,_isdynamic.isDynamicRoute)(t);if(D&&$&&!F)throw Object.defineProperty(new Error(`getStaticPaths can only be used with dynamic pages, not '${t}'.\nLearn more: https://nextjs.org/docs/routing/dynamic-routes`),"__NEXT_ERROR_CODE",{value:"E356",enumerable:!1,configurable:!0});if(D&&F&&!$)throw Object.defineProperty(new Error(`getStaticPaths is required for dynamic SSG pages and is missing for '${t}'.\nRead more: https://nextjs.org/docs/messages/invalid-getstaticpaths-value`),"__NEXT_ERROR_CODE",{value:"E255",enumerable:!1,configurable:!0});D&&$&&({prerenderedRoutes:P,fallbackMode:R}=await(0,_pages.buildPagesStaticPaths)({page:t,locales:s,defaultLocale:o,configFileName:r,getStaticPaths:c.getStaticPaths}));const q=globalThis.__NEXT_IMAGE_IMPORTED,k=I?{}:c.pageConfig;let j=!1;return D||N||L||(j=!0),T&&(j=!0),{isStatic:j,isRoutePPREnabled:T,isHybridAmp:"hybrid"===k.amp,isAmpOnly:!0===k.amp,prerenderFallbackMode:R,prerenderedRoutes:P,rootParamKeys:S,hasStaticProps:D,hasServerProps:L,isNextImageImported:q,appConfig:O}})).catch((e=>{if("INVALID_DEFAULT_EXPORT"===e.message)throw e;throw console.error(e),Object.defineProperty(new Error(`Failed to collect page data for ${t}`),"__NEXT_ERROR_CODE",{value:"E414",enumerable:!1,configurable:!0})}))}function reduceAppConfig(e){const t={};for(const n of e){const{dynamic:e,fetchCache:r,preferredRegion:i,revalidate:a,experimental_ppr:s,runtime:o,maxDuration:c}=n.config||{};void 0!==i&&(t.preferredRegion=i),void 0!==e&&(t.dynamic=e),void 0!==r&&(t.fetchCache=r),void 0!==a&&(t.revalidate=a),"number"==typeof a&&("number"!=typeof t.revalidate||a<t.revalidate)&&(t.revalidate=a),void 0!==s&&(t.experimental_ppr=s),void 0!==o&&(t.runtime=o),void 0!==c&&(t.maxDuration=c)}return t}async function hasCustomGetInitialProps({page:e,distDir:t,runtimeEnvConfig:n,checkingApp:r,sriEnabled:i}){require("../shared/lib/runtime-config.external").setConfig(n);let a=(await(0,_loadcomponents.loadComponents)({distDir:t,page:e,isAppPath:!1,isDev:!1,sriEnabled:i})).ComponentMod;return a=r?await a._app||a.default||a:a.default||a,a=await a,a.getInitialProps!==a.origGetInitialProps}async function getDefinedNamedExports({page:e,distDir:t,runtimeEnvConfig:n,sriEnabled:r}){require("../shared/lib/runtime-config.external").setConfig(n);const i=await(0,_loadcomponents.loadComponents)({distDir:t,page:e,isAppPath:!1,isDev:!1,sriEnabled:r});return Object.keys(i.ComponentMod).filter((e=>void 0!==i.ComponentMod[e]))}function detectConflictingPaths(e,t,n){const r=new Map,i=[...t].filter((e=>(0,_isdynamic.isDynamicRoute)(e))),a={};if(n.forEach(((e,t)=>{a[t]||={},e.forEach((e=>{const n=e.toLowerCase();a[t][n]=e}))})),n.forEach(((t,s)=>{t.forEach((t=>{const o=t.toLowerCase();let c=e.find((e=>e.toLowerCase()===o));if(c)r.set(o,[{path:t,page:s},{path:c,page:c}]);else{let e;c=i.find((t=>t!==s&&(e=null==n.get(t)?void 0:a[t][o],e))),c&&e&&r.set(o,[{path:t,page:s},{path:e,page:c}])}}))})),r.size>0){let e="";r.forEach((t=>{t.forEach(((t,n)=>{const r=t.page!==t.path;n>0&&(e+="conflicts with "),e+=`path: "${t.path}"${r?` from page: "${t.page}" `:" "}`})),e+="\n"})),_log.error("Conflicting paths returned from getStaticPaths, paths must be unique per page.\nSee more info here: https://nextjs.org/docs/messages/conflicting-ssg-paths\n\n"+e),process.exit(1)}}async function copyTracedFiles(e,t,n,r,i,a,s,o,c,l){const p=_path.default.join(t,"standalone");let u=!1;const d={...a,distDir:`./${_path.default.relative(e,t)}`};try{const e=_path.default.join(t,"../package.json");u="module"===JSON.parse(await _fs.promises.readFile(e,"utf8")).type}catch{}const f=new Set;async function m(e){const t=JSON.parse(await _fs.promises.readFile(e,"utf8")),n=new _asyncsema.Sema(10,{capacity:t.files.length}),r=_path.default.dirname(e);await Promise.all(t.files.map((async e=>{await n.acquire();const t=_path.default.join(r,e),a=_path.default.join(p,_path.default.relative(i,t));if(!f.has(a)){f.add(a),await _fs.promises.mkdir(_path.default.dirname(a),{recursive:!0});const e=await _fs.promises.readlink(t).catch((()=>null));if(e)try{await _fs.promises.symlink(e,a)}catch(e){if("EEXIST"!==e.code)throw e}else await _fs.promises.copyFile(t,a)}await n.release()})))}async function _(e){var n,r;async function a(e){const n=_path.default.join(t,e),r=_path.default.join(p,_path.default.relative(i,t),e);await _fs.promises.mkdir(_path.default.dirname(r),{recursive:!0}),await _fs.promises.copyFile(n,r)}await Promise.all([e.files.map(a),null==(n=e.wasm)?void 0:n.map((e=>a(e.filePath))),null==(r=e.assets)?void 0:r.map((e=>a(e.filePath)))])}await _fs.promises.rm(p,{recursive:!0,force:!0});const g=[];for(const e of Object.values(s.middleware))isMiddlewareFilename(e.name)&&g.push(_(e));for(const e of Object.values(s.functions))g.push(_(e));await Promise.all(g);for(const e of n){if(s.functions.hasOwnProperty(e))continue;const n=(0,_normalizepagepath.normalizePagePath)(e);if(l.has(n))continue;const r=_path.default.join(t,"server","pages",`${(0,_normalizepagepath.normalizePagePath)(e)}.js`),i=`${r}.nft.json`;await m(i).catch((t=>{("ENOENT"!==t.code||"/404"!==e&&"/500"!==e)&&_log.warn(`Failed to copy traced files for ${r}`,t)}))}if(o){const e=`${_path.default.join(t,"server","middleware.js")}.nft.json`;await m(e)}if(r)for(const e of r){if(s.functions.hasOwnProperty(e))continue;const n=_path.default.join(t,"server","app",`${e}.js`),r=`${n}.nft.json`;await m(r).catch((e=>{_log.warn(`Failed to copy traced files for ${n}`,e)}))}c&&await m(_path.default.join(t,"server","instrumentation.js.nft.json")),await m(_path.default.join(t,"next-server.js.nft.json"));const h=_path.default.join(p,_path.default.relative(i,e),"server.js");await _fs.promises.mkdir(_path.default.dirname(h),{recursive:!0}),await _fs.promises.writeFile(h,`${u?"performance.mark('next-start');\nimport path from 'path'\nimport { fileURLToPath } from 'url'\nimport module from 'module'\nconst require = module.createRequire(import.meta.url)\nconst __dirname = fileURLToPath(new URL('.', import.meta.url))\n":"const path = require('path')"}\n\nconst dir = path.join(__dirname)\n\nprocess.env.NODE_ENV = 'production'\nprocess.chdir(__dirname)\n\nconst currentPort = parseInt(process.env.PORT, 10) || 3000\nconst hostname = process.env.HOSTNAME || '0.0.0.0'\n\nlet keepAliveTimeout = parseInt(process.env.KEEP_ALIVE_TIMEOUT, 10)\nconst nextConfig = ${JSON.stringify(d)}\n\nprocess.env.__NEXT_PRIVATE_STANDALONE_CONFIG = JSON.stringify(nextConfig)\n\nrequire('next')\nconst { startServer } = require('next/dist/server/lib/start-server')\n\nif (\n  Number.isNaN(keepAliveTimeout) ||\n  !Number.isFinite(keepAliveTimeout) ||\n  keepAliveTimeout < 0\n) {\n  keepAliveTimeout = undefined\n}\n\nstartServer({\n  dir,\n  isDev: false,\n  config: nextConfig,\n  hostname,\n  port: currentPort,\n  allowRetry: false,\n  keepAliveTimeout,\n}).catch((err) => {\n  console.error(err);\n  process.exit(1);\n});`)}function isReservedPage(e){return RESERVED_PAGE.test(e)}function isAppBuiltinNotFoundPage(e){return/next[\\/]dist[\\/]client[\\/]components[\\/]not-found-error/.test(e)}function isCustomErrorPage(e){return"/404"===e||"/500"===e}function isMiddlewareFile(e){return e===`/${_constants.MIDDLEWARE_FILENAME}`||e===`/src/${_constants.MIDDLEWARE_FILENAME}`}function isInstrumentationHookFile(e){return e===`/${_constants.INSTRUMENTATION_HOOK_FILENAME}`||e===`/src/${_constants.INSTRUMENTATION_HOOK_FILENAME}`}function getPossibleInstrumentationHookFilenames(e,t){const n=[];for(const r of t)n.push(_path.default.join(e,`${_constants.INSTRUMENTATION_HOOK_FILENAME}.${r}`),_path.default.join(e,"src",`${_constants.INSTRUMENTATION_HOOK_FILENAME}.${r}`));return n}function getPossibleMiddlewareFilenames(e,t){return t.map((t=>_path.default.join(e,`${_constants.MIDDLEWARE_FILENAME}.${t}`)))}class NestedMiddlewareError extends Error{constructor(e,t,n){super(`Nested Middleware is not allowed, found:\n${e.map((e=>`pages${e}`)).join("\n")}\nPlease move your code to a single file at ${_path.default.join(_path.default.posix.sep,_path.default.relative(t,_path.default.resolve(n,"..")),"middleware")} instead.\nRead More - https://nextjs.org/docs/messages/nested-middleware`)}}function getSupportedBrowsers(e,t){let n;try{const r=_browserslist.default.loadConfig({path:e,env:t?"development":"production"});r&&r.length>0&&(n=(0,_browserslist.default)(r))}catch{}return n&&n.length>0?n:_constants1.MODERN_BROWSERSLIST_TARGET}function isWebpackServerOnlyLayer(e){return Boolean(e&&_constants.WEBPACK_LAYERS.GROUP.serverOnly.includes(e))}function isWebpackClientOnlyLayer(e){return Boolean(e&&_constants.WEBPACK_LAYERS.GROUP.clientOnly.includes(e))}function isWebpackDefaultLayer(e){return null==e||e===_constants.WEBPACK_LAYERS.pagesDirBrowser||e===_constants.WEBPACK_LAYERS.pagesDirEdge||e===_constants.WEBPACK_LAYERS.pagesDirNode}function isWebpackBundledLayer(e){return Boolean(e&&_constants.WEBPACK_LAYERS.GROUP.bundled.includes(e))}function isWebpackAppPagesLayer(e){return Boolean(e&&_constants.WEBPACK_LAYERS.GROUP.appPages.includes(e))}function collectMeta({status:e,headers:t}){const n={};if(200!==e&&(n.status=e),t&&Object.keys(t).length){n.headers={};for(const e in t){if("x-middleware-set-cookie"===e)continue;let r=t[e];Array.isArray(r)&&(r="set-cookie"===e?r.join(","):r[r.length-1]),"string"==typeof r&&(n.headers[e]=r)}}return n}