"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{default:function(){return loadJsConfig},parseJsonFile:function(){return parseJsonFile}});const _path=_interop_require_default(require("path")),_fs=_interop_require_wildcard(require("fs")),_log=_interop_require_wildcard(require("./output/log")),_getTypeScriptConfiguration=require("../lib/typescript/getTypeScriptConfiguration"),_iserror=_interop_require_default(require("../lib/is-error")),_hasnecessarydependencies=require("../lib/has-necessary-dependencies");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interop_require_wildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var i={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}return i.default=e,t&&t.set(e,i),i}let TSCONFIG_WARNED=!1;function parseJsonFile(e){const r=require("next/dist/compiled/json5"),t=(0,_fs.readFileSync)(e,"utf8");if(""===t.trim())return{};try{return r.parse(t)}catch(r){if(!(0,_iserror.default)(r))throw r;const{codeFrameColumns:i}=require("next/dist/compiled/babel/code-frame"),n=i(String(t),{start:{line:r.lineNumber||0,column:r.columnNumber||0}},{message:r.message,highlightCode:!0});throw Object.defineProperty(new Error(`Failed to parse "${e}":\n${n}`),"__NEXT_ERROR_CODE",{value:"E232",enumerable:!1,configurable:!0})}}async function loadJsConfig(e,r){var t;let i;try{i=(await(0,_hasnecessarydependencies.hasNecessaryDependencies)(e,[{pkg:"typescript",file:"typescript/lib/typescript.js",exportsRestrict:!0}])).resolved.get("typescript")}catch{}const n=_path.default.join(e,r.typescript.tsconfigPath),o=Boolean(i&&_fs.default.existsSync(n));let s,a;if(o){"tsconfig.json"!==r.typescript.tsconfigPath&&!1===TSCONFIG_WARNED&&(TSCONFIG_WARNED=!0,_log.info(`Using tsconfig file: ${r.typescript.tsconfigPath}`));const e=await Promise.resolve(require(i));a={compilerOptions:(await(0,_getTypeScriptConfiguration.getTypeScriptConfiguration)(e,n,!0)).options},s=_path.default.dirname(n)}const l=_path.default.join(e,"jsconfig.json");let c;return!o&&_fs.default.existsSync(l)&&(a=parseJsonFile(l),s=_path.default.dirname(l)),(null==a||null==(t=a.compilerOptions)?void 0:t.baseUrl)?c={baseUrl:_path.default.resolve(e,a.compilerOptions.baseUrl),isImplicit:!1}:s&&(c={baseUrl:s,isImplicit:!0}),{useTypeScript:o,jsConfig:a,resolvedBaseUrl:c,jsConfigPath:o?n:_fs.default.existsSync(l)?l:void 0}}