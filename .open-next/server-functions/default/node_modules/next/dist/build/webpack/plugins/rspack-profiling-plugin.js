"use strict";function _export(e,a){for(var n in a)Object.defineProperty(e,n,{enumerable:!0,get:a[n]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{RspackProfilingPlugin:function(){return RspackProfilingPlugin},compilationSpans:function(){return compilationSpans}});const _getrspack=require("../../../shared/lib/get-rspack"),pluginName="RspackProfilingPlugin",moduleSpansByCompilation=new WeakMap,compilationSpans=new WeakMap;class RspackProfilingPlugin{constructor({runWebpackSpan:e}){this.runWebpackSpan=e}apply(e){e.hooks.compilation.tap({name:pluginName,stage:-1/0},(e=>{const a=(0,_getrspack.getRspackCore)();moduleSpansByCompilation.set(e,new WeakMap),compilationSpans.set(e,this.runWebpackSpan.traceChild("compilation-"+e.name));const n=this.runWebpackSpan.traceChild(`compilation-${e.name}`);a.NormalModule.getCompilationHooks(e).loader.tap(pluginName,((a,n)=>{var o;const t=null==(o=moduleSpansByCompilation.get(e))?void 0:o.get(n);a.currentTraceSpan=t})),e.hooks.buildModule.tap(pluginName,(a=>{var o;const t=n.traceChild("build-module");t.setAttribute("name",a.userRequest),t.setAttribute("layer",a.layer),null==moduleSpansByCompilation||null==(o=moduleSpansByCompilation.get(e))||o.set(a,t)})),e.hooks.succeedModule.tap(pluginName,(a=>{var n,o;null==moduleSpansByCompilation||null==(o=moduleSpansByCompilation.get(e))||null==(n=o.get(a))||n.stop()}))}))}}