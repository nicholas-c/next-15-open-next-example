"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{decodeMatchers:function(){return decodeMatchers},default:function(){return middlewareLoader},encodeMatchers:function(){return encodeMatchers}});const _getmodulebuildinfo=require("./get-module-build-info"),_constants=require("../../../lib/constants"),_loadentrypoint=require("../../load-entrypoint");function encodeMatchers(e){return Buffer.from(JSON.stringify(e)).toString("base64")}function decodeMatchers(e){return JSON.parse(Buffer.from(e,"base64").toString())}async function middlewareLoader(){const{absolutePagePath:e,page:t,rootDir:r,matchers:o,preferredRegion:n,middlewareConfig:i}=this.getOptions(),a=o?decodeMatchers(o):void 0,d=this.utils.contextify(this.context||this.rootContext,e),s=JSON.parse(Buffer.from(i,"base64").toString()),u=(0,_getmodulebuildinfo.getModuleBuildInfo)(this._module);return u.nextEdgeMiddleware={matchers:a,page:t.replace(new RegExp(`/${_constants.MIDDLEWARE_LOCATION_REGEXP}$`),"")||"/"},u.rootDir=r,u.route={page:t,absolutePagePath:e,preferredRegion:n,middlewareConfig:s},await(0,_loadentrypoint.loadEntrypoint)("middleware",{VAR_USERLAND:d,VAR_DEFINITION_PAGE:t})}