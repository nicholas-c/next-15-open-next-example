"use strict";function _export(t,e){for(var o in e)Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{DropClientPage:function(){return DropClientPage},ampFirstEntryNamesMap:function(){return ampFirstEntryNamesMap}});const _constants=require("../../../shared/lib/constants"),ampFirstEntryNamesMap=new WeakMap,PLUGIN_NAME="DropAmpFirstPagesPlugin";class DropClientPage{apply(t){t.hooks.compilation.tap(PLUGIN_NAME,((t,{normalModuleFactory:e})=>{function o(e){const o=new Set([e]);for(const e of o){const r=t.moduleGraph.getIncomingConnections(e);for(const t of r){if(!t.originModule)return e;o.add(t.originModule)}}return null}function r(t){function e(){const e=o(t.state.module);e&&(e.buildInfo.NEXT_ampFirst=!0)}t.hooks.preDeclarator.tap(PLUGIN_NAME,(t=>{var o;(null==t||null==(o=t.id)?void 0:o.name)===_constants.STRING_LITERAL_DROP_BUNDLE&&e()}))}e.hooks.parser.for("javascript/auto").tap(PLUGIN_NAME,r),e.hooks.parser.for("javascript/esm").tap(PLUGIN_NAME,r),e.hooks.parser.for("javascript/dynamic").tap(PLUGIN_NAME,r),ampFirstEntryNamesMap.has(t)||ampFirstEntryNamesMap.set(t,[]);const n=ampFirstEntryNamesMap.get(t);t.hooks.seal.tap(PLUGIN_NAME,(()=>{for(const[o,r]of t.entries)for(const a of r.dependencies){var e;const r=t.moduleGraph.getModule(a);(null==r||null==(e=r.buildInfo)?void 0:e.NEXT_ampFirst)&&(n.push(o),t.entries.delete(o))}}))}))}constructor(){this.ampPages=new Set}}