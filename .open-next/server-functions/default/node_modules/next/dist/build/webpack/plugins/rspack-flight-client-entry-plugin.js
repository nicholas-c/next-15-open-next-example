"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"RspackFlightClientEntryPlugin",{enumerable:!0,get:function(){return RspackFlightClientEntryPlugin}});const _ondemandentryhandler=require("../../../server/dev/on-demand-entry-handler"),_constants=require("../../../shared/lib/constants"),_buildcontext=require("../../build-context"),_pagetypes=require("../../../lib/page-types"),_getrspack=require("../../../shared/lib/get-rspack"),pluginState=(0,_buildcontext.getProxiedPluginState)({serverActions:{},edgeServerActions:{},serverActionModules:{},edgeServerActionModules:{},ssrModules:{},edgeSsrModules:{},rscModules:{},edgeRscModules:{},injectedClientEntries:{}});class RspackFlightClientEntryPlugin{constructor(e){const{FlightClientEntryPlugin:t}=(0,_getrspack.getRspackCore)();this.plugin=new t({...e,builtinAppLoader:!!process.env.BUILTIN_SWC_LOADER,shouldInvalidateCb:({bundlePath:e,entryName:t,absolutePagePath:n,clientBrowserLoader:s})=>{let r=!1;const i=this.compiler,l=(0,_ondemandentryhandler.getEntries)(i.outputPath),a=(0,_ondemandentryhandler.getEntryKey)(_constants.COMPILER_NAMES.client,_pagetypes.PAGE_TYPES.APP,e);if(l[a]){const e=l[a];e.request!==s&&(e.request=s,r=!0),e.type===_ondemandentryhandler.EntryTypes.CHILD_ENTRY&&e.parentEntries.add(t),e.dispose=!1,e.lastActiveTime=Date.now()}else l[a]={type:_ondemandentryhandler.EntryTypes.CHILD_ENTRY,parentEntries:new Set([t]),absoluteEntryFilePath:n,bundlePath:e,request:s,dispose:!1,lastActiveTime:Date.now()},r=!0;return r},invalidateCb:()=>{const e=this.compiler,t=(0,_ondemandentryhandler.getInvalidator)(e.outputPath);t&&t.invalidate([_constants.COMPILER_NAMES.client])},stateCb:e=>{Object.assign(pluginState.serverActions,e.serverActions),Object.assign(pluginState.edgeServerActions,e.edgeServerActions),Object.assign(pluginState.serverActionModules,e.serverActionModules),Object.assign(pluginState.edgeServerActionModules,e.edgeServerActionModules),Object.assign(pluginState.ssrModules,e.ssrModules),Object.assign(pluginState.edgeSsrModules,e.edgeSsrModules),Object.assign(pluginState.rscModules,e.rscModules),Object.assign(pluginState.edgeRscModules,e.edgeRscModules),Object.assign(pluginState.injectedClientEntries,e.injectedClientEntries)}})}apply(e){this.compiler=e,this.plugin.apply(e)}}