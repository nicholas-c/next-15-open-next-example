"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"AppBuildManifestPlugin",{enumerable:!0,get:function(){return AppBuildManifestPlugin}});const _webpack=require("next/dist/compiled/webpack/webpack"),_constants=require("../../../shared/lib/constants"),_buildmanifestplugin=require("./build-manifest-plugin"),_getapproutefromentrypoint=_interop_require_default(require("../../../server/get-app-route-from-entrypoint"));function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}const PLUGIN_NAME="AppBuildManifestPlugin";class AppBuildManifestPlugin{constructor(e){this.dev=e.dev}apply(e){e.hooks.make.tap(PLUGIN_NAME,(e=>{e.hooks.processAssets.tap({name:PLUGIN_NAME,stage:_webpack.webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS},(()=>this.createAsset(e)))}))}createAsset(e){const t={pages:{}},n=new Set((0,_buildmanifestplugin.getEntrypointFiles)(e.entrypoints.get(_constants.CLIENT_STATIC_FILES_RUNTIME_MAIN_APP)));for(const s of e.entrypoints.values()){if(!s.name)continue;if(_constants.SYSTEM_ENTRYPOINTS.has(s.name))continue;const e=(0,_getapproutefromentrypoint.default)(s.name);if(!e)continue;const i=(0,_buildmanifestplugin.getEntrypointFiles)(s);t.pages[e]=[...new Set([...n,...i])]}const s=JSON.stringify(t,null,2);e.emitAsset(_constants.APP_BUILD_MANIFEST,new _webpack.sources.RawSource(s))}}