"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"NextJsRequireCacheHotReloader",{enumerable:!0,get:function(){return NextJsRequireCacheHotReloader}});const _requirecache=require("../../../server/dev/require-cache"),_sandbox=require("../../../server/web/sandbox"),_path=_interop_require_default(require("path"));function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}const RUNTIME_NAMES=["webpack-runtime","webpack-api-runtime"],PLUGIN_NAME="NextJsRequireCacheHotReloader";class NextJsRequireCacheHotReloader{constructor(e){this.prevAssets=null,this.serverComponents=e.serverComponents}apply(e){e.hooks.assetEmitted.tap(PLUGIN_NAME,((e,{targetPath:t})=>{(0,_sandbox.clearModuleContext)(t),(0,_requirecache.deleteCache)(t)})),e.hooks.afterEmit.tapPromise(PLUGIN_NAME,(async e=>{for(const t of RUNTIME_NAMES){const r=_path.default.join(e.outputOptions.path,`${t}.js`);(0,_requirecache.deleteCache)(r)}const t=[...e.entrypoints.keys()].filter((e=>{const t=e.toString().startsWith("app/");return e.toString().startsWith("pages/")||t}));for(const r of t){const t=_path.default.join(e.outputOptions.path,r+".js");(0,_requirecache.deleteCache)(t)}}))}}