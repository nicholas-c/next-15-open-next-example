"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return _default}});const _icssutils=require("next/dist/compiled/icss-utils"),_utils=require("../utils"),plugin=(e={})=>({postcssPlugin:"postcss-icss-parser",async OnceExit(s){const t=Object.create(null),{icssImports:i,icssExports:o}=(0,_icssutils.extractICSS)(s),n=new Map,r=[];for(const s in i){const t=i[s];if(0===Object.keys(t).length)continue;let o=s,n="";const l=o.split("!");l.length>1&&(o=l.pop(),n=l.join("!"));const c=(0,_utils.requestify)((0,_utils.normalizeUrl)(o,!0),e.rootContext),u=async()=>{const{resolver:s,context:i}=e,r=await(0,_utils.resolveRequests)(s,i,[...new Set([o,c])]);if(r)return{url:r,prefix:n,tokens:t}};r.push(u())}const l=await Promise.all(r);for(let s=0;s<=l.length-1;s++){const i=l[s];if(!i)continue;const o=i.prefix?`${i.prefix}!${i.url}`:i.url,r=o;let c=n.get(r);c||(c=`___CSS_LOADER_ICSS_IMPORT_${n.size}___`,n.set(r,c),e.imports.push({type:"icss_import",importName:c,url:e.urlHandler(o),icss:!0,index:s}),e.api.push({importName:c,dedupe:!0,index:s}));for(const[o,n]of Object.keys(i.tokens).entries()){const r=`___CSS_LOADER_ICSS_IMPORT_${s}_REPLACEMENT_${o}___`,l=i.tokens[n];t[n]=r,e.replacements.push({replacementName:r,importName:c,localName:l})}}Object.keys(t).length>0&&(0,_icssutils.replaceSymbols)(s,t);for(const s of Object.keys(o)){const i=(0,_icssutils.replaceValueSymbols)(o[s],t);e.exports.push({name:s,value:i})}}});plugin.postcss=!0;const _default=plugin;