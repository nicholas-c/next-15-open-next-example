"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{default:function(){return transformSource},getAssumedSourceType:function(){return getAssumedSourceType}});const _constants=require("../../../../lib/constants"),_constants1=require("../../../../shared/lib/constants"),_warnonce=require("../../../../shared/lib/utils/warn-once"),_getpagestaticinfo=require("../../../analysis/get-page-static-info"),_utils=require("../../utils"),_getmodulebuildinfo=require("../get-module-build-info"),noopHeadPath=require.resolve("next/dist/client/components/noop-head"),MODULE_PROXY_PATH="next/dist/build/webpack/loaders/next-flight-loader/module-proxy";function getAssumedSourceType(e,t){var r,n;const o=(0,_getmodulebuildinfo.getModuleBuildInfo)(e),i=null==o||null==(r=o.rsc)?void 0:r.clientEntryType,s=(null==o||null==(n=o.rsc)?void 0:n.clientRefs)||[];if("auto"===t)if("auto"===i){if(0===s.length)return"commonjs";if(!s.includes("*"))return"module"}else if("cjs"===i)return"commonjs";return t}function transformSource(e,t){var r,n,o;if("string"!=typeof e)throw Object.defineProperty(new Error("Expected source to have been transformed to a string."),"__NEXT_ERROR_CODE",{value:"E429",enumerable:!1,configurable:!0});const i=this._module,s=(0,_getmodulebuildinfo.getModuleBuildInfo)(i);s.rsc=(0,_getpagestaticinfo.getRSCModuleInformation)(e,!0);let a="";if(process.env.BUILTIN_FLIGHT_CLIENT_ENTRY_PLUGIN){a=`/* __rspack_internal_rsc_module_information_do_not_use__ ${JSON.stringify(s.rsc)} */\n`,e=a+e}let l=this.resourcePath;if((null==(r=i.matchResource)?void 0:r.startsWith(_constants1.BARREL_OPTIMIZATION_PREFIX))&&(l=(0,_utils.formatBarrelOptimizedResource)(l,i.matchResource)),(null==(n=s.rsc)?void 0:n.type)===_constants1.RSC_MODULE_TYPES.client){const e=getAssumedSourceType(i,sourceTypeFromModule(i)),r=s.rsc.clientRefs,n=JSON.stringify(l);if("module"===e){if(0===r.length)return this.callback(null,"export {}");if(r.includes("*"))return void this.callback(Object.defineProperty(new Error('It\'s currently unsupported to use "export *" in a client boundary. Please use named exports instead.'),"__NEXT_ERROR_CODE",{value:"E46",enumerable:!1,configurable:!0}));let e=a+'import { registerClientReference } from "react-server-dom-webpack/server.edge";\n';for(const t of r)e+="default"===t?`export default registerClientReference(\nfunction() { throw new Error(${JSON.stringify(`Attempted to call the default export of ${n} from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.`)}); },\n${n},\n"default",\n);\n`:`export const ${t} = registerClientReference(\nfunction() { throw new Error(${JSON.stringify(`Attempted to call ${t}() from the server but ${t} is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.`)}); },\n${n},\n${JSON.stringify(t)},\n);`;return this.callback(null,e,t)}if("commonjs"===e){let e=a+`const { createProxy } = require("${MODULE_PROXY_PATH}")\n\nmodule.exports = createProxy(${n})\n`;return this.callback(null,e,t)}}(null==(o=s.rsc)?void 0:o.type)!==_constants1.RSC_MODULE_TYPES.client&&noopHeadPath===this.resourcePath&&(0,_warnonce.warnOnce)("Warning: You're using `next/head` inside the `app` directory, please migrate to the Metadata API. See https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration#step-3-migrating-nexthead for more details.");const u=e.replace(_constants.RSC_MOD_REF_PROXY_ALIAS,MODULE_PROXY_PATH);this.callback(null,u,t)}function sourceTypeFromModule(e){const t=e.type;switch(t){case"javascript/auto":return"auto";case"javascript/dynamic":return"script";case"javascript/esm":return"module";default:throw Object.defineProperty(new Error("Unexpected module type "+t),"__NEXT_ERROR_CODE",{value:"E651",enumerable:!1,configurable:!0})}}