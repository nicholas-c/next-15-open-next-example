"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"MemoryWithGcCachePlugin",{enumerable:!0,get:function(){return MemoryWithGcCachePlugin}});const CACHE_STAGE_MEMORY=-10,PLUGIN_NAME="NextJsMemoryWithGcCachePlugin";class MemoryWithGcCachePlugin{constructor({maxGenerations:t}){this.maxGenerations=t}apply(t){const e=this.maxGenerations,a=new Map;function n(){for(const[t,e]of a)e.ttl--,e.ttl<=0&&a.delete(t)}t.hooks.afterDone.tap(PLUGIN_NAME,n),t.cache.hooks.store.tap({name:PLUGIN_NAME,stage:CACHE_STAGE_MEMORY},((t,n,o)=>{a.set(t,{etag:n,data:o,ttl:e})})),t.cache.hooks.get.tap({name:PLUGIN_NAME,stage:CACHE_STAGE_MEMORY},((t,n,o)=>{const s=a.get(t);if(void 0!==s)return s.ttl=e,null===s.data?null:s.etag===n?s.data:null;o.push(((o,s)=>(a.set(t,{etag:null===o?null:n,data:o,ttl:e}),s())))})),t.cache.hooks.shutdown.tap({name:PLUGIN_NAME,stage:CACHE_STAGE_MEMORY},(()=>{a.clear()}))}}