"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{default:function(){return _default},handleClientScriptLoad:function(){return handleClientScriptLoad},initScriptLoader:function(){return initScriptLoader}});const _interop_require_default=require("@swc/helpers/_/_interop_require_default"),_interop_require_wildcard=require("@swc/helpers/_/_interop_require_wildcard"),_jsxruntime=require("react/jsx-runtime"),_reactdom=_interop_require_default._(require("react-dom")),_react=_interop_require_wildcard._(require("react")),_headmanagercontextsharedruntime=require("../shared/lib/head-manager-context.shared-runtime"),_setattributesfromprops=require("./set-attributes-from-props"),_requestidlecallback=require("./request-idle-callback"),ScriptCache=new Map,LoadCache=new Set,insertStylesheets=e=>{if(_reactdom.default.preinit)e.forEach((e=>{_reactdom.default.preinit(e,{as:"style"})}));else if("undefined"!=typeof window){let t=document.head;e.forEach((e=>{let r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.appendChild(r)}))}},loadScript=e=>{const{src:t,id:r,onLoad:n=(()=>{}),onReady:a=null,dangerouslySetInnerHTML:i,children:o="",strategy:c="afterInteractive",onError:s,stylesheets:d}=e,l=r||t;if(l&&LoadCache.has(l))return;if(ScriptCache.has(t))return LoadCache.add(l),void ScriptCache.get(t).then(n,s);const u=()=>{a&&a(),LoadCache.add(l)},p=document.createElement("script"),f=new Promise(((e,t)=>{p.addEventListener("load",(function(t){e(),n&&n.call(this,t),u()})),p.addEventListener("error",(function(e){t(e)}))})).catch((function(e){s&&s(e)}));i?(p.innerHTML=i.__html||"",u()):o?(p.textContent="string"==typeof o?o:Array.isArray(o)?o.join(""):"",u()):t&&(p.src=t,ScriptCache.set(t,f)),(0,_setattributesfromprops.setAttributesFromProps)(p,e),"worker"===c&&p.setAttribute("type","text/partytown"),p.setAttribute("data-nscript",c),d&&insertStylesheets(d),document.body.appendChild(p)};function handleClientScriptLoad(e){const{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",(()=>{(0,_requestidlecallback.requestIdleCallback)((()=>loadScript(e)))})):loadScript(e)}function loadLazyScript(e){"complete"===document.readyState?(0,_requestidlecallback.requestIdleCallback)((()=>loadScript(e))):window.addEventListener("load",(()=>{(0,_requestidlecallback.requestIdleCallback)((()=>loadScript(e)))}))}function addBeforeInteractiveToCache(){[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach((e=>{const t=e.id||e.getAttribute("src");LoadCache.add(t)}))}function initScriptLoader(e){e.forEach(handleClientScriptLoad),addBeforeInteractiveToCache()}function Script(e){const{id:t,src:r="",onLoad:n=(()=>{}),onReady:a=null,strategy:i="afterInteractive",onError:o,stylesheets:c,...s}=e,{updateScripts:d,scripts:l,getIsSsr:u,appDir:p,nonce:f}=(0,_react.useContext)(_headmanagercontextsharedruntime.HeadManagerContext),_=(0,_react.useRef)(!1);(0,_react.useEffect)((()=>{const e=t||r;_.current||(a&&e&&LoadCache.has(e)&&a(),_.current=!0)}),[a,t,r]);const h=(0,_react.useRef)(!1);if((0,_react.useEffect)((()=>{h.current||("afterInteractive"===i?loadScript(e):"lazyOnload"===i&&loadLazyScript(e),h.current=!0)}),[e,i]),"beforeInteractive"!==i&&"worker"!==i||(d?(l[i]=(l[i]||[]).concat([{id:t,src:r,onLoad:n,onReady:a,onError:o,...s}]),d(l)):u&&u()?LoadCache.add(t||r):u&&!u()&&loadScript(e)),p){if(c&&c.forEach((e=>{_reactdom.default.preinit(e,{as:"style"})})),"beforeInteractive"===i)return r?(_reactdom.default.preload(r,s.integrity?{as:"script",integrity:s.integrity,nonce:f,crossOrigin:s.crossOrigin}:{as:"script",nonce:f,crossOrigin:s.crossOrigin}),(0,_jsxruntime.jsx)("script",{nonce:f,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([r,{...s,id:t}])+")"}})):(s.dangerouslySetInnerHTML&&(s.children=s.dangerouslySetInnerHTML.__html,delete s.dangerouslySetInnerHTML),(0,_jsxruntime.jsx)("script",{nonce:f,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([0,{...s,id:t}])+")"}}));"afterInteractive"===i&&r&&_reactdom.default.preload(r,s.integrity?{as:"script",integrity:s.integrity,nonce:f,crossOrigin:s.crossOrigin}:{as:"script",nonce:f,crossOrigin:s.crossOrigin})}return null}Object.defineProperty(Script,"__nextScript",{value:!0});const _default=Script;("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);