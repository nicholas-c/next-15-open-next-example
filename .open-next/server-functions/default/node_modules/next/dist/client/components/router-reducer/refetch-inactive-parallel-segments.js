"use strict";function _export(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{addRefreshMarkerToActiveParallelSegments:function(){return addRefreshMarkerToActiveParallelSegments},refreshInactiveParallelSegments:function(){return refreshInactiveParallelSegments}});const _applyflightdata=require("./apply-flight-data"),_fetchserverresponse=require("./fetch-server-response"),_segment=require("../../../shared/lib/segment");async function refreshInactiveParallelSegments(e){const t=new Set;await refreshInactiveParallelSegmentsImpl({...e,rootTree:e.updatedTree,fetchedSegments:t})}async function refreshInactiveParallelSegmentsImpl(e){let{state:t,updatedTree:r,updatedCache:a,includeNextUrl:l,fetchedSegments:n,rootTree:s=r,canonicalUrl:o}=e;const[,f,c,i]=r,d=[];if(c&&c!==o&&"refresh"===i&&!n.has(c)){n.add(c);const e=(0,_fetchserverresponse.fetchServerResponse)(new URL(c,location.origin),{flightRouterState:[s[0],s[1],s[2],"refetch"],nextUrl:l?t.nextUrl:null}).then((e=>{let{flightData:t}=e;if("string"!=typeof t)for(const e of t)(0,_applyflightdata.applyFlightData)(a,a,e)}));d.push(e)}for(const e in f){const r=refreshInactiveParallelSegmentsImpl({state:t,updatedTree:f[e],updatedCache:a,includeNextUrl:l,fetchedSegments:n,rootTree:s,canonicalUrl:o});d.push(r)}await Promise.all(d)}function addRefreshMarkerToActiveParallelSegments(e,t){const[r,a,,l]=e;r.includes(_segment.PAGE_SEGMENT_KEY)&&"refresh"!==l&&(e[2]=t,e[3]="refresh");for(const e in a)addRefreshMarkerToActiveParallelSegments(a[e],t)}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);