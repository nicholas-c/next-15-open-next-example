"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createEmptyCacheNode:function(){return createEmptyCacheNode},createPrefetchURL:function(){return createPrefetchURL},default:function(){return AppRouter}});const _interop_require_wildcard=require("@swc/helpers/_/_interop_require_wildcard"),_jsxruntime=require("react/jsx-runtime"),_react=_interop_require_wildcard._(require("react")),_approutercontextsharedruntime=require("../../shared/lib/app-router-context.shared-runtime"),_routerreducertypes=require("./router-reducer/router-reducer-types"),_createhreffromurl=require("./router-reducer/create-href-from-url"),_hooksclientcontextsharedruntime=require("../../shared/lib/hooks-client-context.shared-runtime"),_usereducer=require("./use-reducer"),_errorboundary=_interop_require_wildcard._(require("./error-boundary")),_isbot=require("../../shared/lib/router/utils/is-bot"),_addbasepath=require("../add-base-path"),_approuterannouncer=require("./app-router-announcer"),_redirectboundary=require("./redirect-boundary"),_findheadincache=require("./router-reducer/reducers/find-head-in-cache"),_unresolvedthenable=require("./unresolved-thenable"),_removebasepath=require("../remove-base-path"),_hasbasepath=require("../has-base-path"),_computechangedpath=require("./router-reducer/compute-changed-path"),_navfailurehandler=require("./nav-failure-handler"),_appcallserver=require("../app-call-server"),_prefetch=require("../components/segment-cache/prefetch"),_redirect=require("./redirect"),_redirecterror=require("./redirect-error"),_prefetchreducer=require("./router-reducer/reducers/prefetch-reducer"),_link=require("../app-dir/link"),globalMutable={};function isExternalURL(e){return e.origin!==window.location.origin}function createPrefetchURL(e){if((0,_isbot.isBot)(window.navigator.userAgent))return null;let r;try{r=new URL((0,_addbasepath.addBasePath)(e),window.location.href)}catch(r){throw Object.defineProperty(new Error("Cannot prefetch '"+e+"' because it cannot be converted to a URL."),"__NEXT_ERROR_CODE",{value:"E234",enumerable:!1,configurable:!0})}return"development"===process.env.NODE_ENV||isExternalURL(r)?null:r}function HistoryUpdater(e){let{appRouterState:r}=e;return(0,_react.useInsertionEffect)((()=>{process.env.__NEXT_APP_NAV_FAIL_HANDLING&&(window.next.__pendingUrl=void 0);const{tree:e,pushRef:t,canonicalUrl:n}=r,o={...t.preserveCustomHistoryState?window.history.state:{},__NA:!0,__PRIVATE_NEXTJS_INTERNALS_TREE:e};t.pendingPush&&(0,_createhreffromurl.createHrefFromUrl)(new URL(window.location.href))!==n?(t.pendingPush=!1,window.history.pushState(o,"",n)):window.history.replaceState(o,"",n)}),[r]),(0,_react.useEffect)((()=>{process.env.__NEXT_CLIENT_SEGMENT_CACHE&&(0,_link.pingVisibleLinks)(r.nextUrl,r.tree)}),[r.nextUrl,r.tree]),null}function createEmptyCacheNode(){return{lazyData:null,rsc:null,prefetchRsc:null,head:null,prefetchHead:null,parallelRoutes:new Map,loading:null}}function useChangeByServerResponse(e){return(0,_react.useCallback)((r=>{let{previousTree:t,serverResponse:n}=r;(0,_react.startTransition)((()=>{e({type:_routerreducertypes.ACTION_SERVER_PATCH,previousTree:t,serverResponse:n})}))}),[e])}function useNavigate(e){return(0,_react.useCallback)(((r,t,n)=>{const o=new URL((0,_addbasepath.addBasePath)(r),location.href);return process.env.__NEXT_APP_NAV_FAIL_HANDLING&&(window.next.__pendingUrl=o),e({type:_routerreducertypes.ACTION_NAVIGATE,url:o,isExternalUrl:isExternalURL(o),locationSearch:location.search,shouldScroll:null==n||n,navigateType:t,allowAliasing:!0})}),[e])}function copyNextJsInternalHistoryState(e){null==e&&(e={});const r=window.history.state,t=null==r?void 0:r.__NA;t&&(e.__NA=t);const n=null==r?void 0:r.__PRIVATE_NEXTJS_INTERNALS_TREE;return n&&(e.__PRIVATE_NEXTJS_INTERNALS_TREE=n),e}function Head(e){let{headCacheNode:r}=e;const t=null!==r?r.head:null,n=null!==r?r.prefetchHead:null,o=null!==n?n:t;return(0,_react.useDeferredValue)(t,o)}function Router(e){let{actionQueue:r,assetPrefix:t,globalError:n}=e;const[o,a]=(0,_usereducer.useReducer)(r),{canonicalUrl:i}=(0,_usereducer.useUnwrapState)(o),{searchParams:s,pathname:u}=(0,_react.useMemo)((()=>{const e=new URL(i,"undefined"==typeof window?"http://n":window.location.href);return{searchParams:e.searchParams,pathname:(0,_hasbasepath.hasBasePath)(e.pathname)?(0,_removebasepath.removeBasePath)(e.pathname):e.pathname}}),[i]),c=useChangeByServerResponse(a),l=useNavigate(a);(0,_appcallserver.useServerActionDispatcher)(a);const d=(0,_react.useMemo)((()=>({back:()=>window.history.back(),forward:()=>window.history.forward(),prefetch:process.env.__NEXT_CLIENT_SEGMENT_CACHE?(e,t)=>(0,_prefetch.prefetch)(e,r.state.nextUrl,r.state.tree,(null==t?void 0:t.kind)===_routerreducertypes.PrefetchKind.FULL):(e,t)=>{const n=createPrefetchURL(e);var o;null!==n&&(0,_prefetchreducer.prefetchReducer)(r.state,{type:_routerreducertypes.ACTION_PREFETCH,url:n,kind:null!=(o=null==t?void 0:t.kind)?o:_routerreducertypes.PrefetchKind.FULL})},replace:(e,r)=>{void 0===r&&(r={}),(0,_react.startTransition)((()=>{var t;l(e,"replace",null==(t=r.scroll)||t)}))},push:(e,r)=>{void 0===r&&(r={}),(0,_react.startTransition)((()=>{var t;l(e,"push",null==(t=r.scroll)||t)}))},refresh:()=>{(0,_react.startTransition)((()=>{a({type:_routerreducertypes.ACTION_REFRESH,origin:window.location.origin})}))},hmrRefresh:()=>{if("development"!==process.env.NODE_ENV)throw Object.defineProperty(new Error("hmrRefresh can only be used in development mode. Please use refresh instead."),"__NEXT_ERROR_CODE",{value:"E485",enumerable:!1,configurable:!0});(0,_react.startTransition)((()=>{a({type:_routerreducertypes.ACTION_HMR_REFRESH,origin:window.location.origin})}))}})),[r,a,l]);if((0,_react.useEffect)((()=>{window.next&&(window.next.router=d)}),[d]),"production"!==process.env.NODE_ENV){const{cache:e,prefetchCache:r,tree:t}=(0,_usereducer.useUnwrapState)(o);(0,_react.useEffect)((()=>{window.nd={router:d,cache:e,prefetchCache:r,tree:t}}),[d,e,r,t])}(0,_react.useEffect)((()=>{function e(e){var r;e.persisted&&(null==(r=window.history.state)?void 0:r.__PRIVATE_NEXTJS_INTERNALS_TREE)&&(globalMutable.pendingMpaPath=void 0,a({type:_routerreducertypes.ACTION_RESTORE,url:new URL(window.location.href),tree:window.history.state.__PRIVATE_NEXTJS_INTERNALS_TREE}))}return window.addEventListener("pageshow",e),()=>{window.removeEventListener("pageshow",e)}}),[a]),(0,_react.useEffect)((()=>{function e(e){const r="reason"in e?e.reason:e.error;if((0,_redirecterror.isRedirectError)(r)){e.preventDefault();const t=(0,_redirect.getURLFromRedirectError)(r);(0,_redirect.getRedirectTypeFromError)(r)===_redirecterror.RedirectType.push?d.push(t,{}):d.replace(t,{})}}return window.addEventListener("error",e),window.addEventListener("unhandledrejection",e),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",e)}}),[d]);const{pushRef:_}=(0,_usereducer.useUnwrapState)(o);if(_.mpaNavigation){if(globalMutable.pendingMpaPath!==i){const e=window.location;_.pendingPush?e.assign(i):e.replace(i),globalMutable.pendingMpaPath=i}(0,_react.use)(_unresolvedthenable.unresolvedThenable)}(0,_react.useEffect)((()=>{const e=window.history.pushState.bind(window.history),r=window.history.replaceState.bind(window.history),t=e=>{var r;const t=window.location.href,n=null==(r=window.history.state)?void 0:r.__PRIVATE_NEXTJS_INTERNALS_TREE;(0,_react.startTransition)((()=>{a({type:_routerreducertypes.ACTION_RESTORE,url:new URL(null!=e?e:t,t),tree:n})}))};window.history.pushState=function(r,n,o){return(null==r?void 0:r.__NA)||(null==r?void 0:r._N)||(r=copyNextJsInternalHistoryState(r),o&&t(o)),e(r,n,o)},window.history.replaceState=function(e,n,o){return(null==e?void 0:e.__NA)||(null==e?void 0:e._N)||(e=copyNextJsInternalHistoryState(e),o&&t(o)),r(e,n,o)};const n=e=>{e.state&&(e.state.__NA?(0,_react.startTransition)((()=>{a({type:_routerreducertypes.ACTION_RESTORE,url:new URL(window.location.href),tree:e.state.__PRIVATE_NEXTJS_INTERNALS_TREE})})):window.location.reload())};return window.addEventListener("popstate",n),()=>{window.history.pushState=e,window.history.replaceState=r,window.removeEventListener("popstate",n)}}),[a]);const{cache:p,tree:h,nextUrl:f,focusAndScrollRef:E}=(0,_usereducer.useUnwrapState)(o),w=(0,_react.useMemo)((()=>(0,_findheadincache.findHeadInCache)(p,h[1])),[p,h]),m=(0,_react.useMemo)((()=>(0,_computechangedpath.getSelectedParams)(h)),[h]),y=(0,_react.useMemo)((()=>({parentTree:h,parentCacheNode:p,parentSegmentPath:null,url:i})),[h,p,i]),v=(0,_react.useMemo)((()=>({changeByServerResponse:c,tree:h,focusAndScrollRef:E,nextUrl:f})),[c,h,E,f]);let R;if(null!==w){const[e,r]=w;R=(0,_jsxruntime.jsx)(Head,{headCacheNode:e},r)}else R=null;let x=(0,_jsxruntime.jsxs)(_redirectboundary.RedirectBoundary,{children:[R,p.rsc,(0,_jsxruntime.jsx)(_approuterannouncer.AppRouterAnnouncer,{tree:h})]});if("production"!==process.env.NODE_ENV){if("undefined"!=typeof window){const{DevRootHTTPAccessFallbackBoundary:e}=require("./dev-root-http-access-fallback-boundary");x=(0,_jsxruntime.jsx)(e,{children:x})}const e=require("./react-dev-overlay/app/hot-reloader-client").default;x=(0,_jsxruntime.jsx)(e,{assetPrefix:t,globalError:n,children:x})}else x=(0,_jsxruntime.jsx)(_errorboundary.ErrorBoundary,{errorComponent:n[0],errorStyles:n[1],children:x});return(0,_jsxruntime.jsxs)(_jsxruntime.Fragment,{children:[(0,_jsxruntime.jsx)(HistoryUpdater,{appRouterState:(0,_usereducer.useUnwrapState)(o)}),(0,_jsxruntime.jsx)(RuntimeStyles,{}),(0,_jsxruntime.jsx)(_hooksclientcontextsharedruntime.PathParamsContext.Provider,{value:m,children:(0,_jsxruntime.jsx)(_hooksclientcontextsharedruntime.PathnameContext.Provider,{value:u,children:(0,_jsxruntime.jsx)(_hooksclientcontextsharedruntime.SearchParamsContext.Provider,{value:s,children:(0,_jsxruntime.jsx)(_approutercontextsharedruntime.GlobalLayoutRouterContext.Provider,{value:v,children:(0,_jsxruntime.jsx)(_approutercontextsharedruntime.AppRouterContext.Provider,{value:d,children:(0,_jsxruntime.jsx)(_approutercontextsharedruntime.LayoutRouterContext.Provider,{value:y,children:x})})})})})})]})}function AppRouter(e){let{actionQueue:r,globalErrorComponentAndStyles:[t,n],assetPrefix:o}=e;return(0,_navfailurehandler.useNavFailureHandler)(),(0,_jsxruntime.jsx)(_errorboundary.ErrorBoundary,{errorComponent:_errorboundary.default,children:(0,_jsxruntime.jsx)(Router,{actionQueue:r,assetPrefix:o,globalError:[t,n]})})}const runtimeStyles=new Set;let runtimeStyleChanged=new Set;function RuntimeStyles(){const[,e]=_react.default.useState(0),r=runtimeStyles.size;(0,_react.useEffect)((()=>{const t=()=>e((e=>e+1));return runtimeStyleChanged.add(t),r!==runtimeStyles.size&&t(),()=>{runtimeStyleChanged.delete(t)}}),[r,e]);const t=process.env.NEXT_DEPLOYMENT_ID?"?dpl="+process.env.NEXT_DEPLOYMENT_ID:"";return[...runtimeStyles].map(((e,r)=>(0,_jsxruntime.jsx)("link",{rel:"stylesheet",href:""+e+t,precedence:"next"},r)))}globalThis._N_E_STYLE_LOAD=function(e){let r=runtimeStyles.size;return runtimeStyles.add(e),runtimeStyles.size!==r&&runtimeStyleChanged.forEach((e=>e())),Promise.resolve()},("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);