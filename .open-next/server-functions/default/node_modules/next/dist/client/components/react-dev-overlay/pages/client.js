"use strict";function _export(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:e[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{getErrorByType:function(){return _geterrorbytype.getErrorByType},getServerError:function(){return _nodestackframes.getServerError},onBeforeRefresh:function(){return onBeforeRefresh},onBuildError:function(){return onBuildError},onBuildOk:function(){return onBuildOk},onDevIndicator:function(){return onDevIndicator},onRefresh:function(){return onRefresh},onStaticIndicator:function(){return onStaticIndicator},onVersionInfo:function(){return onVersionInfo},register:function(){return register},unregister:function(){return unregister}});const _interop_require_wildcard=require("@swc/helpers/_/_interop_require_wildcard"),_bus=_interop_require_wildcard._(require("./bus")),_parsestack=require("../utils/parse-stack"),_parsecomponentstack=require("../utils/parse-component-stack"),_hydrationerrorinfo=require("../../errors/hydration-error-info"),_shared=require("../shared"),_attachhydrationerrorstate=require("../../errors/attach-hydration-error-state"),_geterrorbytype=require("../utils/get-error-by-type"),_nodestackframes=require("../utils/node-stack-frames");let stackTraceLimit,isRegistered=!1;function handleError(r){if(!(r&&r instanceof Error&&"string"==typeof r.stack))return;(0,_attachhydrationerrorstate.attachHydrationErrorState)(r);const e=r._componentStack||_hydrationerrorinfo.hydrationErrorState.componentStack,t="string"==typeof e?(0,_parsecomponentstack.parseComponentStack)(e):void 0;"ModuleBuildError"!==r.name&&"ModuleNotFoundError"!==r.name&&_bus.emit({type:_shared.ACTION_UNHANDLED_ERROR,reason:r,frames:(0,_parsestack.parseStack)(r.stack),componentStackFrames:t})}let origConsoleError=console.error;function nextJsHandleConsoleError(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];const o="production"!==process.env.NODE_ENV?e[1]:e[0];(0,_hydrationerrorinfo.storeHydrationErrorStateFromConsoleArgs)(...e),handleError(o),origConsoleError.apply(window.console,e)}function onUnhandledError(r){handleError(null==r?void 0:r.error)}function onUnhandledRejection(r){const e=null==r?void 0:r.reason;if(!(e&&e instanceof Error&&"string"==typeof e.stack))return;const t=e;_bus.emit({type:_shared.ACTION_UNHANDLED_REJECTION,reason:e,frames:(0,_parsestack.parseStack)(t.stack)})}function register(){if(!isRegistered){isRegistered=!0;try{const r=Error.stackTraceLimit;Error.stackTraceLimit=50,stackTraceLimit=r}catch(r){}window.addEventListener("error",onUnhandledError),window.addEventListener("unhandledrejection",onUnhandledRejection),window.console.error=nextJsHandleConsoleError}}function unregister(){if(isRegistered){if(isRegistered=!1,void 0!==stackTraceLimit){try{Error.stackTraceLimit=stackTraceLimit}catch(r){}stackTraceLimit=void 0}window.removeEventListener("error",onUnhandledError),window.removeEventListener("unhandledrejection",onUnhandledRejection),window.console.error=origConsoleError}}function onBuildOk(){_bus.emit({type:_shared.ACTION_BUILD_OK})}function onBuildError(r){_bus.emit({type:_shared.ACTION_BUILD_ERROR,message:r})}function onRefresh(){_bus.emit({type:_shared.ACTION_REFRESH})}function onBeforeRefresh(){_bus.emit({type:_shared.ACTION_BEFORE_REFRESH})}function onVersionInfo(r){_bus.emit({type:_shared.ACTION_VERSION_INFO,versionInfo:r})}function onStaticIndicator(r){_bus.emit({type:_shared.ACTION_STATIC_INDICATOR,staticIndicator:r})}function onDevIndicator(r){_bus.emit({type:_shared.ACTION_DEV_INDICATOR,devIndicator:r})}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);