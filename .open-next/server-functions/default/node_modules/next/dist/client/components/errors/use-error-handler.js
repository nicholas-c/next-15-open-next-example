"use strict";function _export(e,r){for(var o in r)Object.defineProperty(e,o,{enumerable:!0,get:r[o]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{handleClientError:function(){return handleClientError},handleGlobalErrors:function(){return handleGlobalErrors},useErrorHandler:function(){return useErrorHandler}});const _interop_require_default=require("@swc/helpers/_/_interop_require_default"),_react=require("react"),_attachhydrationerrorstate=require("./attach-hydration-error-state"),_isnextroutererror=require("../is-next-router-error"),_hydrationerrorinfo=require("./hydration-error-info"),_console=require("../../lib/console"),_iserror=_interop_require_default._(require("../../../lib/is-error")),_consoleerror=require("./console-error"),_enqueueclienterror=require("./enqueue-client-error"),_stitchederror=require("../errors/stitched-error"),queueMicroTask=globalThis.queueMicrotask||(e=>Promise.resolve().then(e)),errorQueue=[],errorHandlers=[],rejectionQueue=[],rejectionHandlers=[];function handleClientError(e,r,o){let t;if(void 0===o&&(o=!1),e&&(0,_iserror.default)(e))t=o?(0,_consoleerror.createUnhandledError)(e):e;else{const e=(0,_console.formatConsoleArgs)(r),{environmentName:o}=(0,_console.parseConsoleArgs)(r);t=(0,_consoleerror.createUnhandledError)(e,o)}t=(0,_stitchederror.getReactStitchedError)(t),(0,_hydrationerrorinfo.storeHydrationErrorStateFromConsoleArgs)(...r),(0,_attachhydrationerrorstate.attachHydrationErrorState)(t),(0,_enqueueclienterror.enqueueConsecutiveDedupedError)(errorQueue,t);for(const e of errorHandlers)queueMicroTask((()=>{e(t)}))}function useErrorHandler(e,r){(0,_react.useEffect)((()=>(errorQueue.forEach(e),rejectionQueue.forEach(r),errorHandlers.push(e),rejectionHandlers.push(r),()=>{errorHandlers.splice(errorHandlers.indexOf(e),1),rejectionHandlers.splice(rejectionHandlers.indexOf(r),1),errorQueue.splice(0,errorQueue.length),rejectionQueue.splice(0,rejectionQueue.length)})),[e,r])}function onUnhandledError(e){if((0,_isnextroutererror.isNextRouterError)(e.error))return e.preventDefault(),!1;e.error&&handleClientError(e.error,[])}function onUnhandledRejection(e){const r=null==e?void 0:e.reason;if((0,_isnextroutererror.isNextRouterError)(r))return void e.preventDefault();let o=r;o&&!(0,_iserror.default)(o)&&(o=(0,_consoleerror.createUnhandledError)(o+"")),rejectionQueue.push(o);for(const e of rejectionHandlers)e(o)}function handleGlobalErrors(){if("undefined"!=typeof window){try{Error.stackTraceLimit=50}catch(e){}window.addEventListener("error",onUnhandledError),window.addEventListener("unhandledrejection",onUnhandledRejection)}}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);