"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"getDevOverlayFontMiddleware",{enumerable:!0,get:function(){return getDevOverlayFontMiddleware}});const _interop_require_default=require("@swc/helpers/_/_interop_require_default"),_interop_require_wildcard=require("@swc/helpers/_/_interop_require_wildcard"),_path=_interop_require_default._(require("path")),_promises=_interop_require_wildcard._(require("fs/promises")),_fs=require("fs"),_log=_interop_require_wildcard._(require("../../../../build/output/log")),_middlewareresponse=require("../server/middleware-response"),FONT_PREFIX="/__nextjs_font/",VALID_FONTS=["geist-latin-ext.woff2","geist-mono-latin-ext.woff2","geist-latin.woff2","geist-mono-latin.woff2"],FONT_HEADERS={"Content-Type":"font/woff2","Cache-Control":"public, max-age=31536000, immutable"};function getDevOverlayFontMiddleware(){return async function(e,r,t){try{const{pathname:o}=new URL("http://n"+e.url);if(!o.startsWith(FONT_PREFIX))return t();const s=o.replace(FONT_PREFIX,"");if(!VALID_FONTS.includes(s))return _middlewareresponse.middlewareResponse.notFound(r);const i=_path.default.resolve(__dirname,s);if(!await checkFileExists(i))return _middlewareresponse.middlewareResponse.notFound(r);const n=await _promises.readFile(i);Object.entries(FONT_HEADERS).forEach((e=>{let[t,o]=e;r.setHeader(t,o)})),r.end(n)}catch(e){return _log.error("Failed to serve font:",e instanceof Error?e.message:e),_middlewareresponse.middlewareResponse.internalServerError(r)}}}async function checkFileExists(e){try{return await _promises.access(e,_fs.constants.F_OK),!0}catch(e){return!1}}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);