"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"hmrRefreshReducer",{enumerable:!0,get:function(){return hmrRefreshReducer}});const _fetchserverresponse=require("../fetch-server-response"),_createhreffromurl=require("../create-href-from-url"),_applyrouterstatepatchtotree=require("../apply-router-state-patch-to-tree"),_isnavigatingtonewrootlayout=require("../is-navigating-to-new-root-layout"),_navigatereducer=require("./navigate-reducer"),_handlemutable=require("../handle-mutable"),_applyflightdata=require("../apply-flight-data"),_approuter=require("../../app-router"),_handlesegmentmismatch=require("../handle-segment-mismatch"),_hasinterceptionrouteincurrenttree=require("./has-interception-route-in-current-tree");function hmrRefreshReducerImpl(e,r){const{origin:t}=r,a={},n=e.canonicalUrl;a.preserveCustomHistoryState=!1;const o=(0,_approuter.createEmptyCacheNode)(),u=(0,_hasinterceptionrouteincurrenttree.hasInterceptionRouteInCurrentTree)(e.tree);return o.lazyData=(0,_fetchserverresponse.fetchServerResponse)(new URL(n,t),{flightRouterState:[e.tree[0],e.tree[1],e.tree[2],"refetch"],nextUrl:u?e.nextUrl:null,isHmrRefresh:!0}),o.lazyData.then((t=>{let{flightData:u,canonicalUrl:l}=t;if("string"==typeof u)return(0,_navigatereducer.handleExternalUrl)(e,a,u,e.pushRef.pendingPush);o.lazyData=null;let s=e.tree,i=e.cache;for(const t of u){const{tree:u,isRootRender:c}=t;if(!c)return console.log("REFRESH FAILED"),e;const p=(0,_applyrouterstatepatchtotree.applyRouterStatePatchToTree)([""],s,u,e.canonicalUrl);if(null===p)return(0,_handlesegmentmismatch.handleSegmentMismatch)(e,r,u);if((0,_isnavigatingtonewrootlayout.isNavigatingToNewRootLayout)(s,p))return(0,_navigatereducer.handleExternalUrl)(e,a,n,e.pushRef.pendingPush);const h=l?(0,_createhreffromurl.createHrefFromUrl)(l):void 0;l&&(a.canonicalUrl=h);(0,_applyflightdata.applyFlightData)(i,o,t)&&(a.cache=o,i=o),a.patchedTree=p,a.canonicalUrl=n,s=p}return(0,_handlemutable.handleMutable)(e,a)}),(()=>e))}function hmrRefreshReducerNoop(e,r){return e}const hmrRefreshReducer="production"===process.env.NODE_ENV?hmrRefreshReducerNoop:hmrRefreshReducerImpl;("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);