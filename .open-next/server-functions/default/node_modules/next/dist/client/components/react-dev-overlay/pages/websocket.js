"use strict";function _export(e,o){for(var n in o)Object.defineProperty(e,n,{enumerable:!0,get:o[n]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{addMessageListener:function(){return addMessageListener},connectHMR:function(){return connectHMR},sendMessage:function(){return sendMessage}});const _hotreloadertypes=require("../../../../server/dev/hot-reloader-types"),_getsocketurl=require("../utils/get-socket-url");let source;const eventCallbacks=[];function addMessageListener(e){eventCallbacks.push(e)}function sendMessage(e){if(source&&source.readyState===source.OPEN)return source.send(e)}let reconnections=0,reloading=!1,serverSessionId=null;function connectHMR(e){function o(){function n(){reconnections=0,window.console.log("[HMR] connected")}function t(e){if(reloading)return;const o=JSON.parse(e.data);if("action"in o&&o.action===_hotreloadertypes.HMR_ACTIONS_SENT_TO_BROWSER.TURBOPACK_CONNECTED){if(null!==serverSessionId&&serverSessionId!==o.data.sessionId)return window.location.reload(),void(reloading=!0);serverSessionId=o.data.sessionId}for(const e of eventCallbacks)e(o)}let s;function r(){if(source.onerror=null,source.onclose=null,source.close(),reconnections++,reconnections>25)return reloading=!0,void window.location.reload();clearTimeout(s),s=setTimeout(o,reconnections>5?5e3:1e3)}source&&source.close();const c=(0,_getsocketurl.getSocketUrl)(e.assetPrefix);source=new window.WebSocket(""+c+e.path),source.onopen=n,source.onerror=r,source.onclose=r,source.onmessage=t}o()}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);