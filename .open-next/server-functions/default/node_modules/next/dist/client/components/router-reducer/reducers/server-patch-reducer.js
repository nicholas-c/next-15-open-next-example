"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"serverPatchReducer",{enumerable:!0,get:function(){return serverPatchReducer}});const _createhreffromurl=require("../create-href-from-url"),_applyrouterstatepatchtotree=require("../apply-router-state-patch-to-tree"),_isnavigatingtonewrootlayout=require("../is-navigating-to-new-root-layout"),_navigatereducer=require("./navigate-reducer"),_applyflightdata=require("../apply-flight-data"),_handlemutable=require("../handle-mutable"),_approuter=require("../../app-router");function serverPatchReducer(e,t){const{serverResponse:{flightData:r,canonicalUrl:a}}=t,o={preserveCustomHistoryState:!1};if("string"==typeof r)return(0,_navigatereducer.handleExternalUrl)(e,o,r,e.pushRef.pendingPush);let u=e.tree,l=e.cache;for(const t of r){const{segmentPath:r,tree:n}=t,p=(0,_applyrouterstatepatchtotree.applyRouterStatePatchToTree)(["",...r],u,n,e.canonicalUrl);if(null===p)return e;if((0,_isnavigatingtonewrootlayout.isNavigatingToNewRootLayout)(u,p))return(0,_navigatereducer.handleExternalUrl)(e,o,e.canonicalUrl,e.pushRef.pendingPush);const i=a?(0,_createhreffromurl.createHrefFromUrl)(a):void 0;i&&(o.canonicalUrl=i);const c=(0,_approuter.createEmptyCacheNode)();(0,_applyflightdata.applyFlightData)(l,c,t),o.patchedTree=p,o.cache=c,l=c,u=p}return(0,_handlemutable.handleMutable)(e,o)}("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);