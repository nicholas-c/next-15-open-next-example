"use strict";function _export(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{default:function(){return _default},pingVisibleLinks:function(){return pingVisibleLinks}});const _interop_require_default=require("@swc/helpers/_/_interop_require_default"),_jsxruntime=require("react/jsx-runtime"),_react=_interop_require_default._(require("react")),_formaturl=require("../../shared/lib/router/utils/format-url"),_approutercontextsharedruntime=require("../../shared/lib/app-router-context.shared-runtime"),_routerreducertypes=require("../components/router-reducer/router-reducer-types"),_usemergedref=require("../use-merged-ref"),_utils=require("../../shared/lib/utils"),_addbasepath=require("../add-base-path"),_warnonce=require("../../shared/lib/utils/warn-once"),_scheduler=require("../components/segment-cache/scheduler"),_actionqueue=require("../../shared/lib/router/action-queue"),_cachekey=require("../components/segment-cache/cache-key"),_approuter=require("../components/app-router"),_cache=require("../components/segment-cache/cache"),links="function"==typeof WeakMap?new WeakMap:new Map,visibleLinks=new Set,observer="function"==typeof IntersectionObserver?new IntersectionObserver(handleIntersect,{rootMargin:"200px"}):null;function mountLinkInstance(e,r,t,n){let o=null;try{if(o=(0,_approuter.createPrefetchURL)(r),null===o)return}catch(e){return void("function"==typeof reportError?reportError:console.error)("Cannot prefetch '"+r+"' because it cannot be converted to a URL.")}const i={prefetchHref:o.href,router:t,kind:n,isVisible:!1,wasHoveredOrTouched:!1,prefetchTask:null,cacheVersion:-1};void 0!==links.get(e)&&unmountLinkInstance(e),links.set(e,i),null!==observer&&observer.observe(e)}function unmountLinkInstance(e){const r=links.get(e);if(void 0!==r){links.delete(e),visibleLinks.delete(r);const t=r.prefetchTask;null!==t&&(0,_scheduler.cancelPrefetchTask)(t)}null!==observer&&observer.unobserve(e)}function handleIntersect(e){for(const r of e){const e=r.intersectionRatio>0;onLinkVisibilityChanged(r.target,e)}}function onLinkVisibilityChanged(e,r){if("production"!==process.env.NODE_ENV)return;const t=links.get(e);void 0!==t&&(t.isVisible=r,r?visibleLinks.add(t):visibleLinks.delete(t),rescheduleLinkPrefetch(t))}function onNavigationIntent(e){const r=links.get(e);void 0!==r&&void 0!==r&&(r.wasHoveredOrTouched=!0,rescheduleLinkPrefetch(r))}function rescheduleLinkPrefetch(e){const r=e.prefetchTask;if(!e.isVisible)return void(null!==r&&(0,_scheduler.cancelPrefetchTask)(r));if(!process.env.__NEXT_CLIENT_SEGMENT_CACHE)return void prefetchWithOldCacheImplementation(e);const t=e.wasHoveredOrTouched?_scheduler.PrefetchPriority.Intent:_scheduler.PrefetchPriority.Default;if(null===r){const r=(0,_actionqueue.getCurrentAppRouterState)();if(null!==r){const n=r.nextUrl,o=r.tree,i=(0,_cachekey.createCacheKey)(e.prefetchHref,n);e.prefetchTask=(0,_scheduler.schedulePrefetchTask)(i,o,e.kind===_routerreducertypes.PrefetchKind.FULL,t),e.cacheVersion=(0,_cache.getCurrentCacheVersion)()}}else(0,_scheduler.bumpPrefetchTask)(r,t)}function pingVisibleLinks(e,r){const t=(0,_cache.getCurrentCacheVersion)();for(const n of visibleLinks){const o=n.prefetchTask;if(null!==o&&n.cacheVersion===t&&o.key.nextUrl===e&&o.treeAtTimeOfPrefetch===r)continue;null!==o&&(0,_scheduler.cancelPrefetchTask)(o);const i=(0,_cachekey.createCacheKey)(n.prefetchHref,e),s=n.wasHoveredOrTouched?_scheduler.PrefetchPriority.Intent:_scheduler.PrefetchPriority.Default;n.prefetchTask=(0,_scheduler.schedulePrefetchTask)(i,r,n.kind===_routerreducertypes.PrefetchKind.FULL,s),n.cacheVersion=(0,_cache.getCurrentCacheVersion)()}}function prefetchWithOldCacheImplementation(e){if("undefined"==typeof window)return;(async()=>e.router.prefetch(e.prefetchHref,{kind:e.kind}))().catch((e=>{if("production"!==process.env.NODE_ENV)throw e}))}function isModifiedEvent(e){const r=e.currentTarget.getAttribute("target");return r&&"_self"!==r||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}function linkClicked(e,r,t,n,o,i,s){const{nodeName:c}=e.currentTarget;if("A"===c.toUpperCase()&&isModifiedEvent(e))return;e.preventDefault();const a=()=>{const e=null==s||s;"beforePopState"in r?r[o?"replace":"push"](t,n,{shallow:i,scroll:e}):r[o?"replace":"push"](n||t,{scroll:e})};_react.default.startTransition(a)}function formatStringOrUrl(e){return"string"==typeof e?e:(0,_formaturl.formatUrl)(e)}const Link=_react.default.forwardRef((function(e,r){let t;const{href:n,as:o,children:i,prefetch:s=null,passHref:c,replace:a,shallow:u,scroll:l,onClick:f,onMouseEnter:p,onTouchStart:h,legacyBehavior:d=!1,..._}=e;t=i,!d||"string"!=typeof t&&"number"!=typeof t||(t=(0,_jsxruntime.jsx)("a",{children:t}));const k=_react.default.useContext(_approutercontextsharedruntime.AppRouterContext),y=!1!==s,b=null===s?_routerreducertypes.PrefetchKind.AUTO:_routerreducertypes.PrefetchKind.FULL;if("production"!==process.env.NODE_ENV){function T(e){return Object.defineProperty(new Error("Failed prop type: The prop `"+e.key+"` expects a "+e.expected+" in `<Link>`, but got `"+e.actual+"` instead."+("undefined"!=typeof window?"\nOpen your browser's console to view the Component stack trace.":"")),"__NEXT_ERROR_CODE",{value:"E319",enumerable:!1,configurable:!0})}const C={href:!0};Object.keys(C).forEach((r=>{if("href"===r){if(null==e[r]||"string"!=typeof e[r]&&"object"!=typeof e[r])throw T({key:r,expected:"`string` or `object`",actual:null===e[r]?"null":typeof e[r]})}else{}}));const x={as:!0,replace:!0,scroll:!0,shallow:!0,passHref:!0,prefetch:!0,onClick:!0,onMouseEnter:!0,onTouchStart:!0,legacyBehavior:!0};Object.keys(x).forEach((r=>{const t=typeof e[r];if("as"===r){if(e[r]&&"string"!==t&&"object"!==t)throw T({key:r,expected:"`string` or `object`",actual:t})}else if("onClick"===r||"onMouseEnter"===r||"onTouchStart"===r){if(e[r]&&"function"!==t)throw T({key:r,expected:"`function`",actual:t})}else if("replace"===r||"scroll"===r||"shallow"===r||"passHref"===r||"prefetch"===r||"legacyBehavior"===r){if(null!=e[r]&&"boolean"!==t)throw T({key:r,expected:"`boolean`",actual:t})}else{}}))}if("production"!==process.env.NODE_ENV&&(e.locale&&(0,_warnonce.warnOnce)("The `locale` prop is not supported in `next/link` while using the `app` router. Read more about app router internalization: https://nextjs.org/docs/app/building-your-application/routing/internationalization"),!o)){let L;if("string"==typeof n?L=n:"object"==typeof n&&"string"==typeof n.pathname&&(L=n.pathname),L){if(L.split("/").some((e=>e.startsWith("[")&&e.endsWith("]"))))throw Object.defineProperty(new Error("Dynamic href `"+L+"` found in <Link> while using the `/app` router, this is not supported. Read more: https://nextjs.org/docs/messages/app-dir-dynamic-href"),"__NEXT_ERROR_CODE",{value:"E267",enumerable:!1,configurable:!0})}}const{href:v,as:g}=_react.default.useMemo((()=>{const e=formatStringOrUrl(n);return{href:e,as:o?formatStringOrUrl(o):e}}),[n,o]);let m;if(d)if("development"===process.env.NODE_ENV){f&&console.warn('"onClick" was passed to <Link> with `href` of `'+n+'` but "legacyBehavior" was set. The legacy behavior requires onClick be set on the child of next/link'),p&&console.warn('"onMouseEnter" was passed to <Link> with `href` of `'+n+'` but "legacyBehavior" was set. The legacy behavior requires onMouseEnter be set on the child of next/link');try{m=_react.default.Children.only(t)}catch(P){if(!t)throw Object.defineProperty(new Error("No children were passed to <Link> with `href` of `"+n+"` but one child is required https://nextjs.org/docs/messages/link-no-children"),"__NEXT_ERROR_CODE",{value:"E320",enumerable:!1,configurable:!0});throw Object.defineProperty(new Error("Multiple children were passed to <Link> with `href` of `"+n+"` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children"+("undefined"!=typeof window?" \nOpen your browser's console to view the Component stack trace.":"")),"__NEXT_ERROR_CODE",{value:"E266",enumerable:!1,configurable:!0})}}else m=_react.default.Children.only(t);else if("development"===process.env.NODE_ENV&&"a"===(null==t?void 0:t.type))throw Object.defineProperty(new Error("Invalid <Link> with <a> child. Please remove <a> or use <Link legacyBehavior>.\nLearn more: https://nextjs.org/docs/messages/invalid-new-link-with-extra-anchor"),"__NEXT_ERROR_CODE",{value:"E209",enumerable:!1,configurable:!0});const E=d?m&&"object"==typeof m&&m.ref:r,w=_react.default.useCallback((e=>(y&&null!==k&&mountLinkInstance(e,v,k,b),()=>{unmountLinkInstance(e)})),[y,v,k,b]),O={ref:(0,_usemergedref.useMergedRef)(w,E),onClick(e){if("production"!==process.env.NODE_ENV&&!e)throw Object.defineProperty(new Error('Component rendered inside next/link has to pass click event to "onClick" prop.'),"__NEXT_ERROR_CODE",{value:"E312",enumerable:!1,configurable:!0});d||"function"!=typeof f||f(e),d&&m.props&&"function"==typeof m.props.onClick&&m.props.onClick(e),k&&(e.defaultPrevented||linkClicked(e,k,v,g,a,u,l))},onMouseEnter(e){d||"function"!=typeof p||p(e),d&&m.props&&"function"==typeof m.props.onMouseEnter&&m.props.onMouseEnter(e),k&&y&&"development"!==process.env.NODE_ENV&&onNavigationIntent(e.currentTarget)},onTouchStart:process.env.__NEXT_LINK_NO_TOUCH_START?void 0:function(e){d||"function"!=typeof h||h(e),d&&m.props&&"function"==typeof m.props.onTouchStart&&m.props.onTouchStart(e),k&&y&&onNavigationIntent(e.currentTarget)}};return(0,_utils.isAbsoluteUrl)(g)?O.href=g:(!d||c||"a"===m.type&&!("href"in m.props))&&(O.href=(0,_addbasepath.addBasePath)(g)),d?_react.default.cloneElement(m,O):(0,_jsxruntime.jsx)("a",{..._,...O,children:t})})),_default=Link;("function"==typeof exports.default||"object"==typeof exports.default&&null!==exports.default)&&void 0===exports.default.__esModule&&(Object.defineProperty(exports.default,"__esModule",{value:!0}),Object.assign(exports.default,exports),module.exports=exports.default);