"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return resolveRewrites}});const _pathmatch=require("./path-match"),_preparedestination=require("./prepare-destination"),_removetrailingslash=require("./remove-trailing-slash"),_normalizelocalepath=require("../../i18n/normalize-locale-path"),_removebasepath=require("../../../../client/remove-base-path"),_parserelativeurl=require("./parse-relative-url");function resolveRewrites(e,a,r,t,i,s){let n,l=!1,o=!1,p=(0,_parserelativeurl.parseRelativeUrl)(e),h=(0,_removetrailingslash.removeTrailingSlash)((0,_normalizelocalepath.normalizeLocalePath)((0,_removebasepath.removeBasePath)(p.pathname),s).pathname);const c=r=>{let c=(0,_pathmatch.getPathMatch)(r.source+(process.env.__NEXT_TRAILING_SLASH?"(/)?":""),{removeUnnamedParams:!0,strict:!0})(p.pathname);if((r.has||r.missing)&&c){const e=(0,_preparedestination.matchHas)({headers:{host:document.location.hostname,"user-agent":navigator.userAgent},cookies:document.cookie.split("; ").reduce(((e,a)=>{const[r,...t]=a.split("=");return e[r]=t.join("="),e}),{})},p.query,r.has,r.missing);e?Object.assign(c,e):c=!1}if(c){if(!r.destination)return o=!0,!0;const m=(0,_preparedestination.prepareDestination)({appendParamsToQuery:!0,destination:r.destination,params:c,query:t});if(p=m.parsedDestination,e=m.newUrl,Object.assign(t,m.parsedDestination.query),h=(0,_removetrailingslash.removeTrailingSlash)((0,_normalizelocalepath.normalizeLocalePath)((0,_removebasepath.removeBasePath)(e),s).pathname),a.includes(h))return l=!0,n=h,!0;if(n=i(h),n!==e&&a.includes(n))return l=!0,!0}};let m=!1;for(let e=0;e<r.beforeFiles.length;e++)c(r.beforeFiles[e]);if(l=a.includes(h),!l){if(!m)for(let e=0;e<r.afterFiles.length;e++)if(c(r.afterFiles[e])){m=!0;break}if(m||(n=i(h),l=a.includes(n),m=l),!m)for(let e=0;e<r.fallback.length;e++)if(c(r.fallback[e])){m=!0;break}}return{asPath:e,parsedAs:p,matchedPage:l,resolvedHref:n,externalDest:o}}