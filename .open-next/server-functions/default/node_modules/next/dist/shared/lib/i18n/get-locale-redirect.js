"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"getLocaleRedirect",{enumerable:!0,get:function(){return getLocaleRedirect}});const _acceptheader=require("../../../server/accept-header"),_denormalizepagepath=require("../page-path/denormalize-page-path"),_detectdomainlocale=require("./detect-domain-locale"),_formaturl=require("../router/utils/format-url"),_getcookieparser=require("../../../server/api-utils/get-cookie-parser");function getLocaleFromCookie(e,a){var t,o;void 0===a&&(a={});const r=null==(o=(0,_getcookieparser.getCookieParser)(a||{})())||null==(t=o.NEXT_LOCALE)?void 0:t.toLowerCase();return r?e.locales.find((e=>r===e.toLowerCase())):void 0}function detectLocale(e){let{i18n:a,headers:t,domainLocale:o,preferredLocale:r,pathLocale:c}=e;return c||(null==o?void 0:o.defaultLocale)||getLocaleFromCookie(a,t)||r||a.defaultLocale}function getAcceptPreferredLocale(e,a){if((null==a?void 0:a["accept-language"])&&!Array.isArray(a["accept-language"]))try{return(0,_acceptheader.acceptLanguage)(a["accept-language"],e.locales)}catch(e){}}function getLocaleRedirect(e){let{defaultLocale:a,domainLocale:t,pathLocale:o,headers:r,nextConfig:c,urlParsed:l}=e;if(c.i18n&&!1!==c.i18n.localeDetection&&"/"===(0,_denormalizepagepath.denormalizePagePath)(l.pathname)){const e=getAcceptPreferredLocale(c.i18n,r),i=detectLocale({i18n:c.i18n,preferredLocale:e,headers:r,pathLocale:o,domainLocale:t}),n=(0,_detectdomainlocale.detectDomainLocale)(c.i18n.domains,void 0,e);if(t&&n){const a=n.domain===t.domain,o=n.defaultLocale===e;if(!a||!o){const a=o?"":e;return"http"+(n.http?"":"s")+"://"+n.domain+"/"+a}}if(i.toLowerCase()!==a.toLowerCase())return(0,_formaturl.formatUrl)({...l,pathname:(c.basePath||"")+"/"+i+(c.trailingSlash?"/":"")})}}