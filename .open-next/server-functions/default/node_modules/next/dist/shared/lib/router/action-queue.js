"use strict";function _export(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}Object.defineProperty(exports,"__esModule",{value:!0}),_export(exports,{createMutableActionQueue:function(){return createMutableActionQueue},getCurrentAppRouterState:function(){return getCurrentAppRouterState}});const _routerreducertypes=require("../../../client/components/router-reducer/router-reducer-types"),_routerreducer=require("../../../client/components/router-reducer/router-reducer"),_react=require("react"),_isthenable=require("../is-thenable");function runRemainingActions(e,t){null!==e.pending&&(e.pending=e.pending.next,null!==e.pending?runAction({actionQueue:e,action:e.pending,setState:t}):e.needsRefresh&&(e.needsRefresh=!1,e.dispatch({type:_routerreducertypes.ACTION_REFRESH,origin:window.location.origin},t)))}async function runAction(e){let{actionQueue:t,action:n,setState:r}=e;const u=t.state;t.pending=n;const o=n.payload,i=t.action(u,o);function c(e){n.discarded||(t.state=e,runRemainingActions(t,r),n.resolve(e))}(0,_isthenable.isThenable)(i)?i.then(c,(e=>{runRemainingActions(t,r),n.reject(e)})):c(i)}function dispatchAction(e,t,n){let r={resolve:n,reject:()=>{}};if(t.type!==_routerreducertypes.ACTION_RESTORE){const e=new Promise(((e,t)=>{r={resolve:e,reject:t}}));(0,_react.startTransition)((()=>{n(e)}))}const u={payload:t,next:null,resolve:r.resolve,reject:r.reject};null===e.pending?(e.last=u,runAction({actionQueue:e,action:u,setState:n})):t.type===_routerreducertypes.ACTION_NAVIGATE||t.type===_routerreducertypes.ACTION_RESTORE?(e.pending.discarded=!0,e.last=u,e.pending.payload.type===_routerreducertypes.ACTION_SERVER_ACTION&&(e.needsRefresh=!0),runAction({actionQueue:e,action:u,setState:n})):(null!==e.last&&(e.last.next=u),e.last=u)}let globalActionQueue=null;function createMutableActionQueue(e){const t={state:e,dispatch:(e,n)=>dispatchAction(t,e,n),action:async(e,t)=>(0,_routerreducer.reducer)(e,t),pending:null,last:null};if("undefined"!=typeof window){if(null!==globalActionQueue)throw Object.defineProperty(new Error("Internal Next.js Error: createMutableActionQueue was called more than once"),"__NEXT_ERROR_CODE",{value:"E624",enumerable:!1,configurable:!0});globalActionQueue=t}return t}function getCurrentAppRouterState(){return null!==globalActionQueue?globalActionQueue.state:null}