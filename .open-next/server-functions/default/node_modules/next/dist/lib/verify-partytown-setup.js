"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"verifyPartytownSetup",{enumerable:!0,get:function(){return verifyPartytownSetup}});const _fs=require("fs"),_picocolors=require("./picocolors"),_path=_interop_require_default(require("path")),_hasnecessarydependencies=require("./has-necessary-dependencies"),_fileexists=require("./file-exists"),_fatalerror=require("./fatal-error"),_log=_interop_require_wildcard(require("../build/output/log")),_getpkgmanager=require("./helpers/get-pkg-manager");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interop_require_wildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var o={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var a=i?Object.getOwnPropertyDescriptor(e,n):null;a&&(a.get||a.set)?Object.defineProperty(o,n,a):o[n]=e[n]}return o.default=e,t&&t.set(e,o),o}async function missingDependencyError(e){const r=(0,_getpkgmanager.getPkgManager)(e);throw Object.defineProperty(new _fatalerror.FatalError((0,_picocolors.bold)((0,_picocolors.red)("It looks like you're trying to use Partytown with next/script but do not have the required package(s) installed."))+"\n\n"+(0,_picocolors.bold)("Please install Partytown by running:")+"\n\n"+`\t${(0,_picocolors.bold)((0,_picocolors.cyan)(("yarn"===r?"yarn add --dev":"pnpm"===r?"pnpm install --save-dev":"npm install --save-dev")+" @builder.io/partytown"))}\n\n`+(0,_picocolors.bold)(`If you are not trying to use Partytown, please disable the experimental ${(0,_picocolors.cyan)('"nextScriptWorkers"')} flag in next.config.js.`)+"\n"),"__NEXT_ERROR_CODE",{value:"E552",enumerable:!1,configurable:!0})}async function copyPartytownStaticFiles(e,r){const t=_path.default.join(r,"~partytown");await(0,_fileexists.fileExists)(t,_fileexists.FileType.Directory)&&await _fs.promises.rm(t,{recursive:!0,force:!0});const{copyLibFiles:o}=await Promise.resolve(require(_path.default.join(e.resolved.get("@builder.io/partytown"),"../utils")));await o(t)}async function verifyPartytownSetup(e,r){try{var t;const o=await(0,_hasnecessarydependencies.hasNecessaryDependencies)(e,[{file:"@builder.io/partytown",pkg:"@builder.io/partytown",exportsRestrict:!1}]);if((null==(t=o.missing)?void 0:t.length)>0)await missingDependencyError(e);else try{await copyPartytownStaticFiles(o,r)}catch(e){_log.warn(`Partytown library files could not be copied to the static directory. Please ensure that ${(0,_picocolors.bold)((0,_picocolors.cyan)("@builder.io/partytown"))} is installed as a dependency.`)}}catch(e){throw e instanceof _fatalerror.FatalError&&(console.error(e.message),process.exit(1)),e}}