"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"createIncrementalCache",{enumerable:!0,get:function(){return createIncrementalCache}});const _path=_interop_require_default(require("path")),_incrementalcache=require("../../server/lib/incremental-cache"),_ciinfo=require("../../server/ci-info"),_nodefsmethods=require("../../server/lib/node-fs-methods"),_interopdefault=require("../../lib/interop-default"),_formatdynamicimportpath=require("../../lib/format-dynamic-import-path"),_handlers=require("../../server/use-cache/handlers");function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}async function createIncrementalCache({cacheHandler:e,cacheMaxMemorySize:r,fetchCacheKeyPrefix:t,distDir:a,dir:i,flushToDisk:n,cacheHandlers:o,requestHeaders:c}){let s;if(e&&(s=(0,_interopdefault.interopDefault)(await import((0,_formatdynamicimportpath.formatDynamicImportPath)(i,e)).then((e=>e.default||e)))),o&&(0,_handlers.initializeCacheHandlers)())for(const[e,r]of Object.entries(o))r&&(0,_handlers.setCacheHandler)(e,(0,_interopdefault.interopDefault)(await import((0,_formatdynamicimportpath.formatDynamicImportPath)(i,r)).then((e=>e.default||e))));const d=new _incrementalcache.IncrementalCache({dev:!1,requestHeaders:c||{},flushToDisk:n,maxMemoryCacheSize:r,fetchCacheKeyPrefix:t,getPrerenderManifest:()=>({version:4,routes:{},dynamicRoutes:{},preview:{previewModeEncryptionKey:"",previewModeId:"",previewModeSigningKey:""},notFoundRoutes:[]}),fs:_nodefsmethods.nodeFs,serverDistDir:_path.default.join(a,"server"),CurCacheHandler:s,minimalMode:_ciinfo.hasNextSupport});return globalThis.__incrementalCache=d,d}